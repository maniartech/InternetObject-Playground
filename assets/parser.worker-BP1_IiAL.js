class ut{constructor(t,e,n=[]){this._errors=[],this._header=t,this._sections=e,this._errors=n}get header(){return this._header}get sections(){return this._sections}getErrors(){return[...this._errors]}addErrors(t){t.length>0&&this._errors.push(...t)}toJSON(t){var r,o,a;const e=((r=this._sections)==null?void 0:r.length)||0;let n=null;if(e===1)n=((o=this._sections)==null?void 0:o.get(0)).toJSON(t);else if(e>1){n={};for(let c=0;c<e;c++){const l=(a=this._sections)==null?void 0:a.get(c);n[l.name]=l.toJSON(t)}}const s=this.header.toJSON();return s&&Object.keys(s).length>0?{header:s,data:n}:n}toObject(t){return this.toJSON(t)}}var ht;(function(i){i.invalidType="invalid-type",i.invalidValue="invalid-value",i.valueRequired="value-required",i.nullNotAllowed="null-not-allowed"})(ht||(ht={}));var ft;(function(i){i.stringNotClosed="string-not-closed",i.invalidEscapeSequence="invalid-escape-sequence",i.unsupportedAnnotation="unsupported-annotation",i.invalidDateTime="invalid-datetime"})(ft||(ft={}));var pt;(function(i){i.unexpectedToken="unexpected-token",i.expectingBracket="expecting-bracket",i.unexpectedPositionalMember="unexpected-positional-member",i.invalidKey="invalid-key",i.invalidSchema="invalid-schema",i.schemaNotFound="schema-not-found",i.schemaMissing="schema-missing",i.emptyMemberDef="empty-memberdef",i.invalidDefinition="invalid-definition",i.invalidMemberDef="invalid-memberdef",i.invalidSchemaName="invalid-schema-name",i.variableNotDefined="variable-not-defined",i.schemaNotDefined="schema-not-defined"})(pt||(pt={}));var dt;(function(i){i.invalidObject="invalid-object",i.unknownMember="unknown-member",i.duplicateMember="duplicate-member",i.additionalValuesNotAllowed="additional-values-not-allowed",i.invalidArray="invalid-array",i.notAnArray="not-an-array",i.notAString="not-a-string",i.invalidEmail="invalid-email",i.invalidUrl="invalid-url",i.invalidLength="invalid-length",i.invalidMinLength="invalid-min-length",i.invalidMaxLength="invalid-max-length",i.invalidPattern="invalid-pattern",i.unsupportedNumberType="unsupported-number-type",i.notANumber="not-a-number",i.notAnInteger="not-an-integer",i.outOfRange="out-of-range",i.invalidRange="invalid-range",i.invalidScale="invalid-scale",i.invalidPrecision="invalid-precision",i.notABool="not-a-bool",i.invalidChoice="invalid-choice"})(dt||(dt={}));const f={...ht,...ft,...pt,...dt};var Q=function(i,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?i!==t||!n:!t.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(i):n?n.value:t.get(i)},_t=function(i,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?i!==t||!s:!t.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(i,e):s?s.value=e:t.set(i,e),e},L;class k extends Error{get positionRange(){return Q(this,L,"f")}set positionRange(t){_t(this,L,t,"f"),this.updateMessage()}get code(){return this.errorCode}get position(){return Q(this,L,"f")}constructor(t,e,n,s=!1,r){super(),L.set(this,void 0),this.errorCode=t,this.fact=e,_t(this,L,n,"f"),this.isEof=s,this.name="IOError",this.updateMessage(),this.__proto__=new.target.prototype}updateMessage(){let t=`"${this.errorCode}" `;if(this.fact&&(t+=`"${this.fact}" `),this.isEof)t+="at EOF";else if(Q(this,L,"f")){const e=Q(this,L,"f");if(typeof e.getStartPos=="function"){const n=e.getStartPos();t+=`at ${n.row}:${n.col}`}else typeof e.row=="number"&&typeof e.col=="number"&&(t+=`at ${e.row}:${e.col}`)}this.message=t}}L=new WeakMap;class y extends k{constructor(t,e,n,s=!1,r){super(t,e,n,s,r),this.name="InternetObject(ValidationError)"}}var u;(function(i){i.CURLY_OPEN="CURLEY_OPEN",i.CURLY_CLOSE="CURLY_CLOSE",i.BRACKET_OPEN="BRACKET_OPEN",i.BRACKET_CLOSE="BRACKET_CLOSE",i.COLON="COLON",i.COMMA="COMMA",i.STRING="STRING",i.BINARY="BINARY",i.NUMBER="NUMBER",i.BIGINT="BIGINT",i.DECIMAL="DECIMAL",i.BOOLEAN="BOOLEAN",i.NULL="NULL",i.UNDEFINED="UNDEFINED",i.DATETIME="DATETIME",i.DATE="DATE",i.TIME="TIME",i.WHITESPACE="WHITESPACE",i.SECTION_SEP="SECTION_SEP",i.SECTION_SCHEMA="SECTION_SCHEMA",i.SECTION_NAME="SECTION_NAME",i.COLLECTION_START="COLLECTION_START",i.UNKNOWN="UNKNOWN",i.ERROR="ERROR"})(u||(u={}));class S{constructor(){this.pos=-1,this.row=-1,this.col=-1,this.token="",this.value=void 0,this.type="",this.subType=""}static init(t,e,n,s,r,o,a){const c=new S;return c.pos=t,c.row=e,c.col=n,c.token=s,c.value=r,c.type=o,a&&(c.subType=a),c}clone(){const t=new S;return t.pos=this.pos,t.row=this.row,t.col=this.col,t.token=this.token,t.value=this.value,t.type=this.type,t.subType=this.subType,t}getStartPos(){return{row:this.row,col:this.col,pos:this.pos}}getEndPos(){const t=this.token.trimEnd(),e=t.split(`
`),n=e[e.length-1],s=this.row+e.length-1,r=e.length>1?n.length:this.col+n.length,o=this.pos+t.length;return{row:s,col:r,pos:o}}}class E extends S{constructor(t){super(),Object.assign(this,t)}toValue(t){if((this.type==="string"||this.type===u.STRING)&&t!==void 0){const e=t.getV(this.value);return e===void 0?this.value:e}return this.value}}class N{constructor(t,...e){this.names=[],this.defs={},this.open=!1,this.name=t,e&&e.length>0&&e.forEach(n=>{const s=Object.keys(n)[0],r=n[s];r.path===void 0&&(r.path=s),this.names.push(s),this.defs[s]=r})}get(t){return this.defs[t]}has(t){return this.defs[t]!==void 0}get memberCount(){return this.names.length}static create(t){return new fe(t)}static fromLegacy(t,...e){return new N(t,...e)}}class fe{constructor(t){this.name=t,this.names=[],this.defs={},this.isOpen=!1}addMember(t,e){if(this.defs[t])throw new Error(`Member '${t}' already exists in schema '${this.name}'`);return this.names.push(t),this.defs[t]={...e,path:e.path||t},this}setOpen(t){return this.isOpen=t,this}build(){const t=new N(this.name);for(const e of this.names)t.names.push(e),t.defs[e]=this.defs[e];return t.open=this.isOpen,Object.freeze(t.names),Object.freeze(t.defs),t}}class pe{constructor(){this._defaultSchema=null,this._definitions={}}get length(){return Object.keys(this._definitions).length}get keys(){return Object.keys(this._definitions)}at(t){const e=this.keys[t];return{key:e,value:this._definitions[e]}}get defaultSchema(){var t;return this._defaultSchema||((t=this._definitions.$schema)==null?void 0:t.value)||null}get(t){var e;return(e=this._definitions[t])==null?void 0:e.value}getV(t){let e="";if((t||{}).type===u.STRING||(t||{}).type==="string")e=t.value;else if(typeof t=="string")e=t;else return;const n=this._definitions[e];if(!n){if(e.startsWith("$")||e.startsWith("@")){const s=typeof t=="string"?void 0:t;throw e.startsWith("$")?new y(f.schemaNotDefined,`Schema ${e} is not defined.`,s):new y(f.variableNotDefined,`Variable ${e} is not defined.`,s)}return}if(n.isVariable)return n.value;if(n.value instanceof E){const s=this.getV(n.value);if(s instanceof N)return this.set(e,s),s}return n.value}set(t,e){const n={isSchema:t.startsWith("$"),isVariable:t.startsWith("@"),value:e};this._definitions[t]=n,this._defaultSchema=null}delete(t){return t in this._definitions?(delete this._definitions[t],t==="$schema"&&(this._defaultSchema=null),!0):!1}push(t,e,n=!1,s=!1){this._definitions[t]={isSchema:n,isVariable:s,value:e},t==="$schema"&&(this._defaultSchema=e)}merge(t,e=!1){for(let n=0;n<t.length;n++){const{key:s,value:r}=t.at(n);(e||!this._definitions[s])&&this.push(s,r.value,r.isSchema,r.isVariable)}}toJSON(){var n;const t={};let e=0;for(let s=0;s<this.length;s++){const r=this.at(s);r.value.isSchema||r.value.isVariable||(e++,t[r.key]=(n=r.value.value)!=null&&n.toObject?r.value.value.toObject():r.value.value)}return e?t:null}*keyIterator(){for(const t of Object.keys(this._definitions))yield t}*entries(){for(const t of this.keyIterator())yield[t,this._definitions[t]]}*[Symbol.iterator](){yield*this.entries()}}class xt{constructor(){this._schema=null,this._definitions=new pe}get schema(){return this._schema||this._definitions.defaultSchema}set schema(t){this._schema=t}get definitions(){return this._definitions}merge(t,e=!1){e&&t.schema&&(this._schema=t.schema),t.definitions&&this._definitions.merge(t.definitions,e)}toJSON(){return this._definitions.toJSON()}}function I(i,t){let e="Assert never";throw i!=null&&(e=`Assert never: ${i.toString()}`),t&&(e+=` at ${t.toString()}`),new Error(e)}class K{constructor(t){if(this.items=[],this.keyMap=new Map,t)for(const[e,n]of Object.entries(t))this.set(e,n)}set(t,e){if(this.keyMap.has(t)){const n=this.keyMap.get(t);this.items[n]=[t,e]}else{const n=this.items.length;this.items.push([t,e]),this.keyMap.set(t,n)}return Object.defineProperty(this,t,{value:e,writable:!0,enumerable:!0,configurable:!0}),this}push(...t){for(const e of t)if(Array.isArray(e)){const[n,s]=e;if(this.has(n))throw new Error(`Key '${n}' already exists`);const r=this.items.length;this.items.push([n,s]),this.keyMap.set(n,r)}else this.items.push([void 0,e])}get(t){const e=this.keyMap.get(t);if(e!==void 0){const n=this.items[e];return n?n[1]:void 0}}getAt(t){if(t<0||t>=this.items.length)return;const e=this.items[t];return e?e[1]:void 0}keyAt(t){if(t<0||t>=this.items.length)return;const e=this.items[t];return e?e[0]:void 0}has(t){return this.keyMap.has(t)}delete(t){const e=this.keyMap.get(t);return e!==void 0&&this.items[e]?(this.items[e]=void 0,this.keyMap.delete(t),delete this[t],!0):!1}deleteAt(t){if(t<0||t>=this.items.length)throw new Error("Index out of range");const e=this.items[t];if(e){const n=e[0];return n!==void 0&&this.keyMap.delete(n),this.items[t]=void 0,!0}return!1}setAt(t,e){if(t<0||t>=this.items.length)throw new Error("Index out of range");const n=this.items[t];return n?(this.items[t]=[n[0],e],!0):!1}indexOfKey(t){return this.keyMap.get(t)??-1}indexOf(t){return this.items.findIndex(e=>e!==void 0&&Object.is(e[1],t))}isEmpty(){return this.length===0}static fromArray(t){const e=new K;for(const n of t)Array.isArray(n)?e.set(n[0],n[1]):e.push(n);return e}get length(){return this.items.length}clear(){for(const t of this.keysArray())delete this[t];this.items=[],this.keyMap.clear()}compact(){const t=[],e=new Map;for(const n of this.items)if(n!==void 0){t.push(n);const s=n[0];s!==void 0&&e.set(s,t.length-1)}this.items=t,this.keyMap=e}forEach(t,e){for(let n=0;n<this.items.length;n++){const s=this.items[n];s!==void 0&&t.call(e,s[1],s[0],n)}}entries(){return this._createIterator(t=>t)}keysArray(){return this.items.filter(t=>t!==void 0&&t[0]!==void 0).map(t=>t[0])}keys(){return(function*(t){for(const e of t)e!==void 0&&e[0]!==void 0&&(yield e[0])})(this.items)}values(){return(function*(t){for(const e of t)e!==void 0&&(yield e[1])})(this.items)}valuesArray(){return this.items.filter(t=>t!==void 0).map(t=>t[1])}*_createIterator(t){for(const e of this.items)e!==void 0&&(yield t(e))}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"IOObject"}find(t){let e=0;for(const n of this.items){if(n!==void 0&&t(n[1],n[0],e))return n[1];e++}}findIndex(t){let e=0;for(const n of this.items){if(n!==void 0&&t(n[1],n[0],e))return e;e++}return-1}map(t,e){const n=[];let s=0;for(const r of this.items)r!==void 0&&n.push(t.call(e,r[1],r[0],s)),s++;return n}toJSON(){const t={};return this.forEach((e,n,s)=>{typeof e>"u"||(t[n||s]=typeof e=="object"&&typeof(e==null?void 0:e.toJSON)=="function"?e.toJSON():e)}),t}}class F{constructor(t=[]){this._items=t}push(...t){return this._items.push(...t),this}getAt(t){if(t<0||t>=this._items.length)throw new Error("Index out of range");return this._items[t]}setAt(t,e){if(t<0)throw new Error("Index cannot be negative.");return t>=this._items.length?this._items.push(e):this._items[t]=e,this}deleteAt(t){if(t<0||t>=this._items.length)throw new Error("Index out of range");return this._items.splice(t,1),this}get length(){return this._items.length}get isEmpty(){return this.length===0}map(t){const e=this._items.map(t);return new F(e)}filter(t){const e=this._items.filter(t);return new F(e)}reduce(t,e){return this._items.reduce(t,e)}forEach(t){this._items.forEach(t)}some(t){return this._items.some(t)}every(t){return this._items.every(t)}find(t){return this._items.find(t)}findIndex(t){return this._items.findIndex(t)}insert(t,...e){return this._items.splice(t,0,...e),this._items.length}pop(){return this._items.pop()}toJSON(t){const e=(t==null?void 0:t.skipErrors)??!1;return this._items.filter(n=>{if(e&&typeof n=="object"&&n!==null&&typeof n.toValue=="function"){const s=n.toValue();if(s&&s.__error===!0)return!1}return!0}).map(n=>n instanceof K?n.toJSON():typeof n=="object"&&n!==null?typeof n.toValue=="function"?n.toValue():typeof n.toJSON=="function"?n.toJSON():JSON.stringify(n):n)}getErrors(){const t=[];for(const e of this._items)e&&typeof e=="object"&&e.error instanceof Error&&t.push(e.error);return t}*[Symbol.iterator](){yield*this._items}*entries(){for(let t=0;t<this._items.length;t++)yield[t,this._items[t]]}*keys(){for(let t=0;t<this._items.length;t++)yield t}*values(){yield*this._items}}function de(i){return i<0n?-i:i}const ot=new Map;function Y(i){if(i<0)throw new Error("Exponent must be non-negative");return ot.has(i)||ot.set(i,10n**BigInt(i)),ot.get(i)}function U(i,t){if(t<0)throw new Error(`Scale factor must be non-negative, got ${t}`);return t===0?i:i*Y(t)}function V(i,t,e){if(t<0||e<0)throw new Error("Scales must be non-negative");if(t<=e)return U(i,e-t);const n=t-e,s=Y(n),r=i/s,o=i%s,a=s/2n;return(o<0n?-o:o)>=a?r+(i>=0n?1n:-1n):r}function gt(i,t,e){if(t<0||e<0)throw new Error("Scales must be non-negative");if(t<=e)return U(i,e-t);const n=t-e,s=Y(n),r=i/s;return i%s!==0n&&i>0n?r+1n:r}function mt(i,t,e){if(t<0||e<0)throw new Error("Scales must be non-negative");if(t<=e)return U(i,e-t);const n=t-e,s=Y(n),r=i/s;return i%s!==0n&&i<0n?r-1n:r}function C(i,t,e){if(i===0n)return t>0?`0.${"0".repeat(t)}`:"0";const n=i<0n?"-":"";let r=(i<0n?-i:i).toString();for(;r.length<=t;)r="0"+r;const o=r.slice(0,r.length-t)||"0",a=t>0?r.slice(-t):"";return n+o+(t>0?"."+a:"")}function ge(i,t,e){if(t<=0)return{valid:!1,reason:"Precision must be positive"};if(e<0)return{valid:!1,reason:"Scale must be non-negative"};if(e>t)return{valid:!1,reason:"Scale must be less than or equal to precision"};if(i===0n)return{valid:!0};const s=de(i).toString();return s.length>t?{valid:!1,reason:`Coefficient has ${s.length} digits, exceeding precision of ${t}`}:s.length-e<0?{valid:!0}:{valid:!0}}function at(i,t,e,n,s,r="round"){if(i===0n)return{a:0n,b:e,targetScale:n,scaleAdjustment:0};if(e===0n)return{a:i,b:0n,targetScale:t,scaleAdjustment:0};let o=Math.max(t,n);s!==void 0&&o>s&&(o=s);const a=o-t,c=o-n;let l=i,h=e;if(a>0&&(l=U(i,a)),c>0&&(h=U(e,c)),s!==void 0){if(t>s)switch(r){case"round":l=V(i,t,s);break;case"ceil":l=gt(i,t,s);break;case"floor":l=mt(i,t,s);break;default:throw new d(`Invalid rounding mode: ${r}`)}if(n>s)switch(r){case"round":h=V(e,n,s);break;case"ceil":h=gt(e,n,s);break;case"floor":h=mt(e,n,s);break;default:throw new d(`Invalid rounding mode: ${r}`)}}return{a:l,b:h,targetScale:o,scaleAdjustment:Math.max(a,c)}}function me(i,t,e,n){if(i<=0||e<=0)throw new d("Precision must be positive");if(t<0||n<0)throw new d("Scale must be non-negative");if(t>i||n>e)throw new d("Scale must not exceed precision");const s=Math.max(t,n),r=i-t,o=e-n;return{precision:Math.max(r,o)+s+1,scale:s}}function ye(i,t,e,n){if(i<=0||e<=0)throw new d("Precision must be positive");if(t<0||n<0)throw new d("Scale must be non-negative");if(t>i||n>e)throw new d("Scale must not exceed precision");const s=t+n;return{precision:i+e+1,scale:s}}function we(i,t,e,n,s=6){if(i<=0||e<=0)throw new d("Precision must be positive");if(t<0||n<0)throw new d("Scale must be non-negative");if(t>i||n>e)throw new d("Scale must not exceed precision");if(s<0)throw new d("Minimum scale must be non-negative");const r=t+e+1,o=Math.max(s,r);return{precision:i-t+n+o,scale:o}}function Ee(i,t,e=38,n){const s=n??e;if(i<=0)throw new d("Precision must be positive");if(t<0)throw new d("Scale must be non-negative");if(t>i)throw new d("Scale must not exceed precision");if(i<=e&&t<=s)return{precision:i,scale:t};let r=Math.min(i,e),o=Math.min(t,s);return o>r&&(o=Math.max(0,r-1)),o>=r&&(o=Math.max(0,r-1)),{precision:r,scale:o}}function It(i,t,e,n,s,r){let o;switch(i){case"add":case"subtract":o=me(t,e,n,s);break;case"multiply":o=ye(t,e,n,s);break;case"divide":o=we(t,e,n,s,r==null?void 0:r.divisionMinScale);break;default:throw new d(`Unsupported operation: ${i}`)}return Ee(o.precision,o.scale,r==null?void 0:r.maxPrecision,r==null?void 0:r.maxScale)}class d extends Error{constructor(t){super(t),this.name="DecimalError"}}class w{constructor(t,e,n){this.coefficient=0n,this.exponent=0,[e,n]=this.resolvePrecisionAndScale(t,e,n),this.precision=e,this.scale=n,this.validatePrecisionAndScale(e,n);let s;if(typeof t=="string")s=this.initFromString(t,e,n);else if(typeof t=="number")s=this.initFromNumber(t,e,n);else if(t instanceof w)s=this.initFromDecimal(t,e,n);else throw new d("Unsupported value type for Decimal constructor.");this.coefficient=s.coefficient,this.exponent=s.exponent}resolvePrecisionAndScale(t,e,n){if(typeof t=="number"){if(e===void 0||n===void 0)throw new d("Precision and scale must be provided for number type.");return[e,n]}if(t instanceof w)return(e===void 0||n===void 0)&&(e=t.getPrecision(),n=t.getScale()),[e,n];if(typeof t=="string"){if(e===void 0||n===void 0){const s=/^-?(\d+)(?:\.(\d+))?$/,r=t.trim().match(s);if(!r)throw new d("Invalid decimal string format.");const o=r[1],a=r[2]||"";e=(o.replace(/^0+/,"").length||0)+a.length,n=a.length,e===0&&(e=1)}return[e,n]}throw new d("Unsupported value type for Decimal constructor.")}validatePrecisionAndScale(t,e){const n=ge(1n,t,e);if(!n.valid)throw new d(n.reason||"Invalid precision or scale")}initFromString(t,e,n){if(!w.isValidDecimal(t))throw new d("Invalid decimal string format.");const{sign:s,integerPart:r,fractionalPart:o}=w.parseString(t);let a=r,c=o;if(o.length>n){const T=w.roundForDecimal(r+"."+o,e,n);a=T.integerPart,c=T.fractionalPart}else c=o.padEnd(n,"0");const l=a.replace(/^0+/,"")||"0",p=(l+c).replace(/^0+/,"")||"0";if(p.length>e){const T=w.roundForDecimal(l+"."+c,e,n),B=T.integerPart+T.fractionalPart;if(B.replace(/^0+/,"").length>e)throw new d(`Value '${t}' exceeds specified precision (${e}) after rounding.`);const P=BigInt(B);return{coefficient:s==="-"?-P:P,exponent:n}}const m=BigInt(p);return{coefficient:s==="-"?-m:m,exponent:n}}initFromNumber(t,e,n){return this.initFromString(t.toString(),e,n)}initFromDecimal(t,e,n){t.getPrecision();const s=t.getScale(),r=t.getCoefficient(),o=e-n,c=t.toString().split(".")[0].replace("-","").length;if(c>o)throw new d(`Cannot adjust precision: integer part needs ${c} digits, but target precision-scale only allows ${o}.`);return n>s?this.increaseScaleForDecimal(t,e,n,s,r):n<s?this.decreaseScaleForDecimal(t,e,n,s,r):this.sameScaleForDecimal(t,e,n,r)}increaseScaleForDecimal(t,e,n,s,r){const o=n-s,a=U(r,o);if(a.toString().replace("-","").length>e)throw new d(`Value exceeds the specified precision (${e}) after scaling.`);return{coefficient:a,exponent:n}}decreaseScaleForDecimal(t,e,n,s,r){const o=V(r,s,n);return o.toString().replace("-","").length,{coefficient:o,exponent:n}}sameScaleForDecimal(t,e,n,s){if(t.getTotalDigits()>e)throw new d(`Value exceeds the specified precision (${e}).`);return{coefficient:s,exponent:n}}static roundForDecimal(t,e,n){const[s="0",r=""]=t.split("."),o=r.length,a=BigInt((s||"0")+(r||"")),c=V(a,o,n),l=C(c,n),[h,p=""]=l.split(".");return{integerPart:h,fractionalPart:p}}getTotalDigits(){return this.coefficient.toString().replace("-","").length}static isValidDecimal(t){let e=t.trim();return e.endsWith("m")&&(e=e.slice(0,-1)),/^[+\-]?\d+(\.\d+)?([eE][+-]?\d+)?$/.test(e)}static parseString(t){let e=t.trim();e.endsWith("m")&&(e=e.slice(0,-1));let n="";e.startsWith("-")?(n="-",e=e.slice(1)):e.startsWith("+")&&(e=e.slice(1));const[s,r]=e.split(/[eE]/),o=r?parseInt(r,10):0,[a,c=""]=s.split(".");let l=a||"0",h=c;if(o>0)h.length>o?(l+=h.slice(0,o),h=h.slice(o)):(l+=h.padEnd(o,"0"),h="");else if(o<0){const p=Math.abs(o);l.length>p?(h=l.slice(-p)+h,l=l.slice(0,-p)):(h=l.padStart(p,"0")+h,l="0")}return{sign:n,integerPart:l,fractionalPart:h}}static ensureDecimal(t){if(t instanceof w)return t;if(typeof t=="number")return new w(t.toString());if(typeof t=="string")return new w(t);throw new d(`Unsupported value type for Decimal conversion: ${typeof t}`)}toNumber(){const t=this.coefficient<0n?"-":"";let e=(this.coefficient<0n?-this.coefficient:this.coefficient).toString();if(this.exponent===0)return+`${t}${e}`;for(;e.length<=this.exponent;)e="0"+e;const n=e.slice(0,-this.exponent)||"0",s=e.slice(-this.exponent),r=`${t}${n}.${s}`,o=Number(r);if(!isFinite(o))throw new d("Conversion to Number results in Infinity.");return o}compareTo(t){if(this.precision!==t.precision||this.scale!==t.scale)throw new d("Decimals must have the same precision and scale for comparison.");return this.coefficient===t.coefficient?0:this.coefficient>t.coefficient?1:-1}compareStructure(t){return this.precision===t.precision&&this.scale===t.scale}equals(t){return this.compareTo(t)===0}lessThan(t){return this.compareTo(t)===-1}greaterThan(t){return this.compareTo(t)===1}lessThanOrEqual(t){return this.compareTo(t)<=0}greaterThanOrEqual(t){return this.compareTo(t)>=0}toString(){return C(this.coefficient,this.scale)}getPrecision(){return this.precision}getScale(){return this.scale}getExponent(){return this.exponent}getCoefficient(){return this.coefficient}getFormatPattern(){const t="x".repeat(this.precision-this.scale),e="x".repeat(this.scale);return this.scale>0?`${t}.${e}`:`${t}`}convert(t,e){if(e>t)throw new d("Scale must be less than or equal to precision.");try{return new w(this,t,e)}catch(n){throw n instanceof d?n:new d(`Conversion failed: ${n instanceof Error?n.message:String(n)}`)}}round(t,e){if(e>t)throw new d("Scale must be less than or equal to precision.");if(t<1)throw new d("Precision must be at least 1.");if(e<0)throw new d("Scale must be non-negative.");const n=V(this.coefficient,this.scale,e),s=C(n,e);return new w(s,t,e)}ceil(t,e){if(e>t)throw new d("Scale must be less than or equal to precision.");if(t<1)throw new d("Precision must be at least 1.");if(e<0)throw new d("Scale must be non-negative.");const n=gt(this.coefficient,this.scale,e),s=C(n,e);return new w(s,t,e)}floor(t,e){if(e>t)throw new d("Scale must be less than or equal to precision.");if(t<1)throw new d("Precision must be at least 1.");if(e<0)throw new d("Scale must be non-negative.");const n=mt(this.coefficient,this.scale,e),s=C(n,e);return new w(s,t,e)}mod(t){if(!(t instanceof w))throw new d("Invalid operand");if(t.coefficient===0n)throw new d("Division by zero");const{a:e,b:n,targetScale:s}=at(this.coefficient,this.scale,t.coefficient,t.scale),r=e/n,o=e-r*n,a=o.toString().replace("-","").length,c=Math.max(a,this.precision,t.precision),l=C(o,s);return new w(l,c,s)}add(t){if(!(t instanceof w))throw new d("Invalid operand");const{precision:e,scale:n}=It("add",this.precision,this.scale,t.precision,t.scale,{maxPrecision:1e4,maxScale:1e4}),{a:s,b:r}=at(this.coefficient,this.scale,t.coefficient,t.scale,n,"round"),o=s+r,a=o.toString().replace("-","").length,c=Math.max(e,a),l=C(o,n);return new w(l,c,n)}sub(t){if(!(t instanceof w))throw new d("Invalid operand");const{precision:e,scale:n}=It("subtract",this.precision,this.scale,t.precision,t.scale,{maxPrecision:1e4,maxScale:1e4}),{a:s,b:r}=at(this.coefficient,this.scale,t.coefficient,t.scale,n,"round"),o=s-r,a=o.toString().replace("-","").length,c=Math.max(e,a),l=C(o,n);return new w(l,c,n)}mul(t){if(!(t instanceof w))throw new d("Invalid operand");const e=this.coefficient*t.coefficient,n=this.scale+t.scale,s=Math.max(this.scale,t.scale);let r=e;n>s?r=V(e,n,s):n<s&&(r=U(e,s-n));const o=r.toString().replace("-","").length;let a=Math.max(this.precision,t.precision,o);o>a&&(a=o);const c=C(r,s);return new w(c,a,s)}div(t){if(!(t instanceof w))throw new d("Invalid operand");if(t.coefficient===0n)throw new d("Division by zero");const e=t.scale,n=e+t.scale-this.scale;let s;if(n>=0)s=this.coefficient*Y(n);else{const T=Y(-n);s=this.coefficient/T}const r=t.coefficient;let o=s/r,a=s%r;const c=r<0n?-r:r;if((a<0n?-a:a)*2n>=c){const T=s<0n!=r<0n;o+=T?-1n:1n}const h=C(o,e),p=(o<0n?(-o).toString():o.toString()).length,m=Math.max(this.precision,t.precision,p);return new w(h,m,e)}}class St{constructor(t,e,n){this._data=t,this._name=e,this._schemaName=n}get name(){return this._name}get schemaName(){return this._schemaName}get data(){return this._data}toJSON(t){return this._data instanceof K?this._data.toJSON():this._data instanceof F?this._data.toJSON(t):this._data&&typeof this._data=="object"?this._data:null}}class yt{constructor(){return this._sections=[],this._sectionNames={},new Proxy(this,ve)}get sections(){return this._sections}get length(){return this._sections.length}get(t){if(typeof t=="string"){const e=this._sectionNames[t];return e===void 0?void 0:this._sections[e]}return this._sections[t]}push(t){t.name!==void 0&&(this._sectionNames[t.name]=this._sections.length),this._sections.push(t)}*[Symbol.iterator](){for(const t of this._sections)yield t}}const ve={get:(i,t)=>{if(t in i)return Reflect.get(i,t);if(typeof t=="string")return/^[0-9]+$/.test(t)?i.get(Number(t)):i.get(t)},set:(i,t,e)=>{throw new Error("Cannot set a value on a IOSectionCollection")}};class g extends k{constructor(t,e,n,s=!1,r){super(t,e,n,s,r),this.name="InternetObject(SyntaxError)",this.updateMessage()}}class bt{constructor(t,e=[]){this.type=t,this.children=e}toValue(t){return this.children.map(e=>{if(e)return e.toValue(t)})}}class J extends bt{constructor(t=[],e,n){super("array",t),this.openBracket=e,this.closeBracket=n}toValue(t){return this.children.map(e=>e!=null&&e.toValue?e.toValue(t):e)}getStartPos(){return this.openBracket.getStartPos()}getEndPos(){return this.closeBracket.getEndPos()}}class z{constructor(t,e){this.type="member",this.value=t,e&&(this.key=e)}toValue(t){return this.key?{[this.key.value]:this.value.toValue(t)}:this.value.toValue(t)}getStartPos(){return this.key?this.key.getStartPos():this.value.getStartPos()}getEndPos(){return this.value?this.value.getEndPos():this.key?this.key.getEndPos():{row:0,col:0,pos:0}}}class x extends bt{constructor(t=[],e,n){super("object",t),e&&(this.openBracket=e),n&&(this.closeBracket=n)}toObject(t){const e={};let n=0;for(const s of this.children)s&&s.value?s.key?e[s.key.value]=s.value.toValue(t):e[n]=s.value.toValue(t):e[n]=void 0,n++;return e}getStartPos(){var t;return this.openBracket?this.openBracket.getStartPos():((t=this.children[0])==null?void 0:t.getStartPos())??{row:0,col:0,pos:0}}getEndPos(){var t;return this.closeBracket?this.closeBracket.getEndPos():((t=this.children[this.children.length-1])==null?void 0:t.getEndPos())??{row:0,col:0,pos:0}}toValue(t){const e=new K;for(let n=0;n<this.children.length;n++){const s=this.children[n];s&&s.value&&(s.key?e.set(s.key.value,s.value.toValue(t)):e.set(n.toString(),s.value.toValue(t)))}return e}isEmpty(){return this.children.length===0||this.children.every(t=>t===void 0)}toDebugString(){return`ObjectNode { ${this.children.map((e,n)=>{if(!e)return`[${n}]: undefined`;const s=e,r=s.key?s.key.value:`[${n}]`,o=s.value?typeof s.value.toValue=="function"?JSON.stringify(s.value.toValue()):String(s.value):"undefined";return`${r}: ${o}`}).join(", ")} }`}hasKey(t){return this.children.some(e=>{if(!e)return!1;const n=e;return n.key&&n.key.value===t})}getKeys(){const t=[];return this.children.forEach((e,n)=>{if(e){const s=e;s.key?t.push(s.key.value):t.push(n.toString())}}),t}isValid(){return this.children.every(t=>{if(!t)return!0;const e=t;return!(e.value&&e.value.error!==void 0||e.key&&e.key.error!==void 0)})}}class _{static setWarnOnDuplicates(t){this.warnDuplicates=t}static register(...t){for(const e of t)for(const n of e.types){if(this.typeDefMap.has(n)){this.warnDuplicates&&!this.warnedDuplicateTypes.has(n)&&(console.warn(`TypeDef for '${n}' is already registered. Skipping.`),this.warnedDuplicateTypes.add(n));continue}this.typeDefMap.set(n,new e(n)),this.typeNames.add(n)}}static unregister(t){this.typeDefMap.has(t)&&(this.typeDefMap.delete(t),this.typeNames.delete(t))}static get types(){return Object.freeze(Array.from(this.typeNames))}static get(t){const e=this.typeDefMap.get(t);if(!e)throw new k(f.invalidType,`Type '${t}' is not registered`);return e}static isRegisteredType(t){return this.typeDefMap.has(t)}static clear(){this.typeDefMap.clear(),this.typeNames.clear(),this.warnedDuplicateTypes.clear()}static get count(){return this.typeDefMap.size}}_.typeDefMap=new Map;_.typeNames=new Set;_.warnDuplicates=!1;_.warnedDuplicateTypes=new Set;function X(i,t,e){const n=_.get(t.type);if(!n)throw new Error(`Type ${t.type} is not registered.`);let s=i==null?void 0:i.value;return n.parse(s,t,e)}function H(i,t,e,n){if(t instanceof E){const s=t.value;t=e==null?void 0:e.getV(s)}return t instanceof N||I("Invalid schema type"),Se(i,t,e)}function Se(i,t,e,n){const s=new K;let r=!0;const o=new Set;let a=0;for(;a<t.names.length;a++){let c=i.children[a],l=t.names[a],h=t.defs[l];if(c){if(c.key){r=!1;break}o.add(l);const p=X(c,h,e);p!==void 0&&s.set(l,p)}else if(!h.optional)throw new y(f.valueRequired,`Expecting a value for ${h.path}.`,i)}if(r)for(;a<i.children.length;a++){const c=i.children[a];if(!t.open)throw new g(f.additionalValuesNotAllowed,`Additional values are not allowed in the ${t.name}. The ${t.name} schema is not open.`,c.value);if(c.key){r=!1;break}const l=c.value.toValue(e);s.push(l)}for(;a<i.children.length;a++){let c=i.children[a];if(!c.key)throw new g(f.unexpectedPositionalMember,"Positional members must not be allowed after the keyed member is found.",c);let l=c.key.value,h=t.defs[l];if(o.has(l))throw new g(f.duplicateMember,`Member ${l} is already defined.`,c);if(!h&&!t.open)throw new g(f.unknownMember,`The ${t.name?`${t.name} `:""}schema does not define a member named '${l}'.`,c.key);!h&&t.open&&(typeof t.open=="object"&&t.open.type?h={...t.open,path:l}:h={type:"any",path:l}),o.add(l);const p=X(c,h,e);s.set(l,p)}for(const c in t.defs){if(c==="*")continue;const l=t.defs[c];if(!o.has(c)){const h=i.children.find(p=>{var m;return((m=p.key)==null?void 0:m.value)===c});try{const p=X(h,l,e);p!==void 0&&s.set(c,p)}catch(p){throw p instanceof y&&(p.positionRange=i),p}}}if((t.open===!0||typeof t.open=="object"&&t.open.type)&&s.isEmpty()){for(const c of i.children){if(!c)continue;const l=c;let h=l.key?l.key.value:void 0;if(!h)continue;let p;typeof t.open=="object"&&t.open.type?p={...t.open,path:h}:p={type:"any",path:h};const m=X(l,p,e);s.set(h,m)}return s}return s}class D{constructor(t,e,n){this.error=t,this.position=e,this.endPosition=n}getErrorCategory(){const t=this.error.name;return t.includes("SyntaxError")?"syntax":t.includes("ValidationError")?"validation":"runtime"}toValue(t){return{__error:!0,category:this.getErrorCategory(),message:this.error.message,name:this.error.name,position:this.position,...this.endPosition&&{endPosition:this.endPosition}}}getStartPos(){return this.position}getEndPos(){return this.endPosition||this.position}}class be{static resolve(t,e){if(t instanceof E){const n=t.value,s=e==null?void 0:e.getV(n);if(!(s instanceof N))throw new Error(`Schema '${n}' not found or invalid`);return s}return t}static isSchemaVariable(t){return t instanceof E&&typeof t.value=="string"&&t.value.startsWith("$")}}function Ne(i,t,e,n){const s=be.resolve(t,e),r=new F,o=i.children.length;for(let a=0;a<o;a++){const c=i.children[a];if(c instanceof D)r.push(c);else try{r.push(H(c,s,e,a))}catch(l){if(l instanceof Error){const h=new D(l,c.getStartPos(),c.getEndPos());n&&n.push(l),r.push(h)}else throw l}}return r}class it extends bt{constructor(t=[]){super("collection",t)}toValue(t){const e=new F;for(const n of this.children)e.push(n==null?void 0:n.toValue(t));return e}getStartPos(){var t;return((t=this.children[0])==null?void 0:t.getStartPos())??{row:0,col:0,pos:0}}getEndPos(){var t;return((t=this.children[this.children.length-1])==null?void 0:t.getEndPos())??{row:0,col:0,pos:0}}isEmpty(){return this.children.length===0||this.children.every(t=>t===void 0)}toDebugString(){return`CollectionNode { ${this.children.map((e,n)=>{if(!e)return`[${n}]: undefined`;const s=typeof e.toValue=="function"?JSON.stringify(e.toValue()):String(e);return`[${n}]: ${s}`}).join(", ")} }`}size(){return this.children.length}hasValidItems(){return this.children.some(t=>t?t.error===void 0:!0)}getValidItems(){return this.children.filter(t=>t?t.error===void 0:!0)}isValid(){return this.children.every(t=>t?t.error===void 0:!0)}}class nt{static isValidDataNode(t){return t instanceof x||t instanceof it}static isValidSchema(t){return t instanceof N||t instanceof E}static validateProcessingInputs(t,e){var n,s;if(!nt.isValidDataNode(t)){const r=(n=t==null?void 0:t.constructor)==null?void 0:n.name,o=t===null?"null":t===void 0||r===void 0?"undefined":r||"unknown";throw new Error(`Invalid data node type: ${o}`)}if(!nt.isValidSchema(e)){const r=(s=e==null?void 0:e.constructor)==null?void 0:s.name,o=e===null?"null":e===void 0||r===void 0?"undefined":r||"unknown";throw new Error(`Invalid schema type: ${o}`)}return{data:t,schema:e}}}function Vt(i,t,e,n){if(i===null)return null;const{data:s,schema:r}=nt.validateProcessingInputs(i,t);return s instanceof x?H(s,r,e):Ne(s,r,e,n)}function $(i,t,e,n,s){const r=t===void 0||t instanceof E&&t.type===u.UNDEFINED,o=e instanceof E?e.value===null:t===null;if(r){if(i.default!==void 0)return{value:Te(i.default),changed:!0};if(i.optional)return{value:void 0,changed:!0};throw new y(...Oe(i,e))}if(o){if(i.null)return{value:null,changed:!0};const a=`Null is not allowed for ${i.path}`;throw new y(f.nullNotAllowed,a,e)}if(t=typeof t=="object"&&t.toValue?t.toValue(n):t,i.choices!==void 0){let a=t instanceof E?t.value:t,c=!1;for(let l of i.choices)if(typeof l=="string"&&l[0]==="@"&&(l=n==null?void 0:n.getV(l),l=l instanceof E?l.value:l),a===l){c=!0;break}if(!c)throw new y(..._e(i,t,e))}return{value:t,changed:!1}}function Te(i){return typeof i=="string"?i==="N"?null:i==="T"||i==="true"?!0:i==="F"||i==="false"?!1:i:i}function Oe(i,t,e){const n=`Value is required for ${i.path}`;return[f.valueRequired,n,t]}function _e(i,t,e){if(!i.choices)throw Error("Choices not checked during NumberDef implementation.");t=t.toValue?t.toValue():t.toObject?t.toObject():t,t=JSON.stringify(t);let n=`The value of "${i.path}" must be one of the [${i.choices.join(", ")}]. Currently it is ${t}.`;return i.choices.length===1&&(n=`The value of "${i.path}" must be '${i.choices[0]}'. Currently it is ${t}.`),[f.invalidChoice,n,e]}const xe={type:"any",__memberdef:!0},Ie=new N("any",{type:{type:"string",optional:!1,null:!1,choices:["any"]}},{default:{type:"any",optional:!0,null:!1}},{choices:{type:"array",optional:!0,null:!1}},{anyOf:{type:"array",optional:!0,null:!1,of:xe}},{isSchema:{type:"bool",optional:!0,null:!1,default:!1}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class Re{get type(){return"any"}get schema(){return Ie}parse(t,e,n,s){const r=(n==null?void 0:n.getV(t))||t,{value:o,changed:a}=$(e,r,t,n);if(a)return o;const c=e.anyOf;if(!c)return e.__memberdef?oe(new z(t),"",n):o;const l=[];for(let h=0;h<c.length;h++){const p=c[h];p.path=e.path;const m=_.get(p.type);if(!m)throw new k(f.invalidType,`Invalid type definition '${p.type}'`);try{return m.parse(t,p,n,s)}catch(T){l.push(T);continue}}if(l.length===c.length)throw new y(f.invalidValue,`None of the constraints defined for '${e.path}' matched.`,t);return r}static get types(){return["any"]}}const Ce=new N("array",{type:{type:"string",optional:!1,null:!1,choices:["array"]}},{default:{type:"array",optional:!0,null:!1}},{of:{type:"any",optional:!0,null:!1,__memberdef:!0}},{len:{type:"number",optional:!0,null:!1,min:0}},{minLen:{type:"number",optional:!0,null:!1,min:0}},{maxLen:{type:"number",optional:!0,null:!1,min:0}});class ke{constructor(){this.parse=(t,e,n,s)=>Ae(t,e,n)}get type(){return"array"}get schema(){return Ce}static get types(){return["array"]}}function Ae(i,t,e,n){var h;const s=(e==null?void 0:e.getV(i))||i,{value:r,changed:o}=$(t,s,i,e);if(o)return r;if(!(s instanceof J))throw new y(f.notAnArray,`Expecting an array value for '${t.path}'`,i);let a,c={type:"any"};if(t.of instanceof N)a=_.get("object"),c.schema=t.of,c.path=t.path;else if((h=t.of)!=null&&h.type){if(a=_.get(t.of.type),!a)throw new y(f.invalidType,`Invalid type definition '${t.of.type}'`,i);c=t.of,c.path=t.path}else typeof t.of=="string"?I(t.of):a=_.get("any");const l=[];return s.children.forEach(p=>{if(s!==i)try{l.push(a==null?void 0:a.parse(p,c,e))}catch(m){throw m instanceof y&&(m.positionRange=i),m}else l.push(a==null?void 0:a.parse(p,c,e))}),l}var $e=function(i,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?i!==t||!n:!t.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(i):n?n.value:t.get(i)},wt,Dt;const Pe=new N("bool",{type:{type:"string",optional:!1,null:!1,choices:["bool"]}},{default:{type:"bool",optional:!0,null:!1}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class Le{constructor(){wt.add(this)}get type(){return"bool"}get schema(){return Pe}parse(t,e,n){return $e(this,wt,"m",Dt).call(this,t,e,n)}strinfigy(t){return t.toString()}static get types(){return["bool"]}}wt=new WeakSet,Dt=function(t,e,n){const s=(n==null?void 0:n.getV(t))||t,{value:r,changed:o}=$(e,s,t,n);if(o)return r;if(!(s instanceof E)||s.type!==u.BOOLEAN)throw new k(f.notABool,`Expecting a boolean value for '${e.path}' but found ${s.toValue()}.`,t);return s.value};const Nt={datetime:/^(?<dt>(?<year>\d{4})(?:\-(?<month>(?:1[0-2]|0[1-9]))(?:\-(?<date>[0-2][0-9]|3[0-1]))?)?(T(?<hour>[0-1][0-9]|2[0-3])(?:\:(?<minute>[0-5][0-9])(?:\:(?<sec>[0-5][0-9])(?:\.(?<milisecond>(?:\d{3})+))?)?)?)?(?<tz>(Z)|((?:\+|-)(?:(?:[0-1][0-9]|2[0-3])(?:\:[0-5][0-9])?)))?)$/,date:/^(?<year>\d{4})(?:\-(?<month>(?:1[0-2]|0[1-9]))(?:\-(?<date>[0-2][0-9]|3[0-1]))?)?$/,time:/^(?<hour>[0-1][0-9]|2[0-3])(?:\:(?<minute>[0-5][0-9])(?:\:(?<second>[0-5][0-9])(?:\.(?<milisecond>(?:\d{3})+))?)?)?$/},Tt={datetime:/^(?<year>\d{4})(?:(?<month>(?:1[0-2]|0[1-9]))(?:(?<date>[0-2][0-9]|3[0-1]))?)?(?:(?<hour>[0-1][0-9]|2[0-3])(?:(?<minute>[0-5][0-9])(?:(?<second>[0-5][0-9])(?:(?<milisecond>(?:\d{3})+))?)?)?)?(?<tz>(Z)|((?:\+|-)(?:(?:[0-1][0-9]|2[0-3])(?:[0-5][0-9])?)))?/,date:/^(?<year>\d{4})(?:(?<month>(?:1[0-2]|0[1-9]))(?:(?<date>[0-2][0-9]|3[0-1]))?)?$/,time:/^(?<hour>[0-1][0-9]|2[0-3])(?:(?<minute>[0-5][0-9])(?:(?<second>[0-5][0-9])(?:(?<milisecond>(?:\d{3})+))?)?)?$/},Me=i=>{const e=(/[\-\:]/.test(i.substring(0,6))?Nt.datetime:Tt.datetime).exec(i);if(!e)return null;const{year:n,month:s,date:r,hour:o,minute:a,second:c,milisecond:l,tz:h}=e.groups||{},m=`${n}-${s||"01"}-${r||"01"}T${o||"00"}:${a||"00"}:${c||"00"}.${l||"000"}${h||"Z"}`;return new Date(m)},Ue=i=>{const e=(/\-/.test(i.substring(0,5))?Nt.date:Tt.date).exec(i);if(!e)return null;const{year:n,month:s,date:r}=e.groups||{},o=`${n}-${s||"01"}-${r||"01"}T00:00:00.000Z`;return new Date(o)},Be=i=>{const e=(/\:/.test(i.substring(0,3))?Nt.time:Tt.time).exec(i);if(!e)return null;const{hour:n,minute:s,second:r,milisecond:o}=e.groups||{},a=`1900-01-01T${n||"00"}:${s||"00"}:${r||"00"}.${o||"000"}Z`;return new Date(a)},Ft=(i,t=!1,e=!1)=>i===null?null:i.toISOString(),Yt=(i,t=!1)=>i===null?null:i.toISOString().split("T")[0],Kt=(i,t=!1)=>i===null?null:i.toISOString().split("T")[1].split(".")[0],Rt=(i,t,e=!1)=>{if(i===null)return null;switch(t){case"datetime":return Ft(i,e);case"date":return Yt(i,e);case"time":return Kt(i,e)}},je=(i,t,e=!1)=>{if(i===null)return"N";switch(t){case"datetime":return`dt"${Ft(i,e)}"`;case"date":return`d"${Yt(i,e)}"`;case"time":return`t"${Kt(i,e)}"`}};var ct=function(i,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?i!==t||!n:!t.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(i):n?n.value:t.get(i)},Ve=function(i,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?i!==t||!s:!t.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(i,e):s?s.value=e:t.set(i,e),e},Et,q,Wt;const Gt=["datetime","date","time"],De=new N("datetime",{type:{type:"string",optional:!1,null:!1,choices:Gt}},{default:{type:"datetime",optional:!0,null:!1}},{choices:{type:"array",optional:!0,null:!1,of:{type:"datetime"}}},{min:{type:"datetime",optional:!0,null:!1}},{max:{type:"datetime",optional:!0,null:!1}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class Fe{get type(){return ct(this,q,"f")}get schema(){return De}constructor(t="datetime"){Et.add(this),q.set(this,void 0),Ve(this,q,t,"f")}parse(t,e,n){const s=(n==null?void 0:n.getV(t))||t,{value:r,changed:o}=$(e,s,t,n);if(o)return r;if(s.type!==u.DATETIME)throw new y(f.invalidDateTime,`Expecting a ${e.type.toUpperCase()} value for ${e.path}, currently ${s.value}, a ${s.type} value`,t);return ct(this,Et,"m",Wt).call(this,r,e,t),r}strinfigy(t){return je(t,ct(this,q,"f"))}static get types(){return Gt}}q=new WeakMap,Et=new WeakSet,Wt=function(t,e,n){const s=e.type;if(e.min){const r=e.min;if(r&&t<r)throw new y(f.outOfRange,`Expecting the value ${e.path?`for '${e.path}'`:""} to be greater than or equal to '${Rt(e.min,s)}'`,n)}if(e.max){const r=e.max;if(r&&t>r)throw new y(f.outOfRange,`Expecting the value ${e.path?`for '${e.path}'`:""} to be less than or equal to '${Rt(e.max,s)}'`,n)}};const Z=["bigint","decimal","int","uint","float","number","int8","int16","int32","uint8","uint16","uint32","uint64","float32","float64"],qt=Z.reduce((i,t)=>(i[t]=!0,i),{});function M(i,t,e,n){let s;switch(i){case f.invalidType:s=`The '${t}' has an invalid type. ${e}`;break;case f.invalidRange:s=`The '${t}' must be within the specified range, Currently it is ${e}.`;break;case f.invalidScale:s=`The '${t}' has an invalid scale. ${e}`;break;case f.invalidPrecision:s=`The '${t}' has an invalid precision. ${e}`;break;default:s=`The '${t}' validation failed. ${e}`}throw new y(i,s,n)}function W(i){return i.toString().split(".")[0].replace("-","").length}const Ye=new N("bigint",{type:{type:"string",optional:!1,null:!1,choices:Z}},{default:{type:"bigint",optional:!0,null:!1}},{choices:{type:"array",optional:!0,null:!1,of:{type:"bigint"}}},{min:{type:"bigint",optional:!0,null:!1}},{max:{type:"bigint",optional:!0,null:!1}},{format:{type:"string",optional:!0,null:!1,choices:["decimal","hex","octal","binary"],default:"decimal"}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class Ke{constructor(){this._type="bigint"}get type(){return this._type}get schema(){return Ye}parse(t,e,n){const s=(n==null?void 0:n.getV(t))||t;typeof(s==null?void 0:s.toValue)=="function"&&s.toValue(n);let{value:r,changed:o}=$(e,s,t,n);return o||(r=this.validate(e,r,t)),r}stringify(t,e){return e.format==="hex"?t.toString(16):e.format==="octal"?t.toString(8):e.format==="binary"?t.toString(2):t.toString()}validate(t,e,n){const s=typeof e=="bigint"?"bigint":qt[typeof e]?"number":"";if(s==="")throw new y(f.invalidType,`Expecting a value of type '${t.type}' for '${t.path}'`,n);if(s!=="bigint")throw new y(`not-a-${t.type}`,`Invalid value encountered for '${t.path}'`,n);const{min:r,max:o}=t;return(r!=null&&e<r||o!=null&&e>o)&&M(f.invalidRange,t.path,e,n),e}}const We=new N("decimal",{type:{type:"string",optional:!1,null:!1,choices:Z}},{default:{type:"decimal",optional:!0,null:!1}},{choices:{type:"array",optional:!0,null:!1,of:{type:"decimal"}}},{precision:{type:"number",optional:!0,null:!1}},{scale:{type:"number",optional:!0,null:!1}},{min:{type:"decimal",optional:!0,null:!1}},{max:{type:"decimal",optional:!0,null:!1}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class Ge{constructor(){this._type="decimal"}get type(){return this._type}get schema(){return We}parse(t,e,n){const s=(n==null?void 0:n.getV(t))||t;let{value:r,changed:o}=$(e,s,t,n);return o||(typeof r=="number"&&M(f.invalidType,e.path,"Expected decimal value (with 'm' suffix), got number",t),r=this.validate(e,r,t)),r}stringify(t,e){return t.toString()}validate(t,e,n){let{min:s,max:r,precision:o,scale:a}=t;const c=w.ensureDecimal(e),l=o!=null,h=a!=null;if(h){const p=c.getScale();p!==a&&M(f.invalidScale,t.path,`Value has scale ${p}, expected ${a}`,n)}if(l){const p=c.getPrecision();if(h){const m=W(c),T=o-a;m>T&&M(f.invalidPrecision,t.path,`Integer part has ${m} digits, DECIMAL(${o},${a}) allows ${T}`,n)}else p>o&&M(f.invalidPrecision,t.path,`Value has precision ${p}, max allowed is ${o}`,n)}if(s!=null){const p=w.ensureDecimal(s),m=Math.max(c.getScale(),p.getScale()),T=W(c),B=W(p),P=Math.max(T,B)+m,st=c.convert(P,m),rt=p.convert(P,m);st.compareTo(rt)<0&&M(f.invalidRange,t.path,e,n)}if(r!=null){const p=w.ensureDecimal(r),m=Math.max(c.getScale(),p.getScale()),T=W(c),B=W(p),P=Math.max(T,B)+m,st=c.convert(P,m),rt=p.convert(P,m);st.compareTo(rt)>0&&M(f.invalidRange,t.path,e,n)}return c}}const qe=new N("number",{type:{type:"string",optional:!1,null:!1,choices:Z}},{default:{type:"number",optional:!0,null:!1}},{choices:{type:"array",optional:!0,null:!1,of:{type:"number"}}},{min:{type:"number",optional:!0,null:!1}},{max:{type:"number",optional:!0,null:!1}},{format:{type:"string",optional:!0,null:!1,choices:["decimal","hex","octal","binary","scientific"]}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class ze{get type(){return this._type}get schema(){return this._delegateTypeDef?this._delegateTypeDef.schema:qe}constructor(t="number"){this._type=t,t==="bigint"?this._delegateTypeDef=new Ke:t==="decimal"&&(this._delegateTypeDef=new Ge)}parse(t,e,n){if(this._delegateTypeDef)return this._delegateTypeDef.parse(t,e,n);const s=(n==null?void 0:n.getV(t))||t;typeof(s==null?void 0:s.toValue)=="function"&&s.toValue(n);let{value:r,changed:o}=$(e,s,t,n);return o||(r=this.validateInteger(e,r,t)),r}stringify(t,e){return this._delegateTypeDef&&"stringify"in this._delegateTypeDef?this._delegateTypeDef.stringify(t,e):e.format==="scientific"?t.toExponential():e.format==="hex"?t.toString(16):e.format==="octal"?t.toString(8):e.format==="binary"?t.toString(2):t.toString()}validateInteger(t,e,n){const s=typeof e=="bigint"?"bigint":qt[typeof e]?"number":"";if(s==="")throw new y(f.invalidType,`Expecting a value of type '${t.type}' for '${t.path}'`,n);if(s!=="number")throw new y(`not-a-${t.type}`,`Invalid value encountered for '${t.path}'`,n);const{min:r,max:o}=this.getTypeBounds(this._type),a=t.min!==void 0&&t.min!==null?t.min:r,c=t.max!==void 0&&t.max!==null?t.max:o;return(a!==null&&e<a||c!==null&&e>c)&&M(f.invalidRange,t.path,e,n),e}getTypeBounds(t){switch(t){case"uint":return{min:0,max:null};case"int8":return{min:-128,max:2**7-1};case"uint8":return{min:0,max:2**8-1};case"int16":return{min:-32768,max:2**15-1};case"uint16":return{min:0,max:2**16-1};case"int32":return{min:-2147483648,max:2**31-1};case"uint32":return{min:0,max:2**32-1};case"uint64":case"int64":case"float32":case"float64":throw new k(f.unsupportedNumberType,`The number type '${t}' is not supported.`);default:return{min:null,max:null}}}static get types(){return Z}}const He=new N("object",{type:{type:"string",optional:!1,null:!1,choices:["object"]}},{default:{type:"object",optional:!0,null:!1}},{schema:{type:"object",optional:!0,null:!1,__schema:!0}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class Je{constructor(){this._names=null,this.parse=(t,e,n)=>this._process(t,e,n),this._process=(t,e,n)=>{const s=(n==null?void 0:n.getV(t))||t,{value:r,changed:o}=$(e,s,t,n);if(o)return r;let a=e.schema;if(!(s instanceof x))throw new y(f.invalidObject,`Expecting an object value for '${e.path}'`,t);if(s===t)return e.__schema?Ot(e.path||"",s,n):(a||(a=new N(e.path||""),a.open=!0),H(s,a,n));try{return H(s,a,n)}catch(c){throw c instanceof y&&(c.positionRange=t),c}return H(s,a,n)}}get type(){return"object"}static get types(){return["object"]}get schema(){return He}}const zt=/(?<structural>[\{\}\[\]\:\,\#\"\'\\\\~])/gm,Ht=/(?<escape>[\n\r\t])/gm,Jt=/(?<newlines>(\r\n?)|\n)/gm,Zt=(i,t)=>(i=i.replace(zt,"\\$1"),t&&(i=i.replace(Jt,"\\n")),i),Qt=(i,t,e='"')=>(i=i.replace(Ht,"\\$1"),t&&(i=i.replace(Jt,"\\n")),`${e}${i.replace(e,`\\${e}`)}${e}`),Xt=(i,t='"')=>`r${t}${i.replace(t,t+t)}${t}`,Ze=(i,t,e='"')=>zt.test(i)?Zt(i,t):Ht.test(i)?Xt(i,e):Qt(i,t,e),te=["string","url","email"],Qe=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/,Xe=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/,tn=new N("string",{type:{type:"string",optional:!1,null:!1,choices:te}},{default:{type:"string",optional:!0,null:!1}},{choices:{type:"array",optional:!0,null:!1,of:{type:"string"}}},{pattern:{type:"string",optional:!0,null:!1}},{flags:{type:"string",optional:!0,null:!1}},{len:{type:"number",optional:!0,null:!1,min:0}},{minLen:{type:"number",optional:!0,null:!1,min:0}},{maxLen:{type:"number",optional:!0,null:!1,min:0}},{format:{type:"string",optional:!0,null:!1,choices:["auto","open","regular","raw"],default:"auto"}},{escapeLines:{type:"bool",optional:!0,null:!1,default:!1}},{encloser:{type:"string",optional:!0,null:!1,choices:['"',"'"],default:'"'}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class en{constructor(t="string"){this._type=t}get type(){return this._type}static get types(){return te}get schema(){return tn}parse(t,e,n){return nn(t,e,n)}stringify(t,e){switch(e.format||"auto"){case"auto":return Ze(t,e.escapeLines,e.encloser);case"open":return Zt(t,e.escapeLines);case"regular":return Qt(t,e.escapeLines,e.encloser);default:return Xt(t,e.encloser)}}}function nn(i,t,e){const n=(e==null?void 0:e.getV(i))||i,{value:s,changed:r}=$(t,n,i,e);if(r)return s;if(!(n instanceof E)||n.type!==u.STRING)throw new y(f.notAString,`Expecting a string value for '${t.path}' but found ${n.toValue()}.`,i);sn(t,s,i);const o=t.len;if(o!==void 0&&typeof o=="number"&&s.length!==o)throw new y(f.invalidLength,`Invalid length for ${t.path}.`,n);const a=t.maxLen;if(a!==void 0&&typeof a=="number"&&s.length>a)throw new y(f.invalidMaxLength,`Invalid maxLength for ${t.path}.`,n);const c=t.minLen;if(c!==void 0&&typeof c=="number"&&s.length<c)throw new y(f.invalidMinLength,`Invalid minLen for ${t.path}.`,n);return s}function sn(i,t,e){const n=i.type;if(n==="string"&&i.pattern!==void 0){let s=i.re;if(!s){let r=i.pattern,o=i.flags;try{o?s=i.re=new RegExp(r,o):s=i.re=new RegExp(r),i.re=s}catch{throw new y(f.invalidPattern,t,e)}}if(!s.test(t))throw new y(f.invalidPattern,`The value '${t}' does not match the pattern '${i.pattern}'.`,e)}else if(n==="email"){if(!Qe.test(t))throw new y(f.invalidEmail,`Invalid email address: ${t}`,e)}else if(n==="url"&&!Xe.test(t))throw new y(f.invalidUrl,`Invalid URL: ${t}`,e)}let Ct=!1;function rn(){Ct||(_.register(Re,ke,Le,ze,Je,en,Fe),Ct=!0)}function j(i,t){const e=(t==null?void 0:t.allowNameless)===!0;if(!i||typeof i!="object")throw new g(f.invalidMemberDef,"Invalid member definition input provided.");const{name:n,type:s}=i;if(!s||typeof s!="string")throw new g(f.invalidType,"MemberDef.type must be a non-empty string.");if(!e&&(!n||typeof n!="string"||n.trim()===""))throw new g(f.invalidMemberDef,"MemberDef must have a valid name.");if(s==="array"&&(!("of"in i)||typeof i.of!="object"||!i.of))throw new g(f.invalidDefinition,"Array MemberDef must include an 'of' definition.");const r={...i};return"optional"in r&&r.optional!==void 0&&(r.optional=!!r.optional),"null"in r&&r.null!==void 0&&(r.null=!!r.null),r}function on(i,t="*"){if(i instanceof E){if(typeof i.value=="string"){if(_.isRegisteredType(i.value))return{type:i.value,path:t};if(i.value==="*")return{type:"any",path:t}}return{type:"any",path:t}}if(i instanceof x){if(i.children.length===0)return{type:"object",path:t,open:!0};const e=i.children[0];if(e&&!e.key&&e.value instanceof E){const n=e.value;if(typeof n.value=="string"&&_.isRegisteredType(n.value)){const s={type:n.value,path:t};for(let r=1;r<i.children.length;r++){const o=i.children[r];o&&o.key&&o.value instanceof E&&(s[o.key.value]=o.value.value)}return s}}return{type:"object",path:t}}if(i instanceof J){if(i.children.length===0)return{type:"array",path:t,of:{type:"any"}};const e=i.children[0];return e instanceof E&&typeof e.value=="string"?{type:"array",path:t,of:{type:e.value}}:{type:"array",path:t}}return typeof i=="object"&&i.type?{...i,path:t}:{type:"any",path:t}}function ee(i){if(i||I("Key node must not be null in schema definition."),i instanceof E){if(i.type===u.STRING)return i}else if(i instanceof S&&i.type===u.STRING)return new E(i);throw new g(f.invalidKey,"The key must be a string.",i)}rn();function Ot(i,t,e){if(t instanceof E&&t.type===u.STRING&&t.value.startsWith("$"))return t;if(!(t instanceof x))throw new g(f.invalidSchema,"Schema must be an object.",t);const n=new N(i);return se(t,n,"",e),n}function ne(i,t,e){if(i.children.length===0){const o=new N(t);return o.open=!0,{type:"object",path:t,schema:o}}const n=i.children[0];if(!n.key&&n.value instanceof E){const o=n.value;if(o.type===u.STRING){if(_.isRegisteredType(o.value))return kt(o.value,i);if(typeof o.value=="string"&&o.value.startsWith("$"))return{type:"object",schema:o,path:t}}}let s="",r=null;for(let o=0;o<i.children.length;o++){const a=i.children[o];if(a instanceof z&&a.key&&a.key.value==="type"&&a.value instanceof E&&a.value.type===u.STRING){s=a.value.value,r=a.value;break}}if(s!==""){if(typeof s=="string"&&s.startsWith("$"))return{type:"object",schema:r,path:t};if(_.isRegisteredType(s))return kt(s,i);throw new g(f.invalidType,`The specified value '${s}' is not a valid type.`,r)}return{type:"object",schema:se(i,new N(t),t,e),path:t}}function ie(i,t,e){if(i.children.length>1)throw new g(f.invalidSchema,"The array definition must have only one child.",i.children[1]);if(i.children.length===0)return j({type:"array",of:{type:"any",path:t,null:!0},path:t},{allowNameless:!0});const n=i.children[0];if(n instanceof E){if(n.type===u.STRING){const s=n.value;if(_.isRegisteredType(s))return j({type:"array",of:{type:n.value,path:t},path:t},{allowNameless:!0});if(e&&s.startsWith("$"))return j({type:"array",of:{type:"object",schema:n,path:t},path:t},{allowNameless:!0})}throw new g(f.invalidType,`The specified value (${n.value}) is not a valid type`,n)}if(n instanceof x)return j({type:"array",of:ne(n,t,e),path:t},{allowNameless:!0});if(n instanceof J)return j({type:"array",of:ie(n,t,e),path:t},{allowNameless:!0});throw new g(f.invalidSchema,"The array of type definition must be a string or object.",n)}function se(i,t,e,n){for(let s=0;s<i.children.length;s++){const r=i.children[s];r===null&&I("Child value must not be null in schema definition.");const o=r;if(o.value instanceof E&&o.value.type===u.UNDEFINED)throw new g(f.emptyMemberDef,"The next member definition is empty.",o.value);if(o.key&&o.key.value==="*"){if(o.value){const a=on(o.value,"*");t.defs["*"]=a,t.open=a}else t.open=!0;if(s!==i.children.length-1)throw new g(f.invalidSchema,"The * is only allowed at the last position.",o.value);continue}if(o.key){const a=oe(o,e,n);At(a,t,e)}else{if(o.value instanceof E&&o.value.type===u.STRING&&o.value.value==="*"){if(s!==i.children.length-1)throw new g(f.invalidSchema,"The * is only allowed at the last position.",o.value);t.open=!0;continue}const c=ee(o.value),l=re(c),h=j({...l,type:"any"});At(h,t,e)}}return t.names.length===0&&(t.open=!0),t}function kt(i,t){const e=_.get(i),n=Vt(t,e.schema);return n==null?void 0:n.toJSON()}function At(i,t,e){if(t.defs[i.name])throw new g(f.duplicateMember,`Member ${i.name} is already defined in schema ${t.name}.`,t.defs[i.name]);i.path=vt(e,i.name),t.names.push(i.name),t.defs[i.name]=i}const re=i=>{if(i||I("Key node must not be null in schema definition."),!(i instanceof S))throw new g(f.invalidKey,"The key must be a string.",i);const t=i.value,e=/\?$/,n=/\*$/,s=/(\?\*)|(\*\?)$/;if(i.type!==u.STRING)throw new g(f.invalidKey,"The key must be a string.",i);return t.match(s)?{name:t.substring(0,t.length-2),optional:!0,null:!0}:t.match(n)?{name:t.substring(0,t.length-1),optional:!1,null:!0}:t.match(e)!==null?{name:t.substring(0,t.length-1),optional:!0,null:!1}:{name:t,optional:!1,null:!1}};function oe(i,t,e){const n=i.value;let s={name:""};if(i.key&&(s=re(ee(i.key))),n instanceof E&&n.type===u.STRING){const r=n.value;if(r.startsWith("$"))return{...s,type:"object",schema:n};if(_.isRegisteredType(r)===!1)throw new g(f.invalidType,`The type '${r}' is not supported.`,n);return{...s,type:r}}if(n instanceof x){const r=ne(n,vt(t,s.name));return{...s,...r}}if(n instanceof J){const r=ie(n,vt(t,s.name),e);return{...s,...r}}throw new g(f.invalidType,`Found '${n.toValue()}' but expecting a data type definition.`,n)}function vt(i,t){return i===""?t:`${i}.${t}`}function an(i,t){return{getStartPos:()=>i.getStartPos(),getEndPos:()=>t.getEndPos()}}function $t(i,t){return{getStartPos:()=>i.getStartPos(),getEndPos:()=>t}}function Pt(i,t,e){return{pos:i,row:t,col:e}}var b;(function(i){i.CURLY_OPEN="{",i.CURLY_CLOSE="}",i.BRACKET_OPEN="[",i.BRACKET_CLOSE="]",i.COLON=":",i.COMMA=",",i.HASH="#",i.DOUBLE_QUOTE='"',i.SINGLE_QUOTE="'",i.BACKSLASH="\\",i.TILDE="~",i.PLUS="+",i.MINUS="-",i.DOLLAR="$",i.DOT="."})(b||(b={}));const Lt=i=>[b.CURLY_OPEN,b.CURLY_CLOSE,b.BRACKET_OPEN,b.BRACKET_CLOSE,b.COLON,b.COMMA,b.TILDE,b.DOUBLE_QUOTE,b.SINGLE_QUOTE].includes(i),cn=i=>/[0-9]/.test(i),ln=new Set([5760,8232,8233,8239,8287,12288,65279]),G=(i,t=!1)=>{if(t)return i===" "||i==="	";const e=i.codePointAt(0)||0;return e<=32?!0:e<=255?e===160:e>65279?!1:e>=8192&&e<=8202?!0:ln.has(e)},un=i=>![b.CURLY_OPEN,b.CURLY_CLOSE,b.BRACKET_OPEN,b.BRACKET_CLOSE,b.COLON,b.COMMA,b.HASH,b.DOUBLE_QUOTE,b.SINGLE_QUOTE,b.TILDE].includes(i),hn=i=>i===u.COLLECTION_START||i===u.SECTION_SEP||i===u.COMMA||i===u.COLON||i===u.BRACKET_OPEN||i===u.BRACKET_CLOSE||i===u.CURLY_OPEN||i===u.CURLY_CLOSE;var R;(function(i){i.NULL="null",i.N="N",i.TRUE="true",i.T="T",i.FALSE="false",i.F="F",i.Inf="Inf",i.PositiveInf="+Inf",i.NegativeInf="-Inf",i.NaN="NaN"})(R||(R={}));const A={hex4:/^[0-9a-fA-F]{4}$/,hex2:/^[0-9a-fA-F]{2}$/,floatDigit:/^[0-9.]+$/,intDigit:/^[0-9]+$/,hex:/^[0-9a-fA-F]+$/,octal:/^[0-7]+$/,binary:/^[01]+$/,sectionSchemaName:/^(?:(?:(?<name>[\p{L}\p{M}\p{N}\-_]+)(?<sep>[ \t]*:[ \t]*)?)(?<schema>\$[\p{L}\p{M}\p{N}\-_]+)?|(?<schema2>\$[\p{L}\p{M}\p{N}\-_]+))/u,annotatedStrStart:/^(?<name>[a-zA-Z]{1,4})(?<quote>['"])/,base64:/^[A-Za-z0-9+/]*={0,2}$/},v={NEWLINE:10,DOUBLE_QUOTE:34,SINGLE_QUOTE:39,HASH:35,PLUS:43,MINUS:45,DOT:46,ZERO:48,NINE:57,COLON:58,COMMA:44,CURLY_OPEN:123,CURLY_CLOSE:125,BRACKET_OPEN:91,BRACKET_CLOSE:93,TILDE:126},fn=i=>i>=v.ZERO&&i<=v.NINE,pn=new Set([5760,8232,8233,8239,8287,12288,65279]),dn=i=>i<=32?!0:i<=255?i===160:i>65279?!1:i>=8192&&i<=8202?!0:pn.has(i),gn=A.hex4,mn=A.hex2,yn=A.floatDigit,lt=A.intDigit,wn=A.hex,En=A.octal,vn=A.binary,Sn=["x","X","o","O","b","B"],bn=A.sectionSchemaName,Nn=Sn,Tn=A.annotatedStrStart;class On{constructor(t){this.pos=0,this.input="",this.row=1,this.col=1,this.reachedEnd=!1,this.inputLength=0,this.input=t,this.inputLength=t.length}isSpecialSymbolFast(t){return t===v.CURLY_OPEN||t===v.CURLY_CLOSE||t===v.BRACKET_OPEN||t===v.BRACKET_CLOSE||t===v.COMMA||t===v.COLON||t===v.TILDE}getSymbolTokenTypeFast(t){switch(t){case v.CURLY_OPEN:return u.CURLY_OPEN;case v.CURLY_CLOSE:return u.CURLY_CLOSE;case v.BRACKET_OPEN:return u.BRACKET_OPEN;case v.BRACKET_CLOSE:return u.BRACKET_CLOSE;case v.COMMA:return u.COMMA;case v.COLON:return u.COLON;case v.TILDE:return u.COLLECTION_START;default:return u.UNKNOWN}}createErrorToken(t,e,n,s,r){return S.init(e,n,s,r,{__error:!0,message:t.message,originalError:t},u.ERROR)}skipToNextTokenBoundary(){for(;!this.reachedEnd&&!G(this.input[this.pos])&&!Lt(this.input[this.pos])&&this.input[this.pos]!==","&&this.input[this.pos]!==`
`;)this.advance()}advance(t=1){if(!this.reachedEnd){if(t===1){this.input.charCodeAt(this.pos)===v.NEWLINE?(this.row++,this.col=1):this.col++,this.pos++,this.pos>=this.inputLength&&(this.reachedEnd=!0);return}for(let e=0;e<t;e++)if(this.input.charCodeAt(this.pos)===v.NEWLINE?(this.row++,this.col=1):this.col++,this.pos++,this.pos>=this.inputLength){this.reachedEnd=!0;break}}}parseSingleLineComment(){for(;!this.reachedEnd&&this.input[this.pos]!==`
`;)this.advance()}parseRegularString(t){const e=this.pos,n=this.row,s=this.col;this.advance();let r="",o=!1;for(;!this.reachedEnd&&this.input[this.pos]!==t;){if(G(this.input[this.pos])){r+=this.skipWhitespaces();continue}if(this.input[this.pos]===b.BACKSLASH)try{({value:r,needToNormalize:o}=this.escapeString(r,o))}catch{if(!this.reachedEnd){const l=this.input[this.pos];if(r+=l,l==="u"){this.advance();for(let h=0;h<4&&!this.reachedEnd;h++)r+=this.input[this.pos],this.advance();continue}else if(l==="x"){this.advance();for(let h=0;h<2&&!this.reachedEnd;h++)r+=this.input[this.pos],this.advance();continue}else this.advance()}continue}else r+=this.input[this.pos],this.advance()}if(this.reachedEnd){const c=this.input.substring(e,this.pos),l=S.init(e,n,s,'"','"',"STRING"),h=Pt(this.pos,this.row,this.col),p=new g(f.stringNotClosed,`Unterminated string literal. Expected closing quote '"' before end of input.`,$t(l,h),!0);return this.createErrorToken(p,e,n,s,c)}this.advance();const a=this.input.substring(e,this.pos);return o&&(r=r.normalize("NFC")),S.init(e,n,s,a,r,"STRING","REGULAR_STRING")}escapeString(t,e){if(this.advance(),this.reachedEnd)throw new g(f.invalidEscapeSequence,"Invalid escape sequence at end of input. Expected escape character after backslash.",this.currentPosition,!0);switch(this.input[this.pos]){case"b":t+="\b";break;case"f":t+="\f";break;case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"u":const n=this.input.substring(this.pos+1,this.pos+5);if(gn.test(n))t+=String.fromCharCode(parseInt(n,16)),this.advance(4),e=!0;else throw new g(f.invalidEscapeSequence,`Invalid Unicode escape sequence '\\u${n}'. Expected 4 hexadecimal digits (0-9, A-F).`,this.currentPosition);break;case"x":const s=this.input.substring(this.pos+1,this.pos+3);if(mn.test(s))t+=String.fromCharCode(parseInt(s,16)),this.advance(2),e=!0;else throw new g(f.invalidEscapeSequence,`Invalid hexadecimal escape sequence '\\x${s}'. Expected 2 hexadecimal digits (0-9, A-F).`,this.currentPosition);break;default:t+=this.input[this.pos],this.advance();break}return{value:t,needToNormalize:e}}get currentPosition(){const t=()=>({pos:this.pos,row:this.row,col:this.col});return{getStartPos:t,getEndPos:t}}checkIfAnotatedString(){const t=Tn.exec(this.input.substring(this.pos,this.pos+5));return t?t.groups:null}parseAnotatedString(t){const e=this.pos,n=this.row,s=this.col;for(let c=0;c<t.name.length;c++)this.advance();if(this.reachedEnd){const c=this.input.substring(e,this.pos),l=S.init(e,n,s,t.name+t.quote,t.name,"STRING"),h=Pt(this.pos,this.row,this.col),p=new g(f.stringNotClosed,`Unterminated annotated string literal. Expected closing quote '${t.quote}' before end of input.`,$t(l,h),!0);return this.createErrorToken(p,e,n,s,c)}for(this.advance();!this.reachedEnd&&this.input[this.pos]!==t.quote;)this.advance();const r=this.input.substring(e,this.pos);let o;if(this.reachedEnd)o=r.substring(t.name.length+1);else{this.advance();const c=this.input.substring(e,this.pos);o=c.substring(t.name.length+1,c.length-1)}const a=new S;return a.pos=e,a.row=n,a.col=s,a.token=this.reachedEnd?r:this.input.substring(e,this.pos),a.value=o,a}parseRawString(t){const e=this.parseAnotatedString(t);return e.type===u.ERROR||(e.type=u.STRING,e.subType="RAW_STRING"),e}parseByteString(t){const e=this.parseAnotatedString(t);if(e.type===u.ERROR)return e;try{if(!A.base64.test(e.value))throw new Error("Invalid base64 format");return e.type=u.BINARY,e.subType="BINARY_STRING",e.value=Buffer.from(e.value,"base64"),e}catch(n){return this.createErrorToken(n,e.pos,e.row,e.col,e.token)}}parseDateTime(t){const e=this.parseAnotatedString(t);if(e.type===u.ERROR)return e;try{let n=r=>null;switch(t.name){case"dt":n=Me,e.subType=u.DATETIME;break;case"d":n=Ue,e.subType=u.DATE;break;case"t":n=Be,e.subType=u.TIME;break;default:I(t)}const s=n(e.value);if(!s){const r=new g(f.invalidDateTime,`Invalid ${t.name==="dt"?"datetime":t.name==="d"?"date":"time"} format '${e.value}'. Expected valid ISO 8601 format.`,e);return this.createErrorToken(r,e.pos,e.row,e.col,e.token)}return e.value=s,e.type=u.DATETIME,e}catch(n){return this.createErrorToken(n,e.pos,e.row,e.col,e.token)}}parseNumber(){const t=this.pos,e=this.row,n=this.col;let s="",r=10,o=!1,a=!1,c="",l;if(this.input[this.pos]==="+"||this.input[this.pos]==="-"){const m=this.input[this.pos];if(this.input.startsWith("Inf",this.pos+1)){const T=m+"Inf";return this.advance(4),S.init(t,e,n,T,m==="+"?1/0:-1/0,u.NUMBER)}if(cn(this.input[this.pos+1])||this.input[this.pos+1]===".")s+=m,this.advance();else return null}else if(this.input.startsWith("Inf",this.pos))return this.advance(3),S.init(t,e,n,"Inf",1/0,u.NUMBER);if(this.input[this.pos]==="."&&!yn.test(this.input[this.pos+1]))return null;if(this.input[this.pos]==="0"&&Nn.includes(this.input[this.pos+1]))switch(this.input[this.pos+1]){case"X":case"x":for(r=16,l="HEX",c=this.input[this.pos]+this.input[this.pos+1],this.advance(2);wn.test(this.input[this.pos]);)s+=this.input[this.pos],this.advance();break;case"O":case"o":for(r=8,l="OCTAL",c=this.input[this.pos]+this.input[this.pos+1],this.advance(2);En.test(this.input[this.pos]);)s+=this.input[this.pos],this.advance();break;case"B":case"b":for(r=2,l="BINARY",c=this.input[this.pos]+this.input[this.pos+1],this.advance(2);vn.test(this.input[this.pos]);)s+=this.input[this.pos],this.advance();break;default:I(this.input[this.pos+1])}else{for(;lt.test(this.input[this.pos]);)s+=this.input[this.pos],this.advance();if(this.input[this.pos]===".")for(o=!0,s+=".",this.advance();lt.test(this.input[this.pos]);)s+=this.input[this.pos],this.advance();if(this.input[this.pos]==="e"||this.input[this.pos]==="E")for(a=!0,s+=this.input[this.pos],this.advance(),(this.input[this.pos]==="+"||this.input[this.pos]==="-")&&(s+=this.input[this.pos],this.advance());lt.test(this.input[this.pos]);)s+=this.input[this.pos],this.advance()}let h=u.NUMBER,p;return this.input[this.pos]==="n"?(h=u.BIGINT,p=BigInt(c+s),s+="n",this.advance()):this.input[this.pos]==="m"?(h=u.DECIMAL,p=new w(s),s+="f",this.advance()):r===10&&(o||a)?p=parseFloat(s):(p=parseInt(s,r),isNaN(p)&&I("Expected a number but got NaN",this.currentPosition.getStartPos())),S.init(t,e,n,c+s,p,h,l)}parseLiteralOrOpenString(){const t=this.pos,e=this.row,n=this.col;let s="",r=!1;for(;!this.reachedEnd&&un(this.input[this.pos]);){let o=this.input[this.pos];if(G(o)){s+=this.skipWhitespaces();continue}if(o===b.MINUS&&this.input.substring(this.pos,this.pos+3)==="---")break;if(o===b.BACKSLASH)try{({value:s,needToNormalize:r}=this.escapeString(s,r));continue}catch{if(s+="\\",!this.reachedEnd){const c=this.input[this.pos];if(s+=c,c==="u"){this.advance();for(let l=0;l<4&&!this.reachedEnd;l++)s+=this.input[this.pos],this.advance();continue}else if(c==="x"){this.advance();for(let l=0;l<2&&!this.reachedEnd;l++)s+=this.input[this.pos],this.advance();continue}else this.advance()}continue}else s+=o,this.advance()}if(s=s.trimEnd(),r&&(s=s.normalize("NFC")),s==="")return null;switch(s){case R.TRUE:case R.T:return S.init(t,e,n,s,!0,u.BOOLEAN);case R.FALSE:case R.F:return S.init(t,e,n,s,!1,u.BOOLEAN);case R.NULL:case R.N:return S.init(t,e,n,s,null,u.NULL);case R.Inf:case R.NaN:return S.init(t,e,n,s,s===R.Inf?1/0:NaN,u.NUMBER);default:return S.init(t,e,n,s,s,u.STRING,"OPEN_STRING")}}mergeTokens(t,e){const n=new S;return n.pos=t.pos,n.row=t.row,n.col=t.col,n.token=t.token+e.token,n.value=t.token+e.value.toString(),n.type=e.type,n.subType=e.subType,n}skipWhitespaces(t=!1){const e=this.pos;for(;!this.reachedEnd&&G(this.input[this.pos],t);)this.input[this.pos]==="\r"?(this.input[this.pos+1]===`
`&&this.advance(),this.advance()):this.advance();if(e===this.pos)return"";let n=this.input.substring(e,this.pos);return n.includes("\r")&&(n=n.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),n}tokenize(){const t=Math.max(10,Math.floor(this.inputLength/8)),e=new Array(t);let n=0;for(;this.pos<this.inputLength;){const s=this.input.charCodeAt(this.pos);if(dn(s)){this.advance();continue}else if(s===v.HASH)this.parseSingleLineComment();else if(s===v.DOUBLE_QUOTE||s===v.SINGLE_QUOTE)e[n++]=this.parseRegularString(this.input[this.pos]);else if(this.isSpecialSymbolFast(s)){const r=this.row,o=this.col,a=this.input[this.pos];e[n++]=S.init(this.pos,r,o,a,a,this.getSymbolTokenTypeFast(s)),this.advance()}else if(s===v.PLUS||s===v.MINUS||s===v.DOT||fn(s)){if(s===v.MINUS&&this.input.substring(this.pos,this.pos+3)==="---"){n=this.parseSectionSeparator(e,n);continue}const r=this.parseNumber();if(r){const o=this.skipWhitespaces();if(this.reachedEnd)e[n++]=r;else if(!Lt(this.input[this.pos])&&!G(this.input[this.pos])){const a=this.parseLiteralOrOpenString();a?(a.type=u.STRING,a.subType="OPEN_STRING",o.length>0&&(a.token=o+a.token,a.value=o+a.value),e[n++]=this.mergeTokens(r,a)):e[n++]=r}else e[n++]=r}else{const o=this.parseLiteralOrOpenString();o&&(e[n++]=o)}}else{const r=this.checkIfAnotatedString();if(r)switch(r.name){case"r":e[n++]=this.parseRawString(r);break;case"b":e[n++]=this.parseByteString(r);break;case"d":case"dt":case"t":e[n++]=this.parseDateTime(r);break;default:const o=new g(f.unsupportedAnnotation,`Unsupported annotation '${r.name}'. Supported annotations are: 'r' (raw string), 'b' (binary), 'dt' (datetime), 'd' (date), 't' (time).`,this.currentPosition),a=this.input.substring(this.pos,this.pos+r.name.length+1);e[n++]=this.createErrorToken(o,this.pos,this.row,this.col,a),this.skipToNextTokenBoundary()}else{const o=this.parseLiteralOrOpenString();o&&(e[n++]=o)}}}return e.length=n,e}parseSectionSeparator(t,e){var s;t[e++]=S.init(this.pos,this.row,this.col,"---","---",u.SECTION_SEP),this.advance(3),this.skipWhitespaces(!0);const n=bn.exec(this.input.substring(this.pos));if(n){let r,o,a=(s=n.groups)==null?void 0:s.sep,c;if(n.groups&&(r=n.groups.schema,o=n.groups.name,c=n.groups.schema2),c)t[e++]=S.init(this.pos,this.row,this.col,c,c,u.STRING,u.SECTION_SCHEMA),this.advance(c.length),this.skipWhitespaces(!0);else if(o&&(t[e++]=S.init(this.pos,this.row,this.col,o,o,u.STRING,u.SECTION_NAME),this.advance(o.length),this.skipWhitespaces(!0),a)){if(this.advance(a.length),this.skipWhitespaces(!0),!r){const l=new g(f.schemaMissing,"Missing schema definition after section separator. Expected schema name starting with '$' (e.g., '$mySchema').",this.currentPosition);return t[e++]=this.createErrorToken(l,this.pos,this.row,this.col,""),e}t[e++]=S.init(this.pos,this.row,this.col,r,r,u.STRING,u.SECTION_SCHEMA),this.advance(r.length),this.skipWhitespaces(!0)}}return e}}class _n{constructor(t,e=[],n=[]){this.header=null,this.children=[],this.errors=[],this.header=t,this.children=e,this.errors=n}get firstChild(){return this.children.length>0?this.children[0]:null}getErrors(){return this.errors}toValue(t){var s;const e=((s=this.header)==null?void 0:s.toValue(t))??null,n=new yt;for(let r=0;r<this.children.length;r++)n.push(this.children[r].toValue(t));return new ut(e,n)}getStartPos(){return this.header?this.header.getStartPos():this.children.length>0?this.children[0].getStartPos():{row:0,col:0,pos:0}}getEndPos(){return this.children.length>0?this.children[this.children.length-1].getEndPos():this.header?this.header.getEndPos():{row:0,col:0,pos:0}}}class xn{constructor(t,e,n){this.type="section",this.child=t,this.nameNode=e,this.schemaNode=n}get name(){var t,e;return((t=this.nameNode)==null?void 0:t.value)||((e=this.schemaNode)==null?void 0:e.value.toString().substring(1))||"unnamed"}get schemaName(){var t;return((t=this.schemaNode)==null?void 0:t.value)||"$schema"}get firstChild(){return this.child}get firstChildObject(){return this.child instanceof x?this.child:this.child instanceof it&&this.child.children.length>0?this.child.children[0]:null}getStartPos(){var t;return((t=this.child)==null?void 0:t.getStartPos())??{row:0,col:0,pos:0}}getEndPos(){var t;return((t=this.child)==null?void 0:t.getEndPos())??{row:0,col:0,pos:0}}toValue(t){let e=null;return this.child&&(e=this.child.toValue(t)),new St(e,this.name,this.schemaName)}}class O{constructor(t){this.sectionNames={},this.errors=[],this.tokens=t,this.current=0}parse(){return this.processDocument()}createUnclosedConstructError(t,e,n,s){let r=null,o=this.current-1;for(;o>=0;){const a=this.tokens[o];if(a&&a.type!==u.COLLECTION_START&&a.type!==u.SECTION_SEP){r=a;break}o--}if(n&&r){const a=an(n,r);return new g(t,e,a,!1)}else return n?new g(t,e,n,!1):new g(t,e,void 0,!0)}processDocument(){const t=new Array;let e=null,n=this.peek(),s=!0;for(;;){s&&(n==null?void 0:n.type)===u.SECTION_SEP&&(s=!1);const r=this.processSection(s);if(n=this.peek(),!n){t.push(r);break}if(s?e=r:t.push(r),s&&(s=!1),n.type!==u.SECTION_SEP){const o=new g(f.unexpectedToken,`Expected section separator '---' but found '${n.token}'. Each section must be properly closed before starting a new one.`,n);this.errors.push(o);break}this.advance()}return new _n(e,t,this.errors)}processSection(t){var c;let e=this.peek();(e==null?void 0:e.type)===u.SECTION_SEP&&this.advance();const[n,s]=this.parseSectionAndSchemaNames();let r=(s==null?void 0:s.value)||(n==null?void 0:n.value.toString().substring(1))||"unnamed";const o=r;if(r&&this.sectionNames[r]){const l=new g(f.unexpectedToken,`Duplicate section name '${r}'. Each section must have a unique name within the document.`,void 0,!1);this.errors.push(l);let h=2;for(;this.sectionNames[`${o}_${h}`];)h++;r=`${o}_${h}`,s&&(s.value=r)}(!t||t&&r!=="unnamed"&&((c=this.peek())==null?void 0:c.type)!==u.SECTION_SEP)&&(this.sectionNames[r]=!0);const a=this.parseSectionContent();return new xn(a,s,n)}parseSectionAndSchemaNames(){let t=null,e=null,n=this.peek();return(n==null?void 0:n.subType)===u.SECTION_NAME?(e=n,this.advance(),n=this.peek(),(n==null?void 0:n.subType)===u.SECTION_SCHEMA&&(t=n,this.advance())):(n==null?void 0:n.subType)===u.SECTION_SCHEMA&&(t=n,this.advance(),n=this.peek()),[t,e]}parseSectionContent(){const t=this.peek();return!t||t.type===u.SECTION_SEP?null:t.type===u.COLLECTION_START?this.processCollection():this.processObject(!1)}processCollection(){const t=[];for(;this.match(O.COLLECTION_START_ARRAY);){this.advance(),this.current;const e=this.peek();if(e&&e.type===u.ERROR){const n=e.value,s=new D(n.originalError,e);this.errors.push(n.originalError),t.push(s),this.advance(),this.skipToNextCollectionItem();continue}try{t.push(this.processObject(!0))}catch(n){this.errors.push(n);let s={pos:-1,row:-1,col:-1},r;if(n&&typeof n=="object"&&"positionRange"in n){const o=n.positionRange;o&&o.getStartPos&&(s=o.getStartPos(),r=o.getEndPos?o.getEndPos():void 0)}if(s.pos===-1&&this.current>0&&this.current<=this.tokens.length){const o=this.tokens[this.current-1];o&&(s=o.getEndPos(),r=s)}t.push(new D(n,s,r)),this.skipToNextCollectionItem()}}return new it(t)}skipToNextCollectionItem(){for(;this.peek()&&!this.match(O.COLLECTION_OR_SECTION_ARRAY);)this.advance()}skipToNextSyncPoint(){for(;this.peek();){const t=this.peek();if(!t||hn(t.type))break;this.advance()}}processObject(t){const e=this.parseObject(!0),n=this.peek();if(this.checkForPendingTokens(n,t),e.children.length===1){const s=e.children[0];if(s&&!s.key&&s.value&&s.value instanceof x)return s.value}return e}checkForPendingTokens(t,e){if(t&&t.type!==u.SECTION_SEP&&!(e&&t.type===u.COLLECTION_START))throw new g(f.unexpectedToken,`Unexpected token '${t.value}'. Expected end of section or start of new collection item '~'.`,t,!1)}parseObject(t){const e=[];let n=this.peek();t&&(n=null),!t&&!this.advanceIfMatch(O.CURLY_OPEN_ARRAY)&&I("The caller must ensure that this function is called only when the next token is {");let s=0,r=!1;for(;!r;){const o=this.peek();if(!o||this.match([u.CURLY_CLOSE,u.COLLECTION_START,u.SECTION_SEP])){r=!0;break}else if(o.type===u.COMMA){this.matchNext([u.COMMA,u.CURLY_CLOSE,u.COLLECTION_START,u.SECTION_SEP])?this.pushUndefinedMember(e,o):this.current+1===this.tokens.length&&this.pushUndefinedMember(e,o),this.advance();continue}else{if(s>0&&!this.matchPrev([u.COMMA,u.CURLY_OPEN]))throw new g(f.unexpectedToken,`Missing comma before '${o.value}'. Object members must be separated by commas.`,o,!1);const a=this.parseMember();e.push(a),s++}}if(t)return new x(e);{if(!this.match(O.CURLY_CLOSE_ARRAY))throw this.createUnclosedConstructError(f.expectingBracket,"Missing closing brace '}'. Object must be properly closed.",n,e);let o=this.peek();return this.advance(),new x(e,n,o)}}parseMember(){const t=this.peek();if(t||I("The caller must ensure that this function is called only when the member has at least one token"),this.matchNext(O.COLON_ARRAY))if(O.VALID_KEY_TYPES.includes(t.type)){this.advance(2);const n=this.parseValue();return new z(n,t)}else throw new g(f.invalidKey,`Invalid key '${t.token}'. Object keys must be strings, numbers, booleans, or null.`,t,!1);return new z(this.parseValue())}parseArray(){const t=[],e=this.peek();if(!e||e.type!==u.BRACKET_OPEN)throw new g(f.expectingBracket,`Expected opening bracket '[' to start array but found '${(e==null?void 0:e.token)||"end of input"}'.`,e===null?void 0:e,e===null);for(this.advance();;){const s=this.peek();if(!s)throw this.createUnclosedConstructError(f.expectingBracket,"Unexpected end of input while parsing array. Expected closing bracket ']'.",e,t);if(s.type===u.BRACKET_CLOSE)break;if(s.type===u.COLLECTION_START||s.type===u.SECTION_SEP)throw this.createUnclosedConstructError(f.expectingBracket,"Missing closing bracket ']'. Array must be properly closed.",e,t);if(s.type===u.COMMA){if(this.matchNext([u.COMMA,u.BRACKET_CLOSE])){const o=this.tokens[this.current+1];throw new g(f.unexpectedToken,"Unexpected comma. Array elements cannot be empty - remove the extra comma or add a value.",o,!1)}this.advance();continue}const r=this.parseMember();r.key?t.push(new x([r])):t.push(r.value)}if(!this.match(O.BRACKET_CLOSE_ARRAY))throw this.createUnclosedConstructError(f.expectingBracket,"Missing closing bracket ']'. Array must be properly closed.",e,t);const n=this.peek();return this.advance(),new J(t,e,n)}parseValue(){const t=this.peek();if(!t)throw new g(f.valueRequired,"Unexpected end of input. Expected a value (string, number, boolean, null, array, or object).",void 0,!0);switch(t.type){case u.STRING:case u.NUMBER:case u.BIGINT:case u.DECIMAL:case u.BOOLEAN:case u.NULL:case u.DATETIME:{const e=new E(t);return this.advance(),e}case u.BRACKET_OPEN:return this.parseArray();case u.CURLY_OPEN:return this.parseObject(!1);case u.ERROR:{const e=t.value,n=new D(e.originalError,t);return this.errors.push(e.originalError),this.advance(),this.skipToNextSyncPoint(),n}default:throw new g(f.unexpectedToken,`Unexpected token '${t.value}'. Expected a valid value (string, number, boolean, null, array, or object).`,t,t===null)}}pushUndefinedMember(t,e){const n=e.clone();n.type=u.UNDEFINED,n.value=void 0;const s=new z(new E(n));t.push(s)}isValidToken(t){return t!==null}peek(){return this.current<this.tokens.length?this.tokens[this.current]:null}advance(t=1){this.current+=t}match(t){const e=this.peek();return!!(this.isValidToken(e)&&t.includes(e.type))}matchPrev(t){const e=this.tokens[this.current-1];return!!(this.isValidToken(e)&&t.includes(e.type))}matchNext(t){if(this.current+1>=this.tokens.length)return!1;const e=this.tokens[this.current+1];return!!(this.isValidToken(e)&&t.includes(e.type))}advanceIfMatch(t){return this.match(t)?(this.advance(),!0):!1}}O.CURLY_OPEN_ARRAY=[u.CURLY_OPEN];O.CURLY_CLOSE_ARRAY=[u.CURLY_CLOSE];O.BRACKET_OPEN_ARRAY=[u.BRACKET_OPEN];O.BRACKET_CLOSE_ARRAY=[u.BRACKET_CLOSE];O.COLLECTION_START_ARRAY=[u.COLLECTION_START];O.SECTION_SEP_ARRAY=[u.SECTION_SEP];O.COMMA_ARRAY=[u.COMMA];O.COLON_ARRAY=[u.COLON];O.COLLECTION_OR_SECTION_ARRAY=[u.COLLECTION_START,u.SECTION_SEP];O.VALID_KEY_TYPES=[u.STRING,u.NUMBER,u.BOOLEAN,u.NULL];function ae(i,t,e={}){var l;const s=new On(i).tokenize();if(s.length===0)return new ut(new xt,new yt);const o=new O(s).parse(),a=o.getErrors(),c=new ut(new xt,new yt,a);if(o.header){if(o.header.child){if(o.header.child instanceof x){const h=Ot("schema",o.header.child);h instanceof N?((l=c.header.definitions)==null||l.push("$schema",h,!0),c.header.schema=h):I(h)}else o.header.child instanceof it?Rn(c,o.header.child):I(o.header.child);t&&c.header.definitions.merge(t,!1)}else t&&c.header.definitions.merge(t,!1);Mt(o,c)}else t&&c.header.definitions.merge(t,!1),Mt(o,c);return c}function In(i,t){var e,n;for(let s=0;s<i.children.length;s++){const r=i.children[s];(n=t.sections)==null||n.push(new St((e=r.child)==null?void 0:e.toValue(t.header.definitions||void 0),r.name))}}function Mt(i,t){var s,r;const e=i.children.length;if(e===0)return;const n=[];for(let o=0;o<e;o++){const a=i.children[o],c=a.schemaName,l=c?c==="$schema"?t.header.schema:(s=t.header.definitions)==null?void 0:s.getV(a.schemaNode):t.header.schema;if(!l){In(i,t);continue}const h=Vt(a.child,l,t.header.definitions||void 0,n);(r=t.sections)==null||r.push(new St(h,a.name,c))}n.length>0&&t.addErrors(n)}function Rn(i,t){const e=i.header.definitions;if(!e)throw new Error("Document header definitions not initialized. This is an internal error - please report this issue.");const n=[];for(let s=0;s<t.children.length;s++){const r=t.children[s];if(!r)continue;if(r instanceof D)throw new k(f.invalidDefinition,`Invalid definition: ${r.error.message}`,r);r instanceof x||I("Invalid definition, must be object");const o=r;o.children[0]===null&&I("Invalid definition"),o.children.length;const a=o.children[0];if(!a.key)throw new k(f.invalidDefinition,"Invalid definition: missing key. Each definition must have a key (e.g., '$schema: {...}' or '@variable: value').",a.value);const c=a.key;if(c.type!==u.STRING)throw new Error("Invalid typedef definition: key must be a string.");let l=c.value;if(l.startsWith("$")){e.push(l,a.value,!0),n.push({key:l,schemaDef:a.value});continue}if(l.startsWith("@")){e.push(l,a.value,!1,!0);continue}let h=o.children[0].value;e.push(l,h.toValue(i.header.definitions||void 0))}for(let s=0;s<n.length;s++){const{key:r,schemaDef:o}=n[s],a=Ot(r,o,e);e.set(r,a)}}function Cn(i,t,e){return i=i.trim(),i?(i.endsWith("---")||(i+=`
---`),ae(i,t,e).header.definitions):null}const tt={Warning:4,Error:8};function kn(i){switch(i){case"syntax":return tt.Error;case"validation":return tt.Warning;case"runtime":return tt.Error;default:return tt.Error}}function ce(i,t){return`${i.startLine}:${i.startColumn}-${i.endLine}:${i.endColumn}:${t.substring(0,20)}`}function An(i){return i&&i.type==="parse"&&typeof i.id=="string"}self.addEventListener("message",i=>{const t=i.data;if(!An(t)){console.error("Invalid message received by parser worker:",t);return}try{const e=$n(t.documentText,t.schemaText,t.skipErrors,t.minifiedOutput),n={type:"result",id:t.id,result:e};self.postMessage(n)}catch(e){const n={type:"error",id:t.id,error:(e==null?void 0:e.message)||String(e)};self.postMessage(n)}});function $n(i,t,e,n){if(!t)return Ut(i,null,e,n);const s=le(t,Cn,!0,e);return s.errorMessages.length>0?{...s,jsonText:"",error:!0}:Ut(i,s.defs,e,n)}function le(i,t,e=!1,n=!1){try{const s=t(i,null);let r=[];s&&typeof s.getErrors=="function"&&(r=s.getErrors());const o=e?null:s.toJSON({skipErrors:n}),a=e?s:null;if(r.length>0){const c=e?"defs":"doc",l=r.map(h=>jt(h,c)).filter(h=>h!==null);return{errorMessages:r.map(h=>Bt(h)),errorItems:l,defs:a,output:o,defsMarkers:e?r.flatMap(et):[],docMarkers:e?[]:r.flatMap(et)}}return{errorMessages:[],errorItems:[],defs:a,output:o,defsMarkers:[],docMarkers:[]}}catch(s){const o=jt(s,e?"defs":"doc");return{errorMessages:[Bt(s)],errorItems:o?[o]:[],defs:null,output:null,defsMarkers:e?et(s):[],docMarkers:e?[]:et(s)}}}function Ut(i,t,e,n){const s=le(i,c=>ae(c,t),!1,e),r=s.errorMessages.length>0;let o="",a=!1;return s.output?(o=JSON.stringify(s.output,function(c,l){return typeof l=="bigint"?`io:big:${l.toString()}`:typeof l=="number"&&isNaN(l)?"io:number:NaN":l instanceof w?`io:decimal:${l.toString()}`:l===1/0?"io:number:Inf":l===-1/0?"io:number:-Inf":typeof l>"u"?"io:undefined":l},n?0:2),a=r):r&&(o="",a=!0),{errorMessages:s.errorMessages,errorItems:s.errorItems,docMarkers:s.docMarkers,defsMarkers:s.defsMarkers,jsonText:o,error:a}}function Bt(i){return i instanceof g?"SYNTAX_ERROR: "+((i==null?void 0:i.message)||String(i)):i instanceof y?"VALIDATION_ERROR: "+((i==null?void 0:i.message)||String(i)):"ERROR: "+((i==null?void 0:i.message)||String(i))}function ue(i){return i instanceof g?"syntax":i instanceof y?"validation":"runtime"}function he(i){var n,s;if(!(i instanceof k))return null;const t=(n=i.positionRange)==null?void 0:n.getStartPos(),e=(s=i.positionRange)==null?void 0:s.getEndPos();return!t||!e?null:{startLine:t.row,startColumn:t.col,endLine:e.row,endColumn:e.col}}function jt(i,t){const e=he(i);if(!e)return null;const n=ue(i),s=(i==null?void 0:i.message)||String(i);return{id:ce(e,s),code:i.code,category:n,message:s,range:e,source:t}}function et(i){if(!(i instanceof k))return[];const t=he(i);if(!t)return[];const e=ue(i),n=kn(e),s=(i==null?void 0:i.message)||String(i);return[{message:s,severity:n,startLineNumber:t.startLine,startColumn:t.startColumn,endLineNumber:t.endLine,endColumn:t.endColumn,id:ce(t,s),category:e}]}
//# sourceMappingURL=parser.worker-BP1_IiAL.js.map
