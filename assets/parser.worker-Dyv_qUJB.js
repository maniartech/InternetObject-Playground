class dt{constructor(t,e,n=[]){this._ownErrors=[],this._header=t,this._sections=e,this._ownErrors=n}get header(){return this._header}get sections(){return this._sections}get errors(){const t=[...this._ownErrors];if(this._sections)for(const e of this._sections)t.push(...e.errors);return t}getErrors(){return this.errors}addErrors(t){t.length>0&&this._ownErrors.push(...t)}toJSON(t){var r,o,a;const e=((r=this._sections)==null?void 0:r.length)||0;let n=null;if(e===1)n=((o=this._sections)==null?void 0:o.get(0)).toJSON(t);else if(e>1){n={};for(let c=0;c<e;c++){const l=(a=this._sections)==null?void 0:a.get(c);n[l.name]=l.toJSON(t)}}const i=this.header.toJSON();return i&&Object.keys(i).length>0?{header:i,data:n}:n}toObject(t){return this.toJSON(t)}}var gt;(function(s){s.invalidType="invalid-type",s.invalidValue="invalid-value",s.valueRequired="value-required",s.nullNotAllowed="null-not-allowed",s.definitionsRequired="definitions-required",s.expectedObject="expected-object",s.expectedArray="expected-array"})(gt||(gt={}));var yt;(function(s){s.stringNotClosed="string-not-closed",s.invalidEscapeSequence="invalid-escape-sequence",s.unsupportedAnnotation="unsupported-annotation",s.invalidDateTime="invalid-datetime"})(yt||(yt={}));var mt;(function(s){s.unexpectedToken="unexpected-token",s.expectingBracket="expecting-bracket",s.unexpectedPositionalMember="unexpected-positional-member",s.invalidKey="invalid-key",s.invalidSchema="invalid-schema",s.schemaNotFound="schema-not-found",s.schemaMissing="schema-missing",s.emptyMemberDef="empty-memberdef",s.invalidDefinition="invalid-definition",s.invalidMemberDef="invalid-memberdef",s.invalidSchemaName="invalid-schema-name",s.variableNotDefined="variable-not-defined",s.schemaNotDefined="schema-not-defined"})(mt||(mt={}));var wt;(function(s){s.invalidObject="invalid-object",s.unknownMember="unknown-member",s.duplicateMember="duplicate-member",s.additionalValuesNotAllowed="additional-values-not-allowed",s.invalidArray="invalid-array",s.notAnArray="not-an-array",s.notAString="not-a-string",s.invalidEmail="invalid-email",s.invalidUrl="invalid-url",s.invalidLength="invalid-length",s.invalidMinLength="invalid-min-length",s.invalidMaxLength="invalid-max-length",s.invalidPattern="invalid-pattern",s.unsupportedNumberType="unsupported-number-type",s.notANumber="not-a-number",s.notAnInteger="not-an-integer",s.outOfRange="out-of-range",s.invalidRange="invalid-range",s.invalidScale="invalid-scale",s.invalidPrecision="invalid-precision",s.notABool="not-a-bool",s.invalidChoice="invalid-choice"})(wt||(wt={}));const f={...gt,...yt,...mt,...wt};var it=function(s,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!n:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(s):n?n.value:t.get(s)},Ct=function(s,t,e,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!i:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(s,e):i?i.value=e:t.set(s,e),e},j;class $ extends Error{get positionRange(){return it(this,j,"f")}set positionRange(t){Ct(this,j,t,"f"),this.updateMessage()}get code(){return this.errorCode}get position(){return it(this,j,"f")}constructor(t,e,n,i=!1,r){super(),j.set(this,void 0),this.errorCode=t,this.fact=e,Ct(this,j,n,"f"),this.isEof=i,this.name="IOError",this.updateMessage(),this.__proto__=new.target.prototype}updateMessage(){let t=`"${this.errorCode}" `;if(this.fact&&(t+=`"${this.fact}" `),this.isEof)t+="at EOF";else if(it(this,j,"f")){const e=it(this,j,"f");if(typeof e.getStartPos=="function"){const n=e.getStartPos();t+=`at ${n.row}:${n.col}`}else typeof e.row=="number"&&typeof e.col=="number"&&(t+=`at ${e.row}:${e.col}`)}this.message=t}}j=new WeakMap;class d extends ${constructor(t,e,n,i=!1,r){super(t,e,n,i,r),this.name="InternetObject(ValidationError)"}}var h;(function(s){s.CURLY_OPEN="CURLEY_OPEN",s.CURLY_CLOSE="CURLY_CLOSE",s.BRACKET_OPEN="BRACKET_OPEN",s.BRACKET_CLOSE="BRACKET_CLOSE",s.COLON="COLON",s.COMMA="COMMA",s.STRING="STRING",s.BINARY="BINARY",s.NUMBER="NUMBER",s.BIGINT="BIGINT",s.DECIMAL="DECIMAL",s.BOOLEAN="BOOLEAN",s.NULL="NULL",s.UNDEFINED="UNDEFINED",s.DATETIME="DATETIME",s.DATE="DATE",s.TIME="TIME",s.WHITESPACE="WHITESPACE",s.SECTION_SEP="SECTION_SEP",s.SECTION_SCHEMA="SECTION_SCHEMA",s.SECTION_NAME="SECTION_NAME",s.COLLECTION_START="COLLECTION_START",s.UNKNOWN="UNKNOWN",s.ERROR="ERROR"})(h||(h={}));class b{constructor(){this.pos=-1,this.row=-1,this.col=-1,this.token="",this.value=void 0,this.type="",this.subType=""}static init(t,e,n,i,r,o,a){const c=new b;return c.pos=t,c.row=e,c.col=n,c.token=i,c.value=r,c.type=o,a&&(c.subType=a),c}clone(){const t=new b;return t.pos=this.pos,t.row=this.row,t.col=this.col,t.token=this.token,t.value=this.value,t.type=this.type,t.subType=this.subType,t}getStartPos(){return{row:this.row,col:this.col,pos:this.pos}}getEndPos(){const t=this.token.trimEnd(),e=t.split(`
`),n=e[e.length-1],i=this.row+e.length-1,r=e.length>1?n.length:this.col+n.length,o=this.pos+t.length;return{row:i,col:r,pos:o}}}class w extends b{constructor(t){super(),Object.assign(this,t)}toValue(t){if((this.type==="string"||this.type===h.STRING)&&t!==void 0){const e=t.getV(this.value);return e===void 0?this.value:e}return this.value}}class N{constructor(t,...e){this.names=[],this.defs={},this.open=!1,this.name=t,e&&e.length>0&&e.forEach(n=>{const i=Object.keys(n)[0],r=n[i];r.path===void 0&&(r.path=i),this.names.push(i),this.defs[i]=r})}get(t){return this.defs[t]}has(t){return this.defs[t]!==void 0}get memberCount(){return this.names.length}static create(t){return new Se(t)}static fromLegacy(t,...e){return new N(t,...e)}}class Se{constructor(t){this.name=t,this.names=[],this.defs={},this.isOpen=!1}addMember(t,e){if(this.defs[t])throw new $(f.duplicateMember,`Member '${t}' already exists in schema '${this.name}'`);return this.names.push(t),this.defs[t]={...e,path:e.path||t},this}setOpen(t){return this.isOpen=t,this}build(){const t=new N(this.name);for(const e of this.names)t.names.push(e),t.defs[e]=this.defs[e];return t.open=this.isOpen,Object.freeze(t.names),Object.freeze(t.defs),t}}class Et{constructor(){this._defaultSchema=null,this._definitions={}}get length(){return Object.keys(this._definitions).length}get keys(){return Object.keys(this._definitions)}at(t){const e=this.keys[t];return{key:e,value:this._definitions[e]}}get defaultSchema(){var t;return this._defaultSchema||((t=this._definitions.$schema)==null?void 0:t.value)||null}get defaultSchemaOnly(){const t=Object.keys(this._definitions);return t.length===1&&t[0]==="$schema"}get(t){var e;return(e=this._definitions[t])==null?void 0:e.value}getV(t){let e="";if((t||{}).type===h.STRING||(t||{}).type==="string")e=t.value;else if(typeof t=="string")e=t;else return;const n=this._definitions[e];if(!n){if(e.startsWith("$")||e.startsWith("@")){const i=typeof t=="string"?void 0:t;throw e.startsWith("$")?new d(f.schemaNotDefined,`Schema ${e} is not defined.`,i):new d(f.variableNotDefined,`Variable ${e} is not defined.`,i)}return}if(n.isVariable)return n.value;if(n.value instanceof w){const i=this.getV(n.value);if(i instanceof N)return this.set(e,i),i}return n.value}set(t,e){const n={isSchema:t.startsWith("$"),isVariable:t.startsWith("@"),value:e};this._definitions[t]=n,this._defaultSchema=null}delete(t){return t in this._definitions?(delete this._definitions[t],t==="$schema"&&(this._defaultSchema=null),!0):!1}push(t,e,n=!1,i=!1){this._definitions[t]={isSchema:n,isVariable:i,value:e},t==="$schema"&&(this._defaultSchema=e)}merge(t,e=!1){for(let n=0;n<t.length;n++){const{key:i,value:r}=t.at(n);(e||!this._definitions[i])&&this.push(i,r.value,r.isSchema,r.isVariable)}}toJSON(){var n;const t={};let e=0;for(let i=0;i<this.length;i++){const r=this.at(i);r.value.isSchema||r.value.isVariable||(e++,t[r.key]=(n=r.value.value)!=null&&n.toObject?r.value.value.toObject():r.value.value)}return e?t:null}*keyIterator(){for(const t of Object.keys(this._definitions))yield t}*entries(){for(const t of this.keyIterator())yield[t,this._definitions[t]]}*[Symbol.iterator](){yield*this.entries()}}class Mt{constructor(){this._schema=null,this._definitions=new Et}get schema(){return this._schema||this._definitions.defaultSchema}set schema(t){this._schema=t}get definitions(){return this._definitions}merge(t,e=!1){e&&t.schema&&(this._schema=t.schema),t.definitions&&this._definitions.merge(t.definitions,e)}toJSON(){return this._definitions.toJSON()}}function R(s,t){let e="Assert never";throw s!=null&&(e=`Assert never: ${s.toString()}`),t&&(e+=` at ${t.toString()}`),new Error(e)}class U{constructor(t){if(this.errors=[],Object.defineProperty(this,"items",{value:[],writable:!0,enumerable:!1,configurable:!1}),Object.defineProperty(this,"keyMap",{value:new Map,writable:!0,enumerable:!1,configurable:!1}),Object.defineProperty(this,"errors",{value:[],writable:!0,enumerable:!1,configurable:!1}),t)for(const[e,n]of Object.entries(t))this.set(e,n)}set(t,e){if(this.keyMap.has(t)){const n=this.keyMap.get(t);this.items[n]=[t,e]}else{const n=this.items.length;this.items.push([t,e]),this.keyMap.set(t,n)}return t!=="items"&&t!=="keyMap"&&Object.defineProperty(this,t,{value:e,writable:!0,enumerable:!0,configurable:!0}),this}push(...t){for(const e of t)if(Array.isArray(e)){const[n,i]=e;if(this.has(n))throw new Error(`Key '${n}' already exists`);const r=this.items.length;this.items.push([n,i]),this.keyMap.set(n,r)}else this.items.push([void 0,e])}get(t){const e=this.keyMap.get(t);if(e!==void 0){const n=this.items[e];return n?n[1]:void 0}}getAt(t){if(t<0||t>=this.items.length)return;const e=this.items[t];return e?e[1]:void 0}keyAt(t){if(t<0||t>=this.items.length)return;const e=this.items[t];return e?e[0]:void 0}has(t){return this.keyMap.has(t)}delete(t){const e=this.keyMap.get(t);return e!==void 0&&this.items[e]?(this.items[e]=void 0,this.keyMap.delete(t),delete this[t],!0):!1}deleteAt(t){if(t<0||t>=this.items.length)throw new Error("Index out of range");const e=this.items[t];if(e){const n=e[0];return n!==void 0&&this.keyMap.delete(n),this.items[t]=void 0,!0}return!1}setAt(t,e){if(t<0||t>=this.items.length)throw new Error("Index out of range");const n=this.items[t];return n?(this.items[t]=[n[0],e],!0):!1}indexOfKey(t){return this.keyMap.get(t)??-1}indexOf(t){return this.items.findIndex(e=>e!==void 0&&Object.is(e[1],t))}isEmpty(){return this.length===0}static fromArray(t){const e=new U;for(const n of t)Array.isArray(n)?e.set(n[0],n[1]):e.push(n);return e}get length(){return this.items.length}clear(){for(const t of this.keysArray())delete this[t];this.items=[],this.keyMap.clear()}compact(){const t=[],e=new Map;for(const n of this.items)if(n!==void 0){t.push(n);const i=n[0];i!==void 0&&e.set(i,t.length-1)}this.items=t,this.keyMap=e}forEach(t,e){for(let n=0;n<this.items.length;n++){const i=this.items[n];i!==void 0&&t.call(e,i[1],i[0],n)}}entries(){return this._createIterator(t=>t)}keysArray(){return this.items.filter(t=>t!==void 0&&t[0]!==void 0).map(t=>t[0])}keys(){return(function*(t){for(const e of t)e!==void 0&&e[0]!==void 0&&(yield e[0])})(this.items)}values(){return(function*(t){for(const e of t)e!==void 0&&(yield e[1])})(this.items)}valuesArray(){return this.items.filter(t=>t!==void 0).map(t=>t[1])}*_createIterator(t){for(const e of this.items)e!==void 0&&(yield t(e))}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"IOObject"}find(t){let e=0;for(const n of this.items){if(n!==void 0&&t(n[1],n[0],e))return n[1];e++}}findIndex(t){let e=0;for(const n of this.items){if(n!==void 0&&t(n[1],n[0],e))return e;e++}return-1}map(t,e){const n=[];let i=0;for(const r of this.items)r!==void 0&&n.push(t.call(e,r[1],r[0],i)),i++;return n}toJSON(){const t={};return this.forEach((e,n,i)=>{typeof e>"u"||(t[n||i]=typeof e=="object"&&typeof(e==null?void 0:e.toJSON)=="function"?e.toJSON():e)}),t}}class F{constructor(t=[]){this.errors=[],this._items=t}push(...t){return this._items.push(...t),this}getAt(t){if(t<0||t>=this._items.length)throw new Error("Index out of range");return this._items[t]}setAt(t,e){if(t<0)throw new Error("Index cannot be negative.");return t>=this._items.length?this._items.push(e):this._items[t]=e,this}deleteAt(t){if(t<0||t>=this._items.length)throw new Error("Index out of range");return this._items.splice(t,1),this}get length(){return this._items.length}get isEmpty(){return this.length===0}map(t){const e=this._items.map(t);return new F(e)}filter(t){const e=this._items.filter(t);return new F(e)}reduce(t,e){return this._items.reduce(t,e)}forEach(t){this._items.forEach(t)}some(t){return this._items.some(t)}every(t){return this._items.every(t)}find(t){return this._items.find(t)}findIndex(t){return this._items.findIndex(t)}insert(t,...e){return this._items.splice(t,0,...e),this._items.length}pop(){return this._items.pop()}toJSON(t){const e=(t==null?void 0:t.skipErrors)??!1;return this._items.filter(n=>{if(e&&typeof n=="object"&&n!==null&&typeof n.toValue=="function"){const i=n.toValue();if(i&&i.__error===!0)return!1}return!0}).map(n=>n instanceof U?n.toJSON():typeof n=="object"&&n!==null?typeof n.toValue=="function"?n.toValue():typeof n.toJSON=="function"?n.toJSON():JSON.stringify(n):n)}getErrors(){const t=[];for(const e of this._items)e&&typeof e=="object"&&e.error instanceof Error&&t.push(e.error);return t}*[Symbol.iterator](){yield*this._items}*entries(){for(let t=0;t<this._items.length;t++)yield[t,this._items[t]]}*keys(){for(let t=0;t<this._items.length;t++)yield t}*values(){yield*this._items}}function Ne(s){return s<0n?-s:s}const ht=new Map;function J(s){if(s<0)throw new Error("Exponent must be non-negative");return ht.has(s)||ht.set(s,10n**BigInt(s)),ht.get(s)}function W(s,t){if(t<0)throw new Error(`Scale factor must be non-negative, got ${t}`);return t===0?s:s*J(t)}function K(s,t,e){if(t<0||e<0)throw new Error("Scales must be non-negative");if(t<=e)return W(s,e-t);const n=t-e,i=J(n),r=s/i,o=s%i,a=i/2n;return(o<0n?-o:o)>=a?r+(s>=0n?1n:-1n):r}function vt(s,t,e){if(t<0||e<0)throw new Error("Scales must be non-negative");if(t<=e)return W(s,e-t);const n=t-e,i=J(n),r=s/i;return s%i!==0n&&s>0n?r+1n:r}function St(s,t,e){if(t<0||e<0)throw new Error("Scales must be non-negative");if(t<=e)return W(s,e-t);const n=t-e,i=J(n),r=s/i;return s%i!==0n&&s<0n?r-1n:r}function M(s,t,e){if(s===0n)return t>0?`0.${"0".repeat(t)}`:"0";const n=s<0n?"-":"";let r=(s<0n?-s:s).toString();for(;r.length<=t;)r="0"+r;const o=r.slice(0,r.length-t)||"0",a=t>0?r.slice(-t):"";return n+o+(t>0?"."+a:"")}function Te(s,t,e){if(t<=0)return{valid:!1,reason:"Precision must be positive"};if(e<0)return{valid:!1,reason:"Scale must be non-negative"};if(e>t)return{valid:!1,reason:"Scale must be less than or equal to precision"};if(s===0n)return{valid:!0};const i=Ne(s).toString();return i.length>t?{valid:!1,reason:`Coefficient has ${i.length} digits, exceeding precision of ${t}`}:i.length-e<0?{valid:!0}:{valid:!0}}function ft(s,t,e,n,i,r="round"){if(s===0n)return{a:0n,b:e,targetScale:n,scaleAdjustment:0};if(e===0n)return{a:s,b:0n,targetScale:t,scaleAdjustment:0};let o=Math.max(t,n);i!==void 0&&o>i&&(o=i);const a=o-t,c=o-n;let l=s,u=e;if(a>0&&(l=W(s,a)),c>0&&(u=W(e,c)),i!==void 0){if(t>i)switch(r){case"round":l=K(s,t,i);break;case"ceil":l=vt(s,t,i);break;case"floor":l=St(s,t,i);break;default:throw new y(`Invalid rounding mode: ${r}`)}if(n>i)switch(r){case"round":u=K(e,n,i);break;case"ceil":u=vt(e,n,i);break;case"floor":u=St(e,n,i);break;default:throw new y(`Invalid rounding mode: ${r}`)}}return{a:l,b:u,targetScale:o,scaleAdjustment:Math.max(a,c)}}function be(s,t,e,n){if(s<=0||e<=0)throw new y("Precision must be positive");if(t<0||n<0)throw new y("Scale must be non-negative");if(t>s||n>e)throw new y("Scale must not exceed precision");const i=Math.max(t,n),r=s-t,o=e-n;return{precision:Math.max(r,o)+i+1,scale:i}}function Oe(s,t,e,n){if(s<=0||e<=0)throw new y("Precision must be positive");if(t<0||n<0)throw new y("Scale must be non-negative");if(t>s||n>e)throw new y("Scale must not exceed precision");const i=t+n;return{precision:s+e+1,scale:i}}function xe(s,t,e,n,i=6){if(s<=0||e<=0)throw new y("Precision must be positive");if(t<0||n<0)throw new y("Scale must be non-negative");if(t>s||n>e)throw new y("Scale must not exceed precision");if(i<0)throw new y("Minimum scale must be non-negative");const r=t+e+1,o=Math.max(i,r);return{precision:s-t+n+o,scale:o}}function _e(s,t,e=38,n){const i=n??e;if(s<=0)throw new y("Precision must be positive");if(t<0)throw new y("Scale must be non-negative");if(t>s)throw new y("Scale must not exceed precision");if(s<=e&&t<=i)return{precision:s,scale:t};let r=Math.min(s,e),o=Math.min(t,i);return o>r&&(o=Math.max(0,r-1)),o>=r&&(o=Math.max(0,r-1)),{precision:r,scale:o}}function Lt(s,t,e,n,i,r){let o;switch(s){case"add":case"subtract":o=be(t,e,n,i);break;case"multiply":o=Oe(t,e,n,i);break;case"divide":o=xe(t,e,n,i,r==null?void 0:r.divisionMinScale);break;default:throw new y(`Unsupported operation: ${s}`)}return _e(o.precision,o.scale,r==null?void 0:r.maxPrecision,r==null?void 0:r.maxScale)}class y extends Error{constructor(t){super(t),this.name="DecimalError"}}class S{constructor(t,e,n){this.coefficient=0n,this.exponent=0,[e,n]=this.resolvePrecisionAndScale(t,e,n),this.precision=e,this.scale=n,this.validatePrecisionAndScale(e,n);let i;if(typeof t=="string")i=this.initFromString(t,e,n);else if(typeof t=="number")i=this.initFromNumber(t,e,n);else if(t instanceof S)i=this.initFromDecimal(t,e,n);else throw new y("Unsupported value type for Decimal constructor.");this.coefficient=i.coefficient,this.exponent=i.exponent}resolvePrecisionAndScale(t,e,n){if(typeof t=="number"){if(e===void 0||n===void 0)throw new y("Precision and scale must be provided for number type.");return[e,n]}if(t instanceof S)return(e===void 0||n===void 0)&&(e=t.getPrecision(),n=t.getScale()),[e,n];if(typeof t=="string"){if(e===void 0||n===void 0){const i=/^-?(\d+)(?:\.(\d+))?$/,r=t.trim().match(i);if(!r)throw new y("Invalid decimal string format.");const o=r[1],a=r[2]||"";e=(o.replace(/^0+/,"").length||0)+a.length,n=a.length,e===0&&(e=1)}return[e,n]}throw new y("Unsupported value type for Decimal constructor.")}validatePrecisionAndScale(t,e){const n=Te(1n,t,e);if(!n.valid)throw new y(n.reason||"Invalid precision or scale")}initFromString(t,e,n){if(!S.isValidDecimal(t))throw new y("Invalid decimal string format.");const{sign:i,integerPart:r,fractionalPart:o}=S.parseString(t);let a=r,c=o;if(o.length>n){const v=S.roundForDecimal(r+"."+o,e,n);a=v.integerPart,c=v.fractionalPart}else c=o.padEnd(n,"0");const l=a.replace(/^0+/,"")||"0",p=(l+c).replace(/^0+/,"")||"0";if(p.length>e){const v=S.roundForDecimal(l+"."+c,e,n),C=v.integerPart+v.fractionalPart;if(C.replace(/^0+/,"").length>e)throw new y(`Value '${t}' exceeds specified precision (${e}) after rounding.`);const k=BigInt(C);return{coefficient:i==="-"?-k:k,exponent:n}}const g=BigInt(p);return{coefficient:i==="-"?-g:g,exponent:n}}initFromNumber(t,e,n){return this.initFromString(t.toString(),e,n)}initFromDecimal(t,e,n){t.getPrecision();const i=t.getScale(),r=t.getCoefficient(),o=e-n,c=t.toString().split(".")[0].replace("-","").length;if(c>o)throw new y(`Cannot adjust precision: integer part needs ${c} digits, but target precision-scale only allows ${o}.`);return n>i?this.increaseScaleForDecimal(t,e,n,i,r):n<i?this.decreaseScaleForDecimal(t,e,n,i,r):this.sameScaleForDecimal(t,e,n,r)}increaseScaleForDecimal(t,e,n,i,r){const o=n-i,a=W(r,o);if(a.toString().replace("-","").length>e)throw new y(`Value exceeds the specified precision (${e}) after scaling.`);return{coefficient:a,exponent:n}}decreaseScaleForDecimal(t,e,n,i,r){const o=K(r,i,n);return o.toString().replace("-","").length,{coefficient:o,exponent:n}}sameScaleForDecimal(t,e,n,i){if(t.getTotalDigits()>e)throw new y(`Value exceeds the specified precision (${e}).`);return{coefficient:i,exponent:n}}static roundForDecimal(t,e,n){const[i="0",r=""]=t.split("."),o=r.length,a=BigInt((i||"0")+(r||"")),c=K(a,o,n),l=M(c,n),[u,p=""]=l.split(".");return{integerPart:u,fractionalPart:p}}getTotalDigits(){return this.coefficient.toString().replace("-","").length}static isValidDecimal(t){let e=t.trim();return e.endsWith("m")&&(e=e.slice(0,-1)),/^[+\-]?\d+(\.\d+)?([eE][+-]?\d+)?$/.test(e)}static parseString(t){let e=t.trim();e.endsWith("m")&&(e=e.slice(0,-1));let n="";e.startsWith("-")?(n="-",e=e.slice(1)):e.startsWith("+")&&(e=e.slice(1));const[i,r]=e.split(/[eE]/),o=r?parseInt(r,10):0,[a,c=""]=i.split(".");let l=a||"0",u=c;if(o>0)u.length>o?(l+=u.slice(0,o),u=u.slice(o)):(l+=u.padEnd(o,"0"),u="");else if(o<0){const p=Math.abs(o);l.length>p?(u=l.slice(-p)+u,l=l.slice(0,-p)):(u=l.padStart(p,"0")+u,l="0")}return{sign:n,integerPart:l,fractionalPart:u}}static ensureDecimal(t){if(t instanceof S)return t;if(typeof t=="number")return new S(t.toString());if(typeof t=="string")return new S(t);throw new y(`Unsupported value type for Decimal conversion: ${typeof t}`)}toNumber(){const t=this.coefficient<0n?"-":"";let e=(this.coefficient<0n?-this.coefficient:this.coefficient).toString();if(this.exponent===0)return+`${t}${e}`;for(;e.length<=this.exponent;)e="0"+e;const n=e.slice(0,-this.exponent)||"0",i=e.slice(-this.exponent),r=`${t}${n}.${i}`,o=Number(r);if(!isFinite(o))throw new y("Conversion to Number results in Infinity.");return o}compareTo(t){if(this.precision!==t.precision||this.scale!==t.scale)throw new y("Decimals must have the same precision and scale for comparison.");return this.coefficient===t.coefficient?0:this.coefficient>t.coefficient?1:-1}compareStructure(t){return this.precision===t.precision&&this.scale===t.scale}equals(t){return this.compareTo(t)===0}lessThan(t){return this.compareTo(t)===-1}greaterThan(t){return this.compareTo(t)===1}lessThanOrEqual(t){return this.compareTo(t)<=0}greaterThanOrEqual(t){return this.compareTo(t)>=0}toString(){return M(this.coefficient,this.scale)}getPrecision(){return this.precision}getScale(){return this.scale}getExponent(){return this.exponent}getCoefficient(){return this.coefficient}getFormatPattern(){const t="x".repeat(this.precision-this.scale),e="x".repeat(this.scale);return this.scale>0?`${t}.${e}`:`${t}`}convert(t,e){if(e>t)throw new y("Scale must be less than or equal to precision.");try{return new S(this,t,e)}catch(n){throw n instanceof y?n:new y(`Conversion failed: ${n instanceof Error?n.message:String(n)}`)}}round(t,e){if(e>t)throw new y("Scale must be less than or equal to precision.");if(t<1)throw new y("Precision must be at least 1.");if(e<0)throw new y("Scale must be non-negative.");const n=K(this.coefficient,this.scale,e),i=M(n,e);return new S(i,t,e)}ceil(t,e){if(e>t)throw new y("Scale must be less than or equal to precision.");if(t<1)throw new y("Precision must be at least 1.");if(e<0)throw new y("Scale must be non-negative.");const n=vt(this.coefficient,this.scale,e),i=M(n,e);return new S(i,t,e)}floor(t,e){if(e>t)throw new y("Scale must be less than or equal to precision.");if(t<1)throw new y("Precision must be at least 1.");if(e<0)throw new y("Scale must be non-negative.");const n=St(this.coefficient,this.scale,e),i=M(n,e);return new S(i,t,e)}mod(t){if(!(t instanceof S))throw new y("Invalid operand");if(t.coefficient===0n)throw new y("Division by zero");const{a:e,b:n,targetScale:i}=ft(this.coefficient,this.scale,t.coefficient,t.scale),r=e/n,o=e-r*n,a=o.toString().replace("-","").length,c=Math.max(a,this.precision,t.precision),l=M(o,i);return new S(l,c,i)}add(t){if(!(t instanceof S))throw new y("Invalid operand");const{precision:e,scale:n}=Lt("add",this.precision,this.scale,t.precision,t.scale,{maxPrecision:1e4,maxScale:1e4}),{a:i,b:r}=ft(this.coefficient,this.scale,t.coefficient,t.scale,n,"round"),o=i+r,a=o.toString().replace("-","").length,c=Math.max(e,a),l=M(o,n);return new S(l,c,n)}sub(t){if(!(t instanceof S))throw new y("Invalid operand");const{precision:e,scale:n}=Lt("subtract",this.precision,this.scale,t.precision,t.scale,{maxPrecision:1e4,maxScale:1e4}),{a:i,b:r}=ft(this.coefficient,this.scale,t.coefficient,t.scale,n,"round"),o=i-r,a=o.toString().replace("-","").length,c=Math.max(e,a),l=M(o,n);return new S(l,c,n)}mul(t){if(!(t instanceof S))throw new y("Invalid operand");const e=this.coefficient*t.coefficient,n=this.scale+t.scale,i=Math.max(this.scale,t.scale);let r=e;n>i?r=K(e,n,i):n<i&&(r=W(e,i-n));const o=r.toString().replace("-","").length;let a=Math.max(this.precision,t.precision,o);o>a&&(a=o);const c=M(r,i);return new S(c,a,i)}div(t){if(!(t instanceof S))throw new y("Invalid operand");if(t.coefficient===0n)throw new y("Division by zero");const e=t.scale,n=e+t.scale-this.scale;let i;if(n>=0)i=this.coefficient*J(n);else{const v=J(-n);i=this.coefficient/v}const r=t.coefficient;let o=i/r,a=i%r;const c=r<0n?-r:r;if((a<0n?-a:a)*2n>=c){const v=i<0n!=r<0n;o+=v?-1n:1n}const u=M(o,e),p=(o<0n?(-o).toString():o.toString()).length,g=Math.max(this.precision,t.precision,p);return new S(u,g,e)}}class Nt{constructor(t,e,n){this._data=t,this._name=e,this._schemaName=n}get name(){return this._name}get schemaName(){return this._schemaName}get data(){return this._data}get errors(){return this._data instanceof F||this._data instanceof U?this._data.errors:[]}toJSON(t){return this._data instanceof U?this._data.toJSON():this._data instanceof F?this._data.toJSON(t):this._data&&typeof this._data=="object"?this._data:null}}class Tt{constructor(){return this._sections=[],this._sectionNames={},new Proxy(this,$e)}get sections(){return this._sections}get length(){return this._sections.length}get(t){if(typeof t=="string"){const e=this._sectionNames[t];return e===void 0?void 0:this._sections[e]}return this._sections[t]}push(t){t.name!==void 0&&(this._sectionNames[t.name]=this._sections.length),this._sections.push(t)}*[Symbol.iterator](){for(const t of this._sections)yield t}}const $e={get:(s,t)=>{if(t in s)return Reflect.get(s,t);if(typeof t=="string")return/^[0-9]+$/.test(t)?s.get(Number(t)):s.get(t)},set:(s,t,e)=>{throw new Error("Cannot set a value on a IOSectionCollection")}};class m extends ${constructor(t,e,n,i=!1,r){super(t,e,n,i,r),this.name="InternetObject(SyntaxError)",this.updateMessage()}}class It{constructor(t,e=[]){this.type=t,this.children=e}toValue(t){return this.children.map(e=>{if(e)return e.toValue(t)})}}class et extends It{constructor(t=[],e,n){super("array",t),this.openBracket=e,this.closeBracket=n}toValue(t){return this.children.map(e=>e!=null&&e.toValue?e.toValue(t):e)}getStartPos(){return this.openBracket.getStartPos()}getEndPos(){return this.closeBracket.getEndPos()}}class q{constructor(t,e){this.type="member",this.value=t,e&&(this.key=e)}toValue(t){return this.key?{[this.key.value]:this.value.toValue(t)}:this.value.toValue(t)}getStartPos(){return this.key?this.key.getStartPos():this.value.getStartPos()}getEndPos(){return this.value?this.value.getEndPos():this.key?this.key.getEndPos():{row:0,col:0,pos:0}}}class I extends It{constructor(t=[],e,n){super("object",t),e&&(this.openBracket=e),n&&(this.closeBracket=n)}toObject(t){const e={};let n=0;for(const i of this.children)i&&i.value?i.key?e[i.key.value]=i.value.toValue(t):e[n]=i.value.toValue(t):e[n]=void 0,n++;return e}getStartPos(){var t;return this.openBracket?this.openBracket.getStartPos():((t=this.children[0])==null?void 0:t.getStartPos())??{row:0,col:0,pos:0}}getEndPos(){var t;return this.closeBracket?this.closeBracket.getEndPos():((t=this.children[this.children.length-1])==null?void 0:t.getEndPos())??{row:0,col:0,pos:0}}toValue(t){const e=new U;for(let n=0;n<this.children.length;n++){const i=this.children[n];i&&i.value&&(i.key?e.set(i.key.value,i.value.toValue(t)):e.set(n.toString(),i.value.toValue(t)))}return e}isEmpty(){return this.children.length===0||this.children.every(t=>t===void 0)}toDebugString(){return`ObjectNode { ${this.children.map((e,n)=>{if(!e)return`[${n}]: undefined`;const i=e,r=i.key?i.key.value:`[${n}]`,o=i.value?typeof i.value.toValue=="function"?JSON.stringify(i.value.toValue()):String(i.value):"undefined";return`${r}: ${o}`}).join(", ")} }`}hasKey(t){return this.children.some(e=>{if(!e)return!1;const n=e;return n.key&&n.key.value===t})}getKeys(){const t=[];return this.children.forEach((e,n)=>{if(e){const i=e;i.key?t.push(i.key.value):t.push(n.toString())}}),t}isValid(){return this.children.every(t=>{if(!t)return!0;const e=t;return!(e.value&&e.value.error!==void 0||e.key&&e.key.error!==void 0)})}}class E{static setWarnOnDuplicates(t){this.warnDuplicates=t}static register(...t){for(const e of t)for(const n of e.types){if(this.typeDefMap.has(n)){this.warnDuplicates&&!this.warnedDuplicateTypes.has(n)&&(console.warn(`TypeDef for '${n}' is already registered. Skipping.`),this.warnedDuplicateTypes.add(n));continue}this.typeDefMap.set(n,new e(n)),this.typeNames.add(n)}}static unregister(t){this.typeDefMap.has(t)&&(this.typeDefMap.delete(t),this.typeNames.delete(t))}static get types(){return Object.freeze(Array.from(this.typeNames))}static get(t){const e=this.typeDefMap.get(t);if(!e)throw new $(f.invalidType,`Type '${t}' is not registered`);return e}static isRegisteredType(t){return this.typeDefMap.has(t)}static clear(){this.typeDefMap.clear(),this.typeNames.clear(),this.warnedDuplicateTypes.clear()}static get count(){return this.typeDefMap.size}}E.typeDefMap=new Map;E.typeNames=new Set;E.warnDuplicates=!1;E.warnedDuplicateTypes=new Set;function D(s,t,e){const n=E.get(t.type);if(!n)throw new $(f.invalidType,`Type '${t.type}' is not registered.`);let i=s==null?void 0:s.value;return n.parse(i,t,e)}function st(s,t){if(!s||!t)return s;const e={...s};return typeof e.default=="string"&&e.default.startsWith("@")&&(e.default=t.getV(e.default),e.default instanceof w&&(e.default=e.default.value)),Array.isArray(e.choices)&&(e.choices=e.choices.map(n=>{if(typeof n=="string"&&n.startsWith("@")){let i=t.getV(n);return i instanceof w?i.value:i}return n})),typeof e.min=="string"&&e.min.startsWith("@")&&(e.min=t.getV(e.min),e.min instanceof w&&(e.min=e.min.value)),typeof e.max=="string"&&e.max.startsWith("@")&&(e.max=t.getV(e.max),e.max instanceof w&&(e.max=e.max.value)),e}function tt(s,t,e,n){if(t instanceof w){const i=t.value;t=e==null?void 0:e.getV(i)}return t instanceof N||R("Invalid schema type"),Ie(s,t,e)}function Ie(s,t,e,n){const i=new U;let r=!0;const o=new Set;if(t.names.length===1&&s.children.length>0){const c=s.children[0];if(c!=null&&c.key&&c.key.value!==t.names[0]){const l=t.names[0],u=st(t.defs[l],e),g=D({value:s},u,e);return g!==void 0&&i.set(l,g),i}}let a=0;for(;a<t.names.length;a++){let c=s.children[a],l=t.names[a],u=st(t.defs[l],e);if(c){if(c.key){r=!1;break}const p=D(c,u,e);if(p!==void 0)o.add(l),i.set(l,p);else if(!u.optional&&u.default===void 0)throw new d(f.valueRequired,`Expecting a value for ${u.path}.`,s)}else{if(!u.optional&&u.default===void 0)throw new d(f.valueRequired,`Expecting a value for ${u.path}.`,s);const g=D({value:void 0},u,e);g!==void 0&&(o.add(l),i.set(l,g))}}if(r)for(;a<s.children.length;a++){const c=s.children[a];if(!t.open)throw new m(f.additionalValuesNotAllowed,`Additional values are not allowed in the ${t.name}. The ${t.name} schema is not open.`,c.value);if(c.key){r=!1;break}const l=c.value.toValue(e);i.push(l)}for(;a<s.children.length;a++){let c=s.children[a];if(!c.key)throw new m(f.unexpectedPositionalMember,"Positional members must not be allowed after the keyed member is found.",c);let l=c.key.value,u=st(t.defs[l],e);if(o.has(l))throw new m(f.duplicateMember,`Member ${l} is already defined.`,c);if(!u&&!t.open)throw new m(f.unknownMember,`The ${t.name?`${t.name} `:""}schema does not define a member named '${l}'.`,c.key);!u&&t.open&&(typeof t.open=="object"&&t.open.type?u={...t.open,path:l}:u={type:"any",path:l}),o.add(l);const p=D(c,u,e);i.set(l,p)}for(const c in t.defs){if(c==="*")continue;const l=st(t.defs[c],e);if(!o.has(c)){const u=s.children.find(p=>{var g;return((g=p.key)==null?void 0:g.value)===c});try{const p=D(u,l,e);p!==void 0&&i.set(c,p)}catch(p){throw p instanceof d&&(p.positionRange=s),p}}}if((t.open===!0||typeof t.open=="object"&&t.open.type)&&i.isEmpty()){for(const c of s.children){if(!c)continue;const l=c;let u=l.key?l.key.value:void 0;if(!u)continue;let p;typeof t.open=="object"&&t.open.type?p={...t.open,path:u}:p={type:"any",path:u};const g=D(l,p,e);i.set(u,g)}return i}return i}class z{constructor(t,e,n){this.error=t,this.position=e,this.endPosition=n}getErrorCategory(){const t=this.error.name;return t.includes("SyntaxError")?"syntax":t.includes("ValidationError")?"validation":"runtime"}toValue(t){const e={__error:!0,category:this.getErrorCategory(),message:this.error.message,name:this.error.name,position:this.position,...this.endPosition&&{endPosition:this.endPosition}},n=this.error;return n&&n.collectionIndex!==void 0&&(e.collectionIndex=n.collectionIndex),e}getStartPos(){return this.position}getEndPos(){return this.endPosition||this.position}}class Re{static resolve(t,e){if(t instanceof w){const n=t.value,i=e==null?void 0:e.getV(n);if(!(i instanceof N))throw new $(f.schemaNotFound,`Schema '${n}' not found or invalid`);return i}return t}static isSchemaVariable(t){return t instanceof w&&typeof t.value=="string"&&t.value.startsWith("$")}}function ke(s,t,e,n){const i=Re.resolve(t,e),r=new F,o=s.children.length;for(let a=0;a<o;a++){const c=s.children[a];if(c instanceof z){try{c.error.collectionIndex=a}catch{}r.push(c)}else try{r.push(tt(c,i,e,a))}catch(l){if(l instanceof Error){l.collectionIndex=a;const u=new z(l,c.getStartPos(),c.getEndPos());r.errors.push(l),r.push(u)}else throw l}}return r}class ut extends It{constructor(t=[]){super("collection",t)}toValue(t){const e=new F;for(const n of this.children)e.push(n==null?void 0:n.toValue(t));return e}getStartPos(){var t;return((t=this.children[0])==null?void 0:t.getStartPos())??{row:0,col:0,pos:0}}getEndPos(){var t;return((t=this.children[this.children.length-1])==null?void 0:t.getEndPos())??{row:0,col:0,pos:0}}isEmpty(){return this.children.length===0||this.children.every(t=>t===void 0)}toDebugString(){return`CollectionNode { ${this.children.map((e,n)=>{if(!e)return`[${n}]: undefined`;const i=typeof e.toValue=="function"?JSON.stringify(e.toValue()):String(e);return`[${n}]: ${i}`}).join(", ")} }`}size(){return this.children.length}hasValidItems(){return this.children.some(t=>t?t.error===void 0:!0)}getValidItems(){return this.children.filter(t=>t?t.error===void 0:!0)}isValid(){return this.children.every(t=>t?t.error===void 0:!0)}}class lt{static isValidDataNode(t){return t instanceof I||t instanceof ut}static isValidSchema(t){return t instanceof N||t instanceof w}static validateProcessingInputs(t,e){var n,i;if(!lt.isValidDataNode(t)){const r=(n=t==null?void 0:t.constructor)==null?void 0:n.name,o=t===null?"null":t===void 0||r===void 0?"undefined":r||"unknown";throw new $(f.invalidType,`Invalid data node type: ${o}`)}if(!lt.isValidSchema(e)){const r=(i=e==null?void 0:e.constructor)==null?void 0:i.name,o=e===null?"null":e===void 0||r===void 0?"undefined":r||"unknown";throw new $(f.invalidSchema,`Invalid schema type: ${o}`)}return{data:t,schema:e}}}function Jt(s,t,e,n){if(s===null)return null;const{data:i,schema:r}=lt.validateProcessingInputs(s,t);return i instanceof I?tt(i,r,e):ke(i,r,e)}function x(s,t,e,n,i){const r=t===void 0||t instanceof w&&t.type===h.UNDEFINED,o=e instanceof w?e.value===null:t===null;if(r){if(s.default!==void 0)return{value:Ae(s.default,n),changed:!0};if(s.optional)return{value:void 0,changed:!0};throw new d(...Ce(s,e))}if(o){if(s.null)return{value:null,changed:!0};const a=`Null is not allowed for ${s.path}`;throw new d(f.nullNotAllowed,a,e)}if(t=typeof t=="object"&&t.toValue?t.toValue(n):t,s.choices!==void 0){let a=t instanceof w?t.value:t,c=!1;for(let l of s.choices)if(typeof l=="string"&&l[0]==="@"&&(l=n==null?void 0:n.getV(l),l=l instanceof w?l.value:l),i?i(a,l):a===l){c=!0;break}if(!c)throw new d(...Me(s,t,e))}return{value:t,changed:!1}}function Ae(s,t){if(s instanceof w&&(typeof s.value=="string"&&s.value.startsWith("@")&&t?(s=t.getV(s),s=s instanceof w?s.value:s):s=s.value),typeof s=="string"&&s.startsWith("@")&&t&&(s=t.getV(s),s=s instanceof w?s.value:s),typeof s=="string"){if(s==="N")return null;if(s==="T"||s==="true")return!0;if(s==="F"||s==="false")return!1}return s}function Ce(s,t){const e=`Value is required for ${s.path}`;return[f.valueRequired,e,t]}function Me(s,t,e){if(!s.choices)throw Error("Choices not checked during NumberDef implementation.");t=t.toValue?t.toValue():t.toObject?t.toObject():t,t=JSON.stringify(t);let n=`The value of "${s.path}" must be one of the [${s.choices.join(", ")}]. Currently it is ${t}.`;return s.choices.length===1&&(n=`The value of "${s.path}" must be '${s.choices[0]}'. Currently it is ${t}.`),[f.invalidChoice,n,e]}const Le={type:"any",__memberdef:!0},Pe=new N("any",{type:{type:"string",optional:!1,null:!1,choices:["any"]}},{default:{type:"any",optional:!0,null:!0}},{choices:{type:"array",optional:!0,null:!1}},{anyOf:{type:"array",optional:!0,null:!1,of:Le}},{isSchema:{type:"bool",optional:!0,null:!1,default:!1}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class Ve{get type(){return"any"}get schema(){return Pe}parse(t,e,n){const i=(n==null?void 0:n.getV(t))||t,{value:r,changed:o}=x(e,i,t,n);if(o)return r;const a=e.anyOf;if(!a)return e.__memberdef?pe(new q(t),"",n):r;const c=[];for(let l=0;l<a.length;l++){const u=a[l];u.path=e.path;const p=E.get(u.type);if(!p)throw new $(f.invalidType,`Invalid type definition '${u.type}'`);try{return p.parse(t,u,n)}catch(g){c.push(g);continue}}if(c.length===a.length)throw new d(f.invalidValue,`None of the constraints defined for '${e.path}' matched.`,t);return i}load(t,e,n){const{value:i,changed:r}=x(e,t,void 0,n);if(r)return i;const o=e.anyOf;if(!o)return t;const a=[];for(const c of o){const l={...c,path:e.path},u=E.get(c.type);if(!u)throw new $(f.invalidType,`Invalid type definition '${c.type}'`);try{if("load"in u&&typeof u.load=="function")return u.load(t,l,n);a.push(new Error(`Type '${c.type}' does not support load()`));continue}catch(p){a.push(p);continue}}if(a.length===o.length)throw new d(f.invalidValue,`None of the constraints defined for '${e.path}' matched.`);return t}stringify(t,e,n){const{value:i,changed:r}=x(e,t,void 0,n);if(r){if(i===null)return"N";if(i===void 0)return;t=i}if(t===null)return"N";if(t===void 0)return;const o=e.anyOf;if(o)for(const a of o){const c={...a,path:e.path},l=E.get(a.type);if(l)try{if("load"in l&&typeof l.load=="function"&&l.load(t,c,n),"stringify"in l&&typeof l.stringify=="function")return l.stringify(t,c,n)}catch{continue}}return this._stringifyByInference(t,e.path||"",n)}_stringifyByInference(t,e,n){if(typeof t=="boolean"){const i=E.get("bool");return i&&"stringify"in i&&typeof i.stringify=="function"?i.stringify(t,{type:"bool",path:e},n)??(t?"T":"F"):t?"T":"F"}if(typeof t=="number"){const i=E.get("number");return i&&"stringify"in i&&typeof i.stringify=="function"?i.stringify(t,{type:"number",path:e},n)??String(t):String(t)}if(typeof t=="bigint"){const i=E.get("bigint");return i&&"stringify"in i&&typeof i.stringify=="function"?i.stringify(t,{type:"bigint",path:e},n)??t.toString():t.toString()}if(typeof t=="string"){const i=E.get("string");return i&&"stringify"in i&&typeof i.stringify=="function"?i.stringify(t,{type:"string",path:e,format:"open"},n)??t:t}if(t instanceof Date){const i=this._inferDateTimeType(t),r=E.get(i);return r&&"stringify"in r&&typeof r.stringify=="function"?r.stringify(t,{type:i,path:e},n)??t.toISOString():t.toISOString()}if(Array.isArray(t)){const i=E.get("array");if(i&&"stringify"in i&&typeof i.stringify=="function"){const o=i.stringify(t,{type:"array",path:e},n);if(o!==void 0)return o}return`[${t.map((o,a)=>this._stringifyByInference(o,`${e}[${a}]`,n)).join(", ")}]`}if(typeof t=="object"&&t!==null){const i=E.get("object");if(i&&"stringify"in i&&typeof i.stringify=="function"){const o=i.stringify(t,{type:"object",path:e},n);if(o!==void 0)return o}const r=[];for(const o in t)if(t.hasOwnProperty(o)){const a=this._stringifyByInference(t[o],`${e}.${o}`,n);r.push(`${o}: ${a}`)}return`{${r.join(", ")}}`}return JSON.stringify(t)}_inferDateTimeType(t){const e=t.getUTCHours(),n=t.getUTCMinutes(),i=t.getUTCSeconds(),r=t.getUTCMilliseconds(),o=t.getUTCFullYear(),a=t.getUTCMonth(),c=t.getUTCDate();return o===1900&&a===0&&c===1?"time":e===0&&n===0&&i===0&&r===0?"date":"datetime"}static get types(){return["any"]}}const je=new N("array",{type:{type:"string",optional:!1,null:!1,choices:["array"]}},{default:{type:"array",optional:!0,null:!1}},{of:{type:"any",optional:!0,null:!1,__memberdef:!0}},{len:{type:"number",optional:!0,null:!1,min:0}},{minLen:{type:"number",optional:!0,null:!1,min:0}},{maxLen:{type:"number",optional:!0,null:!1,min:0}});class Be{constructor(){this.parse=(t,e,n)=>Ue(t,e,n),this.load=(t,e,n)=>{var l;const{value:i,changed:r}=x(e,t,void 0,n);if(r)return i;if(!Array.isArray(t))throw new d(f.notAnArray,`Expecting an array value for '${e.path}' but found ${typeof t}`);let o,a={type:"any"};if(e.of instanceof N)o=E.get("object"),a.schema=e.of,a.path=e.path;else if((l=e.of)!=null&&l.type){if(o=E.get(e.of.type),!o)throw new d(f.invalidType,`Invalid type definition '${e.of.type}'`);a={...e.of},a.path=e.path}else o=E.get("any");const c=[];for(let u=0;u<t.length;u++){const p=t[u],g=`${e.path||"array"}[${u}]`,v={...a,path:g};o&&"load"in o&&typeof o.load=="function"?c.push(o.load(p,v,n)):c.push(p)}return bt(c,e),c},this.stringify=(t,e,n)=>{var l;const{value:i,changed:r}=x(e,t,void 0,n);if(r){if(i===null)return"N";if(i===void 0)return;t=i}if(!Array.isArray(t))throw new d(f.notAnArray,`Expecting an array value for '${e.path}' but found ${typeof t}`);bt(t,e);let o,a={type:"any"};e.of instanceof N?(o=E.get("object"),a.schema=e.of,a.path=e.path):(l=e.of)!=null&&l.type?(o=E.get(e.of.type),a={...e.of},a.path=e.path):e.schemaRef&&n?(o=E.get("object"),a.type="object",a.schemaRef=e.schemaRef,a.path=e.path):o=E.get("any");const c=[];for(let u=0;u<t.length;u++){const p=t[u],g=`${e.path||"array"}[${u}]`,v={...a,path:g};if(o&&"stringify"in o&&typeof o.stringify=="function"){const C=o.stringify(p,v,n);c.push(C??"")}else c.push(p===null?"N":JSON.stringify(p))}return`[${c.join(", ")}]`}}get type(){return"array"}get schema(){return je}static get types(){return["array"]}}function Ue(s,t,e){var l;const n=(e==null?void 0:e.getV(s))||s,{value:i,changed:r}=x(t,n,s,e);if(r)return i;if(!(n instanceof et))throw new d(f.notAnArray,`Expecting an array value for '${t.path}'`,s);let o,a={type:"any"};if(t.of instanceof N)o=E.get("object"),a.schema=t.of,a.path=t.path;else if((l=t.of)!=null&&l.type){if(o=E.get(t.of.type),!o)throw new d(f.invalidType,`Invalid type definition '${t.of.type}'`,s);a=t.of,a.path=t.path}else typeof t.of=="string"?R(t.of):o=E.get("any");const c=[];return n.children.forEach(u=>{if(n!==s)try{c.push(o==null?void 0:o.parse(u,a,e))}catch(p){throw p instanceof d&&(p.positionRange=s),p}else c.push(o==null?void 0:o.parse(u,a,e))}),bt(c,t,n),c}function bt(s,t,e){const n=s.length;if(t.len!==void 0&&n!==t.len)throw new d(f.invalidLength,`The "${t.path||"array"}" must have exactly ${t.len} items, but has ${n}.`,e);if(t.minLen!==void 0&&n<t.minLen)throw new d(f.outOfRange,`The "${t.path||"array"}" must have at least ${t.minLen} items, but has ${n}.`,e);if(t.maxLen!==void 0&&n>t.maxLen)throw new d(f.outOfRange,`The "${t.path||"array"}" must have at most ${t.maxLen} items, but has ${n}.`,e)}var Fe=function(s,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!n:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(s):n?n.value:t.get(s)},Ot,Ht;const We=new N("bool",{type:{type:"string",optional:!1,null:!1,choices:["bool"]}},{default:{type:"bool",optional:!0,null:!1}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class De{constructor(){Ot.add(this)}get type(){return"bool"}get schema(){return We}parse(t,e,n){return Fe(this,Ot,"m",Ht).call(this,t,e,n)}load(t,e,n){const{value:i,changed:r}=x(e,t);if(r)return i;if(typeof t!="boolean")throw new $(f.notABool,`Expecting a boolean value for '${e.path}' but found ${JSON.stringify(t)}.`);return t}stringify(t,e){return this.load(t,e),t?"T":"F"}static get types(){return["bool"]}}Ot=new WeakSet,Ht=function(t,e,n){const i=(n==null?void 0:n.getV(t))||t,{value:r,changed:o}=x(e,i,t,n);if(o)return r;if(!(i instanceof w)||i.type!==h.BOOLEAN)throw new $(f.notABool,`Expecting a boolean value for '${e.path}' but found ${i.toValue()}.`,t);return i.value};const Rt={datetime:/^(?<dt>(?<year>\d{4})(?:\-(?<month>(?:1[0-2]|0[1-9]))(?:\-(?<date>[0-2][0-9]|3[0-1]))?)?(T(?<hour>[0-1][0-9]|2[0-3])(?:\:(?<minute>[0-5][0-9])(?:\:(?<sec>[0-5][0-9])(?:\.(?<milisecond>(?:\d{3})+))?)?)?)?(?<tz>(Z)|((?:\+|-)(?:(?:[0-1][0-9]|2[0-3])(?:\:[0-5][0-9])?)))?)$/,date:/^(?<year>\d{4})(?:\-(?<month>(?:1[0-2]|0[1-9]))(?:\-(?<date>[0-2][0-9]|3[0-1]))?)?$/,time:/^(?<hour>[0-1][0-9]|2[0-3])(?:\:(?<minute>[0-5][0-9])(?:\:(?<second>[0-5][0-9])(?:\.(?<milisecond>(?:\d{3})+))?)?)?$/},kt={datetime:/^(?<year>\d{4})(?:(?<month>(?:1[0-2]|0[1-9]))(?:(?<date>[0-2][0-9]|3[0-1]))?)?(?:(?<hour>[0-1][0-9]|2[0-3])(?:(?<minute>[0-5][0-9])(?:(?<second>[0-5][0-9])(?:(?<milisecond>(?:\d{3})+))?)?)?)?(?<tz>(Z)|((?:\+|-)(?:(?:[0-1][0-9]|2[0-3])(?:[0-5][0-9])?)))?/,date:/^(?<year>\d{4})(?:(?<month>(?:1[0-2]|0[1-9]))(?:(?<date>[0-2][0-9]|3[0-1]))?)?$/,time:/^(?<hour>[0-1][0-9]|2[0-3])(?:(?<minute>[0-5][0-9])(?:(?<second>[0-5][0-9])(?:(?<milisecond>(?:\d{3})+))?)?)?$/},Ye=s=>{const e=(/[\-\:]/.test(s.substring(0,6))?Rt.datetime:kt.datetime).exec(s);if(!e)return null;const{year:n,month:i,date:r,hour:o,minute:a,second:c,milisecond:l,tz:u}=e.groups||{},g=`${n}-${i||"01"}-${r||"01"}T${o||"00"}:${a||"00"}:${c||"00"}.${l||"000"}${u||"Z"}`;return new Date(g)},Ke=s=>{const e=(/\-/.test(s.substring(0,5))?Rt.date:kt.date).exec(s);if(!e)return null;const{year:n,month:i,date:r}=e.groups||{},o=`${n}-${i||"01"}-${r||"01"}T00:00:00.000Z`;return new Date(o)},qe=s=>{const e=(/\:/.test(s.substring(0,3))?Rt.time:kt.time).exec(s);if(!e)return null;const{hour:n,minute:i,second:r,milisecond:o}=e.groups||{},a=`1900-01-01T${n||"00"}:${i||"00"}:${r||"00"}.${o||"000"}Z`;return new Date(a)},Zt=(s,t=!1,e=!1)=>s===null?null:s.toISOString(),Qt=(s,t=!1)=>s===null?null:s.toISOString().split("T")[0],Xt=(s,t=!1)=>s===null?null:s.toISOString().split("T")[1].split(".")[0],Pt=(s,t,e=!1)=>{if(s===null)return null;switch(t){case"datetime":return Zt(s,e);case"date":return Qt(s,e);case"time":return Xt(s,e)}},ze=(s,t,e=!1)=>{if(s===null)return"N";switch(t){case"datetime":return`dt"${Zt(s,e)}"`;case"date":return`d"${Qt(s,e)}"`;case"time":return`t"${Xt(s,e)}"`}};var L=function(s,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!n:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(s):n?n.value:t.get(s)},Ge=function(s,t,e,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!i:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(s,e):i?i.value=e:t.set(s,e),e},at,X,G,ct,xt;const te=["datetime","date","time"],Je=new N("datetime",{type:{type:"string",optional:!1,null:!1,choices:te}},{default:{type:"datetime",optional:!0,null:!1}},{choices:{type:"array",optional:!0,null:!1,of:{type:"datetime"}}},{min:{type:"datetime",optional:!0,null:!1}},{max:{type:"datetime",optional:!0,null:!1}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class He{get type(){return L(this,X,"f")}get schema(){return Je}constructor(t="datetime"){at.add(this),X.set(this,void 0),G.set(this,(e,n)=>{if(e){if(e instanceof Date)return e;if(e instanceof w){if(e.value instanceof Date)return e.value;if(n){const i=n.getV(e);if(i instanceof Date)return i;if(i instanceof w&&i.value instanceof Date)return i.value}}if(typeof e=="object"&&typeof e.toValue=="function"){const i=e.toValue(n);return L(this,G,"f").call(this,i,n)}}}),ct.set(this,(e,n)=>{const i=e instanceof Date?e:void 0,r=L(this,G,"f").call(this,n);return!i||!r?!1:i.getTime()===r.getTime()}),Ge(this,X,t,"f")}parse(t,e,n){const i=(n==null?void 0:n.getV(t))||t,{value:r,changed:o}=x(e,i,t,n,L(this,ct,"f"));if(o)return r;if(i.type!==h.DATETIME)throw new d(f.invalidDateTime,`Expecting a ${e.type.toUpperCase()} value for ${e.path}, currently ${i.value}, a ${i.type} value`,t);return L(this,at,"m",xt).call(this,r,e,t,n),r}load(t,e,n){const{value:i,changed:r}=x(e,t,void 0,n,L(this,ct,"f"));if(r)return i;if(!(t instanceof Date))throw new d(f.invalidType,`Expecting a Date object for '${e.path}', got ${typeof t}`);return L(this,at,"m",xt).call(this,t,e,void 0,n),t}stringify(t){return ze(t,L(this,X,"f"))}static get types(){return te}}X=new WeakMap,G=new WeakMap,ct=new WeakMap,at=new WeakSet,xt=function(t,e,n,i){const r=e.type;if(e.min){const o=L(this,G,"f").call(this,e.min,i);if(o&&t<o)throw new d(f.outOfRange,`Expecting the value ${e.path?`for '${e.path}'`:""} to be greater than or equal to '${Pt(o,r)}'`,n)}if(e.max){const o=L(this,G,"f").call(this,e.max,i);if(o&&t>o)throw new d(f.outOfRange,`Expecting the value ${e.path?`for '${e.path}'`:""} to be less than or equal to '${Pt(o,r)}'`,n)}};const nt=["bigint","decimal","int","uint","float","number","int8","int16","int32","uint8","uint16","uint32","uint64","float32","float64"],ee=nt.reduce((s,t)=>(s[t]=!0,s),{});function V(s,t,e,n){let i;switch(s){case f.invalidType:i=`The '${t}' has an invalid type. ${e}`;break;case f.invalidRange:i=`The '${t}' must be within the specified range, Currently it is ${e}.`;break;case f.invalidScale:i=`The '${t}' has an invalid scale. ${e}`;break;case f.invalidPrecision:i=`The '${t}' has an invalid precision. ${e}`;break;default:i=`The '${t}' validation failed. ${e}`}throw new d(s,i,n)}function B(s){return s.toString().split(".")[0].replace("-","").length}const Ze=new N("bigint",{type:{type:"string",optional:!1,null:!1,choices:nt}},{default:{type:"bigint",optional:!0,null:!1}},{choices:{type:"array",optional:!0,null:!1,of:{type:"bigint"}}},{min:{type:"bigint",optional:!0,null:!1}},{max:{type:"bigint",optional:!0,null:!1}},{multipleOf:{type:"bigint",optional:!0,null:!1}},{format:{type:"string",optional:!0,null:!1,choices:["decimal","hex","octal","binary"],default:"decimal"}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class Qe{constructor(){this._type="bigint"}get type(){return this._type}get schema(){return Ze}parse(t,e,n){const i=(n==null?void 0:n.getV(t))||t;typeof(i==null?void 0:i.toValue)=="function"&&i.toValue(n);let{value:r,changed:o}=x(e,i,t,n);return o||(r=this.validate(e,r,t)),r}load(t,e,n){const{value:i,changed:r}=x(e,t);return r?i:this.validate(e,t)}stringify(t,e){return this.validate(e,t),e.format==="hex"?t.toString(16):e.format==="octal"?t.toString(8):e.format==="binary"?t.toString(2):t.toString()}validate(t,e,n){const i=typeof e=="bigint"?"bigint":ee[typeof e]?"number":"";if(i==="")throw new d(f.invalidType,`Expecting a value of type '${t.type}' for '${t.path}'`,n);if(i!=="bigint")throw new d(`not-a-${t.type}`,`Invalid value encountered for '${t.path}'`,n);const{min:r,max:o,multipleOf:a}=t;if((r!=null&&e<r||o!=null&&e>o)&&V(f.invalidRange,t.path,e,n),a!=null&&e%BigInt(a)!==0n)throw new d(f.invalidValue,`The value ${e} for '${t.path}' must be a multiple of ${a}`,n);return e}}const Xe=new N("decimal",{type:{type:"string",optional:!1,null:!1,choices:nt}},{default:{type:"decimal",optional:!0,null:!1}},{choices:{type:"array",optional:!0,null:!1,of:{type:"decimal"}}},{precision:{type:"number",optional:!0,null:!1}},{scale:{type:"number",optional:!0,null:!1}},{min:{type:"decimal",optional:!0,null:!1}},{max:{type:"decimal",optional:!0,null:!1}},{multipleOf:{type:"decimal",optional:!0,null:!1}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class tn{constructor(){this._type="decimal"}get type(){return this._type}get schema(){return Xe}parse(t,e,n){const i=(n==null?void 0:n.getV(t))||t;let{value:r,changed:o}=x(e,i,t,n);return o||(typeof r=="number"&&V(f.invalidType,e.path,"Expected decimal value (with 'm' suffix), got number",t),r=this.validate(e,r,t)),r}load(t,e,n){const{value:i,changed:r}=x(e,t);return r?i:this.validate(e,t)}stringify(t,e){return this.validate(e,t),t.toString()}validate(t,e,n){let{min:i,max:r,precision:o,scale:a}=t;const c=S.ensureDecimal(e),l=o!=null,u=a!=null;if(u){const p=c.getScale();p!==a&&V(f.invalidScale,t.path,`Value has scale ${p}, expected ${a}`,n)}if(l){const p=c.getPrecision();if(u){const g=B(c),v=o-a;g>v&&V(f.invalidPrecision,t.path,`Integer part has ${g} digits, DECIMAL(${o},${a}) allows ${v}`,n)}else p>o&&V(f.invalidPrecision,t.path,`Value has precision ${p}, max allowed is ${o}`,n)}if(i!=null){const p=S.ensureDecimal(i),g=Math.max(c.getScale(),p.getScale()),v=B(c),C=B(p),k=Math.max(v,C)+g,H=c.convert(k,g),Z=p.convert(k,g);H.compareTo(Z)<0&&V(f.invalidRange,t.path,e,n)}if(r!=null){const p=S.ensureDecimal(r),g=Math.max(c.getScale(),p.getScale()),v=B(c),C=B(p),k=Math.max(v,C)+g,H=c.convert(k,g),Z=p.convert(k,g);H.compareTo(Z)>0&&V(f.invalidRange,t.path,e,n)}if(t.multipleOf!==void 0&&t.multipleOf!==null){const p=S.ensureDecimal(t.multipleOf),g=Math.max(c.getScale(),p.getScale()),v=B(c),C=B(p),k=Math.max(v,C)+g,H=c.convert(k,g),Z=p.convert(k,g),Ee=H.mod(Z),ve=new S(0,k,g);Ee.compareTo(ve)!==0&&V(f.invalidValue,t.path,`Value must be a multiple of ${p}`,n)}return c}}const en=new N("number",{type:{type:"string",optional:!1,null:!1,choices:nt}},{default:{type:"number",optional:!0,null:!1}},{choices:{type:"array",optional:!0,null:!1,of:{type:"number"}}},{min:{type:"number",optional:!0,null:!1}},{max:{type:"number",optional:!0,null:!1}},{multipleOf:{type:"number",optional:!0,null:!1}},{format:{type:"string",optional:!0,null:!1,choices:["decimal","hex","octal","binary","scientific"]}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class nn{get type(){return this._type}get schema(){return this._delegateTypeDef?this._delegateTypeDef.schema:en}constructor(t="number"){this._type=t,t==="bigint"?this._delegateTypeDef=new Qe:t==="decimal"&&(this._delegateTypeDef=new tn)}parse(t,e,n){if(this._delegateTypeDef)return this._delegateTypeDef.parse(t,e,n);const i=(n==null?void 0:n.getV(t))||t;typeof(i==null?void 0:i.toValue)=="function"&&i.toValue(n);let{value:r,changed:o}=x(e,i,t,n);return o||(r=this.validateInteger(e,r,t)),r}load(t,e,n){if(this._delegateTypeDef&&"load"in this._delegateTypeDef)return this._delegateTypeDef.load(t,e,n);const{value:i,changed:r}=x(e,t,void 0,n);return r?i:this.validateInteger(e,t)}stringify(t,e,n){const{value:i,changed:r}=x(e,t,void 0,n);if(r){if(i===null)return"N";if(i===void 0)return""}return this._delegateTypeDef&&"stringify"in this._delegateTypeDef?this._delegateTypeDef.stringify(i,e,n):e.format==="scientific"?i.toExponential():e.format==="hex"?i.toString(16):e.format==="octal"?i.toString(8):e.format==="binary"?i.toString(2):i.toString()}validateInteger(t,e,n){const i=typeof e=="bigint"?"bigint":ee[typeof e]?"number":"";if(i==="")throw new d(f.invalidType,`Expecting a value of type '${t.type}' for '${t.path}'`,n);if(i!=="number")throw new d(`not-a-${t.type}`,`Invalid value encountered for '${t.path}'`,n);const{min:r,max:o}=this.getTypeBounds(this._type),a=t.min!==void 0&&t.min!==null?t.min:r,c=t.max!==void 0&&t.max!==null?t.max:o;if((a!==null&&e<a||c!==null&&e>c)&&V(f.invalidRange,t.path,e,n),t.multipleOf!==void 0&&t.multipleOf!==null&&e%t.multipleOf!==0)throw new d(f.invalidValue,`The value ${e} for '${t.path}' must be a multiple of ${t.multipleOf}`,n);return e}getTypeBounds(t){switch(t){case"uint":return{min:0,max:null};case"int8":return{min:-128,max:2**7-1};case"uint8":return{min:0,max:2**8-1};case"int16":return{min:-32768,max:2**15-1};case"uint16":return{min:0,max:2**16-1};case"int32":return{min:-2147483648,max:2**31-1};case"uint32":return{min:0,max:2**32-1};case"uint64":case"int64":case"float32":case"float64":throw new $(f.unsupportedNumberType,`The number type '${t}' is not supported.`);default:return{min:null,max:null}}}static get types(){return nt}}const sn=new N("object",{type:{type:"string",optional:!1,null:!1,choices:["object"]}},{default:{type:"object",optional:!0,null:!1}},{schema:{type:"object",optional:!0,null:!1,__schema:!0}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class rn{constructor(){this._names=null,this.parse=(t,e,n)=>this._process(t,e,n),this.load=(t,e,n)=>{const{value:i,changed:r}=x(e,t,void 0,n);if(r)return i;if(typeof t!="object"||t===null||Array.isArray(t))throw new d(f.invalidObject,`Expecting an object value for '${e.path}' but found ${Array.isArray(t)?"array":typeof t}`);const o=e.schema;return o?this._loadObject(t,o,e.path||"",n):t},this.stringify=(t,e,n)=>{const{value:i,changed:r}=x(e,t,void 0,n);if(r){if(i===null)return"N";if(i===void 0)return;t=i}if(typeof t!="object"||t===null||Array.isArray(t))throw new d(f.invalidObject,`Expecting an object value for '${e.path}' but found ${Array.isArray(t)?"array":typeof t}`);let o=this._resolveSchema(e.schema,n);return!o&&e.schemaRef&&n&&(o=this._resolveSchema(e.schemaRef,n)),this._stringifyObject(t,o,e.path||"",n)},this._process=(t,e,n)=>{const i=(n==null?void 0:n.getV(t))||t,{value:r,changed:o}=x(e,i,t,n);if(o)return r;let a=e.schema;if(!(i instanceof I))throw new d(f.invalidObject,`Expecting an object value for '${e.path}'`,t);if(i===t)return e.__schema?At(e.path||"",i,n):(a||(a=new N(e.path||""),a.open=!0),tt(i,a,n));try{return tt(i,a,n)}catch(c){throw c instanceof d&&(c.positionRange=t),c}return tt(i,a,n)}}get type(){return"object"}static get types(){return["object"]}get schema(){return sn}_loadObject(t,e,n,i){const r={},o=new Set;for(const a of e.names){const c=this._resolveMemberDefVariables(e.defs[a],i);c.path=n?`${n}.${a}`:a;const l=t[a],u=E.get(c.type);if(!u)throw new $(f.invalidType,`Type '${c.type}' is not registered.`);if("load"in u&&typeof u.load=="function"){const p=u.load(l,c,i);p!==void 0&&(r[a]=p)}else if(l!==void 0)r[a]=l;else if(c.default!==void 0)r[a]=c.default;else if(!c.optional)throw new d(f.valueRequired,`Value required for field '${c.path}'`);o.add(a)}if(e.open){for(const a in t)if(!o.has(a)){let c;typeof e.open=="object"&&e.open.type?c={...e.open,path:n?`${n}.${a}`:a}:c={type:"any",path:n?`${n}.${a}`:a};const l=E.get(c.type);if(l&&"load"in l&&typeof l.load=="function"){const u=l.load(t[a],c,i);u!==void 0&&(r[a]=u)}else r[a]=t[a]}}else for(const a in t)if(!o.has(a))throw new d(f.unknownMember,`The ${e.name?`${e.name} `:""}schema does not define a member named '${a}'.`);return r}_stringifyObject(t,e,n,i){const r=[];if(e){for(const o of e.names){const a=this._resolveMemberDefVariables(e.defs[o],i);a.path=n?`${n}.${o}`:o;const c=t[o],l=E.get(a.type);if(l&&"stringify"in l&&typeof l.stringify=="function"){const u=l.stringify(c,a,i);r.push(u??"")}else c===null?r.push("N"):c===void 0?r.push(""):r.push(JSON.stringify(c))}for(;r.length>0&&r[r.length-1]==="";)r.pop();if(e.open){const o=new Set(e.names);for(const a in t)if(!o.has(a)){const c=t[a],l=n?`${n}.${a}`:a;if(c===void 0)continue;let u;if(c===null)u="N";else if(typeof c=="string"){const p=E.get("string");p&&"stringify"in p&&typeof p.stringify=="function"?u=p.stringify(c,{type:"string",path:l,format:"auto"},i)??c:u=JSON.stringify(c)}else u=JSON.stringify(c);r.push(`${a}: ${u}`)}}}else for(const o in t){const a=t[o];if(a===void 0)continue;let c;a===null?c="N":typeof a=="string"?c=a:typeof a=="boolean"?c=a?"T":"F":c=JSON.stringify(a),r.push(`${o}: ${c}`)}return`{${r.join(", ")}}`}_resolveSchema(t,e){if(t){if(t instanceof N)return t;if(t instanceof w){if(typeof t.value=="string"&&t.value.startsWith("$")&&e){const n=e.getV(t.value);return n instanceof N?n:this._resolveSchema(n,e)}return}if(typeof t=="string"&&t.startsWith("$")&&e){const n=e.getV(t);return n instanceof N?n:this._resolveSchema(n,e)}}}_resolveMemberDefVariables(t,e){if(!t||!e)return{...t};const n={...t};return typeof n.default=="string"&&n.default.startsWith("@")&&(n.default=e.getV(n.default),n.default instanceof w&&(n.default=n.default.value)),Array.isArray(n.choices)&&(n.choices=n.choices.map(i=>{if(typeof i=="string"&&i.startsWith("@")){let r=e.getV(i);return r instanceof w?r.value:r}return i})),typeof n.min=="string"&&n.min.startsWith("@")&&(n.min=e.getV(n.min),n.min instanceof w&&(n.min=n.min.value)),typeof n.max=="string"&&n.max.startsWith("@")&&(n.max=e.getV(n.max),n.max instanceof w&&(n.max=n.max.value)),n}}const ne=/(?<structural>[\{\}\[\]\:\#\"\'\\\\~])/,on=/[\,]/,ie=/(?<escape>[\n\r\t])/,se=/(?<newlines>(\r\n?)|\n)/g,Vt=(s,t)=>(s=s.replace(new RegExp(ne,"g"),"\\$1"),t&&(s=s.replace(se,"\\n")),s),_t=(s,t,e='"')=>(s=s.replace(new RegExp(ie,"g"),"\\$1"),t&&(s=s.replace(se,"\\n")),`${e}${s.replace(new RegExp(e,"g"),`\\${e}`)}${e}`),re=(s,t='"')=>`r${t}${s.replace(new RegExp(t,"g"),t+t)}${t}`;function an(s){if(s.length===0)return!1;const t=s[0];if(t==="-"||t==="+"){if(s.length===1)return!1;const e=s[1];return e>="0"&&e<="9"||e==="."}if(t==="."){if(s.length===1)return!1;const e=s[1];return e>="0"&&e<="9"}return t>="0"&&t<="9"}const cn=/^\d{4}-\d{2}-\d{2}$/,ln=/^\d{2}:\d{2}(?::\d{2}(?:\.\d+)?)?$/,un=/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}(?::\d{2}(?:\.\d+)?)?(?:Z|[+-]\d{2}:?\d{2})?$/,hn=new Set(["null","N","true","T","false","F","Inf","+Inf","-Inf","NaN","undefined"]);function fn(s){return!!(s==null||s.length===0||hn.has(s)||an(s)||cn.test(s)||ln.test(s)||un.test(s))}const jt=(s,t,e='"')=>s==null?'""':fn(s)||on.test(s)?_t(s,t,e):ne.test(s)?Vt(s,t):ie.test(s)?re(s,e):Vt(s,t),oe=["string","url","email"],pn=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/,dn=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/,gn=new N("string",{type:{type:"string",optional:!1,null:!1,choices:oe}},{default:{type:"string",optional:!0,null:!1}},{choices:{type:"array",optional:!0,null:!1,of:{type:"string"}}},{pattern:{type:"string",optional:!0,null:!1}},{flags:{type:"string",optional:!0,null:!1}},{len:{type:"number",optional:!0,null:!1,min:0}},{minLen:{type:"number",optional:!0,null:!1,min:0}},{maxLen:{type:"number",optional:!0,null:!1,min:0}},{format:{type:"string",optional:!0,null:!1,choices:["auto","regular","raw"],default:"auto"}},{escapeLines:{type:"bool",optional:!0,null:!1,default:!1}},{encloser:{type:"string",optional:!0,null:!1,choices:['"',"'"],default:'"'}},{optional:{type:"bool",optional:!0}},{null:{type:"bool",optional:!0}});class yn{constructor(t="string"){this._type=t}get type(){return this._type}static get types(){return oe}get schema(){return gn}parse(t,e,n){return mn(t,e,n)}load(t,e,n){const{value:i,changed:r}=x(e,t,void 0,n);if(r)return i;if(typeof t!="string")throw new d(f.notAString,`Expecting a string value for '${e.path}' but found ${JSON.stringify(t)}.`);ae(e,t);const o=e.len;if(o!==void 0&&typeof o=="number"&&t.length!==o)throw new d(f.invalidLength,`Invalid length for ${e.path}.`);const a=e.maxLen;if(a!==void 0&&typeof a=="number"&&t.length>a)throw new d(f.invalidMaxLength,`Invalid maxLength for ${e.path}.`);const c=e.minLen;if(c!==void 0&&typeof c=="number"&&t.length<c)throw new d(f.invalidMinLength,`Invalid minLength for ${e.path}.`);return t}stringify(t,e){switch(this.load(t,e),e.format||"auto"){case"auto":return jt(t,e.escapeLines,e.encloser);case"regular":return _t(t,e.escapeLines,e.encloser);case"raw":return re(t,e.encloser);default:return jt(t,e.escapeLines,e.encloser)}}}function mn(s,t,e){const n=(e==null?void 0:e.getV(s))||s,{value:i,changed:r}=x(t,n,s,e);if(r)return i;if(!(n instanceof w)||n.type!==h.STRING)throw new d(f.notAString,`Expecting a string value for '${t.path}' but found ${n.toValue()}.`,s);ae(t,i,s);const o=t.len;if(o!==void 0&&typeof o=="number"&&i.length!==o)throw new d(f.invalidLength,`Invalid length for ${t.path}.`,n);const a=t.maxLen;if(a!==void 0&&typeof a=="number"&&i.length>a)throw new d(f.invalidMaxLength,`Invalid maxLength for ${t.path}.`,n);const c=t.minLen;if(c!==void 0&&typeof c=="number"&&i.length<c)throw new d(f.invalidMinLength,`Invalid minLen for ${t.path}.`,n);return i}function ae(s,t,e){const n=s.type;if(n==="string"&&s.pattern!==void 0){let i=s.re;if(!i){let r=s.pattern,o=s.flags;try{o?i=s.re=new RegExp(r,o):i=s.re=new RegExp(r),s.re=i}catch{throw new d(f.invalidPattern,t,e)}}if(!i.test(t))throw new d(f.invalidPattern,`The value '${t}' does not match the pattern '${s.pattern}'.`,e)}else if(n==="email"){if(!pn.test(t))throw new d(f.invalidEmail,`Invalid email address: ${t}`,e)}else if(n==="url"&&!dn.test(t))throw new d(f.invalidUrl,`Invalid URL: ${t}`,e)}let Bt=!1;function wn(){Bt||(E.register(Ve,Be,De,nn,rn,yn,He),Bt=!0)}function Y(s,t){const e=(t==null?void 0:t.allowNameless)===!0;if(!s||typeof s!="object")throw new m(f.invalidMemberDef,"Invalid member definition input provided.");const{name:n,type:i}=s;if(!i||typeof i!="string")throw new m(f.invalidType,"MemberDef.type must be a non-empty string.");if(!e&&(!n||typeof n!="string"||n.trim()===""))throw new m(f.invalidMemberDef,"MemberDef must have a valid name.");if(i==="array"&&(!("of"in s)||typeof s.of!="object"||!s.of))throw new m(f.invalidDefinition,"Array MemberDef must include an 'of' definition.");const r={...s};return"optional"in r&&r.optional!==void 0&&(r.optional=!!r.optional),"null"in r&&r.null!==void 0&&(r.null=!!r.null),r}function En(s,t="*"){if(s instanceof w){if(typeof s.value=="string"){if(E.isRegisteredType(s.value))return{type:s.value,path:t};if(s.value==="*")return{type:"any",path:t}}return{type:"any",path:t}}if(s instanceof I){if(s.children.length===0)return{type:"object",path:t,open:!0};const e=s.children[0];if(e&&!e.key&&e.value instanceof w){const n=e.value;if(typeof n.value=="string"&&E.isRegisteredType(n.value)){const i={type:n.value,path:t};for(let r=1;r<s.children.length;r++){const o=s.children[r];o&&o.key&&o.value instanceof w&&(i[o.key.value]=o.value.value)}return i}}return{type:"object",path:t}}if(s instanceof et){if(s.children.length===0)return{type:"array",path:t,of:{type:"any"}};const e=s.children[0];return e instanceof w&&typeof e.value=="string"?{type:"array",path:t,of:{type:e.value}}:{type:"array",path:t}}return typeof s=="object"&&s.type?{...s,path:t}:{type:"any",path:t}}function ce(s){if(s||R("Key node must not be null in schema definition."),s instanceof w){if(s.type===h.STRING)return s}else if(s instanceof b&&s.type===h.STRING)return new w(s);throw new m(f.invalidKey,"The key must be a string.",s)}wn();function At(s,t,e){if(t instanceof w&&t.type===h.STRING&&t.value.startsWith("$"))return t;if(!(t instanceof I))throw new m(f.invalidSchema,"Schema must be an object.",t);const n=new N(s);return he(t,n,"",e),n}function le(s,t,e){if(s.children.length===0){const o=new N(t);return o.open=!0,{type:"object",path:t,schema:o}}const n=s.children[0];if(!n.key&&n.value instanceof w){const o=n.value;if(o.type===h.STRING){if(E.isRegisteredType(o.value))return Ut(o.value,s,e);if(typeof o.value=="string"&&o.value.startsWith("$"))return{type:"object",schema:o,path:t}}}let i="",r=null;for(let o=0;o<s.children.length;o++){const a=s.children[o];if(a instanceof q&&a.key&&a.key.value==="type"&&a.value instanceof w&&a.value.type===h.STRING){i=a.value.value,r=a.value;break}}if(i!==""){if(typeof i=="string"&&i.startsWith("$"))return{type:"object",schema:r,path:t};if(E.isRegisteredType(i))return Ut(i,s,e);throw new m(f.invalidType,`The specified value '${i}' is not a valid type.`,r)}return{type:"object",schema:he(s,new N(t),t,e),path:t}}function ue(s,t,e){if(s.children.length>1)throw new m(f.invalidSchema,"The array definition must have only one child.",s.children[1]);if(s.children.length===0)return Y({type:"array",of:{type:"any",path:t,null:!0},path:t},{allowNameless:!0});const n=s.children[0];if(n instanceof w){if(n.type===h.STRING){const i=n.value;if(E.isRegisteredType(i))return Y({type:"array",of:{type:n.value,path:t},path:t},{allowNameless:!0});if(e&&i.startsWith("$"))return Y({type:"array",of:{type:"object",schema:n,path:t},path:t},{allowNameless:!0})}throw new m(f.invalidType,`The specified value (${n.value}) is not a valid type`,n)}if(n instanceof I)return Y({type:"array",of:le(n,t,e),path:t},{allowNameless:!0});if(n instanceof et)return Y({type:"array",of:ue(n,t,e),path:t},{allowNameless:!0});throw new m(f.invalidSchema,"The array of type definition must be a string or object.",n)}function he(s,t,e,n){for(let i=0;i<s.children.length;i++){const r=s.children[i];r===null&&R("Child value must not be null in schema definition.");const o=r;if(o.value instanceof w&&o.value.type===h.UNDEFINED)throw new m(f.emptyMemberDef,"The next member definition is empty.",o.value);if(o.key&&o.key.value==="*"){if(o.value){const a=En(o.value,"*");t.defs["*"]=a,t.open=a}else t.open=!0;if(i!==s.children.length-1)throw new m(f.invalidSchema,"The * is only allowed at the last position.",o.value);continue}if(o.key){const a=pe(o,e,n);Ft(a,t,e)}else{if(o.value instanceof w&&o.value.type===h.STRING&&o.value.value==="*"){if(i!==s.children.length-1)throw new m(f.invalidSchema,"The * is only allowed at the last position.",o.value);t.open=!0;continue}const c=ce(o.value),l=fe(c),u=Y({...l,type:"any"});Ft(u,t,e)}}return t.names.length===0&&(t.open=!0),t}function vn(s,t){if(t)for(const e of s.children){if(!(e instanceof q))continue;const n=e.value;if(n instanceof w&&typeof n.value=="string"&&n.value.startsWith("@")){const i=t.getV(n.value);i instanceof w?e.value=i:(n.value=i,typeof i=="number"?n.type=h.NUMBER:typeof i=="boolean"&&(n.type=h.BOOLEAN))}}}function Ut(s,t,e){vn(t,e);const n=E.get(s);return Jt(t,n.schema,e)}function Ft(s,t,e){if(t.defs[s.name])throw new m(f.duplicateMember,`Member ${s.name} is already defined in schema ${t.name}.`,t.defs[s.name]);s.path=$t(e,s.name),t.names.push(s.name),t.defs[s.name]=s}const fe=s=>{if(s||R("Key node must not be null in schema definition."),!(s instanceof b))throw new m(f.invalidKey,"The key must be a string.",s);const t=s.value,e=/\?$/,n=/\*$/,i=/(\?\*)|(\*\?)$/;if(s.type!==h.STRING)throw new m(f.invalidKey,"The key must be a string.",s);return t.match(i)?{name:t.substring(0,t.length-2),optional:!0,null:!0}:t.match(n)?{name:t.substring(0,t.length-1),optional:!1,null:!0}:t.match(e)!==null?{name:t.substring(0,t.length-1),optional:!0,null:!1}:{name:t,optional:!1,null:!1}};function pe(s,t,e){const n=s.value;let i={name:""};if(s.key&&(i=fe(ce(s.key))),n instanceof w&&n.type===h.STRING){const r=n.value;if(r.startsWith("$"))return{...i,type:"object",schema:n};if(E.isRegisteredType(r)===!1)throw new m(f.invalidType,`The type '${r}' is not supported.`,n);return{...i,type:r}}if(n instanceof I){const r=le(n,$t(t,i.name),e);return{...i,...r}}if(n instanceof et){const r=ue(n,$t(t,i.name),e);return{...i,...r}}throw new m(f.invalidType,`Found '${n.toValue()}' but expecting a data type definition.`,n)}function $t(s,t){return s===""?t:`${s}.${t}`}function Sn(s,t){return{getStartPos:()=>s.getStartPos(),getEndPos:()=>t.getEndPos()}}function Wt(s,t){return{getStartPos:()=>s.getStartPos(),getEndPos:()=>t}}function Dt(s,t,e){return{pos:s,row:t,col:e}}var O;(function(s){s.CURLY_OPEN="{",s.CURLY_CLOSE="}",s.BRACKET_OPEN="[",s.BRACKET_CLOSE="]",s.COLON=":",s.COMMA=",",s.HASH="#",s.DOUBLE_QUOTE='"',s.SINGLE_QUOTE="'",s.BACKSLASH="\\",s.TILDE="~",s.PLUS="+",s.MINUS="-",s.DOLLAR="$",s.DOT="."})(O||(O={}));const Yt=s=>[O.CURLY_OPEN,O.CURLY_CLOSE,O.BRACKET_OPEN,O.BRACKET_CLOSE,O.COLON,O.COMMA,O.TILDE,O.DOUBLE_QUOTE,O.SINGLE_QUOTE].includes(s),Nn=s=>/[0-9]/.test(s),Tn=new Set([5760,8232,8233,8239,8287,12288,65279]),Q=(s,t=!1)=>{if(t)return s===" "||s==="	";const e=s.codePointAt(0)||0;return e<=32?!0:e<=255?e===160:e>65279?!1:e>=8192&&e<=8202?!0:Tn.has(e)},bn=s=>![O.CURLY_OPEN,O.CURLY_CLOSE,O.BRACKET_OPEN,O.BRACKET_CLOSE,O.COLON,O.COMMA,O.HASH,O.DOUBLE_QUOTE,O.SINGLE_QUOTE,O.TILDE].includes(s),On=s=>s===h.COLLECTION_START||s===h.SECTION_SEP||s===h.COMMA||s===h.COLON||s===h.BRACKET_OPEN||s===h.BRACKET_CLOSE||s===h.CURLY_OPEN||s===h.CURLY_CLOSE;var A;(function(s){s.NULL="null",s.N="N",s.TRUE="true",s.T="T",s.FALSE="false",s.F="F",s.Inf="Inf",s.PositiveInf="+Inf",s.NegativeInf="-Inf",s.NaN="NaN"})(A||(A={}));const P={hex4:/^[0-9a-fA-F]{4}$/,hex2:/^[0-9a-fA-F]{2}$/,floatDigit:/^[0-9.]+$/,intDigit:/^[0-9]+$/,hex:/^[0-9a-fA-F]+$/,octal:/^[0-7]+$/,binary:/^[01]+$/,sectionSchemaName:/^(?:(?:(?<name>[\p{L}\p{M}\p{N}\-_]+)(?<sep>[ \t]*:[ \t]*)?)(?<schema>\$[\p{L}\p{M}\p{N}\-_]+)?|(?<schema2>\$[\p{L}\p{M}\p{N}\-_]+))/u,annotatedStrStart:/^(?<name>[a-zA-Z]{1,4})(?<quote>['"])/,base64:/^[A-Za-z0-9+/]*={0,2}$/},T={NEWLINE:10,DOUBLE_QUOTE:34,SINGLE_QUOTE:39,HASH:35,PLUS:43,MINUS:45,DOT:46,ZERO:48,NINE:57,COLON:58,COMMA:44,CURLY_OPEN:123,CURLY_CLOSE:125,BRACKET_OPEN:91,BRACKET_CLOSE:93,TILDE:126},xn=s=>s>=T.ZERO&&s<=T.NINE,_n=new Set([5760,8232,8233,8239,8287,12288,65279]),$n=s=>s<=32?!0:s<=255?s===160:s>65279?!1:s>=8192&&s<=8202?!0:_n.has(s),In=P.hex4,Rn=P.hex2,kn=P.floatDigit,pt=P.intDigit,An=P.hex,Cn=P.octal,Mn=P.binary,Ln=["x","X","o","O","b","B"],Pn=P.sectionSchemaName,Vn=Ln,jn=P.annotatedStrStart;class Bn{constructor(t){this.pos=0,this.input="",this.row=1,this.col=1,this.reachedEnd=!1,this.inputLength=0,this.input=t,this.inputLength=t.length}isSpecialSymbolFast(t){return t===T.CURLY_OPEN||t===T.CURLY_CLOSE||t===T.BRACKET_OPEN||t===T.BRACKET_CLOSE||t===T.COMMA||t===T.COLON||t===T.TILDE}getSymbolTokenTypeFast(t){switch(t){case T.CURLY_OPEN:return h.CURLY_OPEN;case T.CURLY_CLOSE:return h.CURLY_CLOSE;case T.BRACKET_OPEN:return h.BRACKET_OPEN;case T.BRACKET_CLOSE:return h.BRACKET_CLOSE;case T.COMMA:return h.COMMA;case T.COLON:return h.COLON;case T.TILDE:return h.COLLECTION_START;default:return h.UNKNOWN}}createErrorToken(t,e,n,i,r){return b.init(e,n,i,r,{__error:!0,message:t.message,originalError:t},h.ERROR)}skipToNextTokenBoundary(){for(;!this.reachedEnd&&!Q(this.input[this.pos])&&!Yt(this.input[this.pos])&&this.input[this.pos]!==","&&this.input[this.pos]!==`
`;)this.advance()}advance(t=1){if(!this.reachedEnd){if(t===1){this.input.charCodeAt(this.pos)===T.NEWLINE?(this.row++,this.col=1):this.col++,this.pos++,this.pos>=this.inputLength&&(this.reachedEnd=!0);return}for(let e=0;e<t;e++)if(this.input.charCodeAt(this.pos)===T.NEWLINE?(this.row++,this.col=1):this.col++,this.pos++,this.pos>=this.inputLength){this.reachedEnd=!0;break}}}parseSingleLineComment(){for(;!this.reachedEnd&&this.input[this.pos]!==`
`;)this.advance()}parseRegularString(t){const e=this.pos,n=this.row,i=this.col;this.advance();let r="",o=!1;for(;!this.reachedEnd&&this.input[this.pos]!==t;){if(Q(this.input[this.pos])){r+=this.skipWhitespaces();continue}if(this.input[this.pos]===O.BACKSLASH)try{({value:r,needToNormalize:o}=this.escapeString(r,o))}catch{if(!this.reachedEnd){const l=this.input[this.pos];if(r+=l,l==="u"){this.advance();for(let u=0;u<4&&!this.reachedEnd;u++)r+=this.input[this.pos],this.advance();continue}else if(l==="x"){this.advance();for(let u=0;u<2&&!this.reachedEnd;u++)r+=this.input[this.pos],this.advance();continue}else this.advance()}continue}else r+=this.input[this.pos],this.advance()}if(this.reachedEnd){const c=this.input.substring(e,this.pos),l=b.init(e,n,i,'"','"',"STRING"),u=Dt(this.pos,this.row,this.col),p=new m(f.stringNotClosed,`Unterminated string literal. Expected closing quote '"' before end of input.`,Wt(l,u),!0);return this.createErrorToken(p,e,n,i,c)}this.advance();const a=this.input.substring(e,this.pos);return o&&(r=r.normalize("NFC")),b.init(e,n,i,a,r,"STRING","REGULAR_STRING")}escapeString(t,e){if(this.advance(),this.reachedEnd)throw new m(f.invalidEscapeSequence,"Invalid escape sequence at end of input. Expected escape character after backslash.",this.currentPosition,!0);switch(this.input[this.pos]){case"b":t+="\b";break;case"f":t+="\f";break;case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"u":const n=this.input.substring(this.pos+1,this.pos+5);if(In.test(n))t+=String.fromCharCode(parseInt(n,16)),this.advance(4),e=!0;else throw new m(f.invalidEscapeSequence,`Invalid Unicode escape sequence '\\u${n}'. Expected 4 hexadecimal digits (0-9, A-F).`,this.currentPosition);break;case"x":const i=this.input.substring(this.pos+1,this.pos+3);if(Rn.test(i))t+=String.fromCharCode(parseInt(i,16)),this.advance(2),e=!0;else throw new m(f.invalidEscapeSequence,`Invalid hexadecimal escape sequence '\\x${i}'. Expected 2 hexadecimal digits (0-9, A-F).`,this.currentPosition);break;default:t+=this.input[this.pos],this.advance();break}return{value:t,needToNormalize:e}}get currentPosition(){const t=()=>({pos:this.pos,row:this.row,col:this.col});return{getStartPos:t,getEndPos:t}}checkIfAnotatedString(){const t=jn.exec(this.input.substring(this.pos,this.pos+5));return t?t.groups:null}parseAnotatedString(t){const e=this.pos,n=this.row,i=this.col;for(let c=0;c<t.name.length;c++)this.advance();if(this.reachedEnd){const c=this.input.substring(e,this.pos),l=b.init(e,n,i,t.name+t.quote,t.name,"STRING"),u=Dt(this.pos,this.row,this.col),p=new m(f.stringNotClosed,`Unterminated annotated string literal. Expected closing quote '${t.quote}' before end of input.`,Wt(l,u),!0);return this.createErrorToken(p,e,n,i,c)}for(this.advance();!this.reachedEnd&&this.input[this.pos]!==t.quote;)this.advance();const r=this.input.substring(e,this.pos);let o;if(this.reachedEnd)o=r.substring(t.name.length+1);else{this.advance();const c=this.input.substring(e,this.pos);o=c.substring(t.name.length+1,c.length-1)}const a=new b;return a.pos=e,a.row=n,a.col=i,a.token=this.reachedEnd?r:this.input.substring(e,this.pos),a.value=o,a}parseRawString(t){const e=this.parseAnotatedString(t);return e.type===h.ERROR||(e.type=h.STRING,e.subType="RAW_STRING"),e}parseByteString(t){const e=this.parseAnotatedString(t);if(e.type===h.ERROR)return e;try{if(!P.base64.test(e.value))throw new Error("Invalid base64 format");return e.type=h.BINARY,e.subType="BINARY_STRING",e.value=Buffer.from(e.value,"base64"),e}catch(n){return this.createErrorToken(n,e.pos,e.row,e.col,e.token)}}parseDateTime(t){const e=this.parseAnotatedString(t);if(e.type===h.ERROR)return e;try{let n=r=>null;switch(t.name){case"dt":n=Ye,e.subType=h.DATETIME;break;case"d":n=Ke,e.subType=h.DATE;break;case"t":n=qe,e.subType=h.TIME;break;default:R(t)}const i=n(e.value);if(!i){const r=new m(f.invalidDateTime,`Invalid ${t.name==="dt"?"datetime":t.name==="d"?"date":"time"} format '${e.value}'. Expected valid ISO 8601 format.`,e);return this.createErrorToken(r,e.pos,e.row,e.col,e.token)}return e.value=i,e.type=h.DATETIME,e}catch(n){return this.createErrorToken(n,e.pos,e.row,e.col,e.token)}}parseNumber(){const t=this.pos,e=this.row,n=this.col;let i="",r=10,o=!1,a=!1,c="",l;if(this.input[this.pos]==="+"||this.input[this.pos]==="-"){const g=this.input[this.pos];if(this.input.startsWith("Inf",this.pos+1)){const v=g+"Inf";return this.advance(4),b.init(t,e,n,v,g==="+"?1/0:-1/0,h.NUMBER)}if(Nn(this.input[this.pos+1])||this.input[this.pos+1]===".")i+=g,this.advance();else return null}else if(this.input.startsWith("Inf",this.pos))return this.advance(3),b.init(t,e,n,"Inf",1/0,h.NUMBER);if(this.input[this.pos]==="."&&!kn.test(this.input[this.pos+1]))return null;if(this.input[this.pos]==="0"&&Vn.includes(this.input[this.pos+1]))switch(this.input[this.pos+1]){case"X":case"x":for(r=16,l="HEX",c=this.input[this.pos]+this.input[this.pos+1],this.advance(2);An.test(this.input[this.pos]);)i+=this.input[this.pos],this.advance();break;case"O":case"o":for(r=8,l="OCTAL",c=this.input[this.pos]+this.input[this.pos+1],this.advance(2);Cn.test(this.input[this.pos]);)i+=this.input[this.pos],this.advance();break;case"B":case"b":for(r=2,l="BINARY",c=this.input[this.pos]+this.input[this.pos+1],this.advance(2);Mn.test(this.input[this.pos]);)i+=this.input[this.pos],this.advance();break;default:R(this.input[this.pos+1])}else{for(;pt.test(this.input[this.pos]);)i+=this.input[this.pos],this.advance();if(this.input[this.pos]===".")for(o=!0,i+=".",this.advance();pt.test(this.input[this.pos]);)i+=this.input[this.pos],this.advance();if(this.input[this.pos]==="e"||this.input[this.pos]==="E")for(a=!0,i+=this.input[this.pos],this.advance(),(this.input[this.pos]==="+"||this.input[this.pos]==="-")&&(i+=this.input[this.pos],this.advance());pt.test(this.input[this.pos]);)i+=this.input[this.pos],this.advance()}let u=h.NUMBER,p;return this.input[this.pos]==="n"?(u=h.BIGINT,p=BigInt(c+i),i+="n",this.advance()):this.input[this.pos]==="m"?(u=h.DECIMAL,p=new S(i),i+="f",this.advance()):r===10&&(o||a)?p=parseFloat(i):(p=parseInt(i,r),isNaN(p)&&R("Expected a number but got NaN",this.currentPosition.getStartPos())),b.init(t,e,n,c+i,p,u,l)}parseLiteralOrOpenString(){const t=this.pos,e=this.row,n=this.col;let i="",r=!1;for(;!this.reachedEnd&&bn(this.input[this.pos]);){let o=this.input[this.pos];if(Q(o)){i+=this.skipWhitespaces();continue}if(o===O.MINUS&&this.input.substring(this.pos,this.pos+3)==="---")break;if(o===O.BACKSLASH)try{({value:i,needToNormalize:r}=this.escapeString(i,r));continue}catch{if(i+="\\",!this.reachedEnd){const c=this.input[this.pos];if(i+=c,c==="u"){this.advance();for(let l=0;l<4&&!this.reachedEnd;l++)i+=this.input[this.pos],this.advance();continue}else if(c==="x"){this.advance();for(let l=0;l<2&&!this.reachedEnd;l++)i+=this.input[this.pos],this.advance();continue}else this.advance()}continue}else i+=o,this.advance()}if(i=i.trimEnd(),r&&(i=i.normalize("NFC")),i==="")return null;switch(i){case A.TRUE:case A.T:return b.init(t,e,n,i,!0,h.BOOLEAN);case A.FALSE:case A.F:return b.init(t,e,n,i,!1,h.BOOLEAN);case A.NULL:case A.N:return b.init(t,e,n,i,null,h.NULL);case A.Inf:case A.NaN:return b.init(t,e,n,i,i===A.Inf?1/0:NaN,h.NUMBER);default:return b.init(t,e,n,i,i,h.STRING,"OPEN_STRING")}}mergeTokens(t,e){const n=new b;return n.pos=t.pos,n.row=t.row,n.col=t.col,n.token=t.token+e.token,n.value=t.token+e.value.toString(),n.type=e.type,n.subType=e.subType,n}skipWhitespaces(t=!1){const e=this.pos;for(;!this.reachedEnd&&Q(this.input[this.pos],t);)this.input[this.pos]==="\r"?(this.input[this.pos+1]===`
`&&this.advance(),this.advance()):this.advance();if(e===this.pos)return"";let n=this.input.substring(e,this.pos);return n.includes("\r")&&(n=n.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),n}tokenize(){const t=Math.max(10,Math.floor(this.inputLength/8)),e=new Array(t);let n=0;for(;this.pos<this.inputLength;){const i=this.input.charCodeAt(this.pos);if($n(i)){this.advance();continue}else if(i===T.HASH)this.parseSingleLineComment();else if(i===T.DOUBLE_QUOTE||i===T.SINGLE_QUOTE)e[n++]=this.parseRegularString(this.input[this.pos]);else if(this.isSpecialSymbolFast(i)){const r=this.row,o=this.col,a=this.input[this.pos];e[n++]=b.init(this.pos,r,o,a,a,this.getSymbolTokenTypeFast(i)),this.advance()}else if(i===T.PLUS||i===T.MINUS||i===T.DOT||xn(i)){if(i===T.MINUS&&this.input.substring(this.pos,this.pos+3)==="---"){n=this.parseSectionSeparator(e,n);continue}const r=this.parseNumber();if(r){const o=this.skipWhitespaces();if(this.reachedEnd)e[n++]=r;else if(!Yt(this.input[this.pos])&&!Q(this.input[this.pos])){const a=this.parseLiteralOrOpenString();a?(a.type=h.STRING,a.subType="OPEN_STRING",o.length>0&&(a.token=o+a.token,a.value=o+a.value),e[n++]=this.mergeTokens(r,a)):e[n++]=r}else e[n++]=r}else{const o=this.parseLiteralOrOpenString();o&&(e[n++]=o)}}else{const r=this.checkIfAnotatedString();if(r)switch(r.name){case"r":e[n++]=this.parseRawString(r);break;case"b":e[n++]=this.parseByteString(r);break;case"d":case"dt":case"t":e[n++]=this.parseDateTime(r);break;default:const o=new m(f.unsupportedAnnotation,`Unsupported annotation '${r.name}'. Supported annotations are: 'r' (raw string), 'b' (binary), 'dt' (datetime), 'd' (date), 't' (time).`,this.currentPosition),a=this.input.substring(this.pos,this.pos+r.name.length+1);e[n++]=this.createErrorToken(o,this.pos,this.row,this.col,a),this.skipToNextTokenBoundary()}else{const o=this.parseLiteralOrOpenString();o&&(e[n++]=o)}}}return e.length=n,e}parseSectionSeparator(t,e){var i;t[e++]=b.init(this.pos,this.row,this.col,"---","---",h.SECTION_SEP),this.advance(3),this.skipWhitespaces(!0);const n=Pn.exec(this.input.substring(this.pos));if(n){let r,o,a=(i=n.groups)==null?void 0:i.sep,c;if(n.groups&&(r=n.groups.schema,o=n.groups.name,c=n.groups.schema2),c)t[e++]=b.init(this.pos,this.row,this.col,c,c,h.STRING,h.SECTION_SCHEMA),this.advance(c.length),this.skipWhitespaces(!0);else if(o&&(t[e++]=b.init(this.pos,this.row,this.col,o,o,h.STRING,h.SECTION_NAME),this.advance(o.length),this.skipWhitespaces(!0),a)){if(this.advance(a.length),this.skipWhitespaces(!0),!r){const l=new m(f.schemaMissing,"Missing schema definition after section separator. Expected schema name starting with '$' (e.g., '$mySchema').",this.currentPosition);return t[e++]=this.createErrorToken(l,this.pos,this.row,this.col,""),e}t[e++]=b.init(this.pos,this.row,this.col,r,r,h.STRING,h.SECTION_SCHEMA),this.advance(r.length),this.skipWhitespaces(!0)}}return e}}class Un{constructor(t,e=[],n=[]){this.header=null,this.children=[],this.errors=[],this.header=t,this.children=e,this.errors=n}get firstChild(){return this.children.length>0?this.children[0]:null}getErrors(){return this.errors}toValue(t){var i;const e=((i=this.header)==null?void 0:i.toValue(t))??null,n=new Tt;for(let r=0;r<this.children.length;r++)n.push(this.children[r].toValue(t));return new dt(e,n)}getStartPos(){return this.header?this.header.getStartPos():this.children.length>0?this.children[0].getStartPos():{row:0,col:0,pos:0}}getEndPos(){return this.children.length>0?this.children[this.children.length-1].getEndPos():this.header?this.header.getEndPos():{row:0,col:0,pos:0}}}class Fn{constructor(t,e,n){this.type="section",this.child=t,this.nameNode=e,this.schemaNode=n}get name(){var t,e;return((t=this.nameNode)==null?void 0:t.value)||((e=this.schemaNode)==null?void 0:e.value.toString().substring(1))||"unnamed"}get schemaName(){var t;return((t=this.schemaNode)==null?void 0:t.value)||"$schema"}get firstChild(){return this.child}get firstChildObject(){return this.child instanceof I?this.child:this.child instanceof ut&&this.child.children.length>0?this.child.children[0]:null}getStartPos(){var t;return((t=this.child)==null?void 0:t.getStartPos())??{row:0,col:0,pos:0}}getEndPos(){var t;return((t=this.child)==null?void 0:t.getEndPos())??{row:0,col:0,pos:0}}toValue(t){let e=null;return this.child&&(e=this.child.toValue(t)),new Nt(e,this.name,this.schemaName)}}class _{constructor(t){this.sectionNames={},this.errors=[],this.tokens=t,this.current=0}parse(){return this.processDocument()}createUnclosedConstructError(t,e,n,i){let r=null,o=this.current-1;for(;o>=0;){const a=this.tokens[o];if(a&&a.type!==h.COLLECTION_START&&a.type!==h.SECTION_SEP){r=a;break}o--}if(n&&r){const a=Sn(n,r);return new m(t,e,a,!1)}else return n?new m(t,e,n,!1):new m(t,e,void 0,!0)}processDocument(){const t=new Array;let e=null,n=this.peek(),i=!0;for(;;){i&&(n==null?void 0:n.type)===h.SECTION_SEP&&(i=!1);const r=this.processSection(i);if(n=this.peek(),!n){t.push(r);break}if(i?e=r:t.push(r),i&&(i=!1),n.type!==h.SECTION_SEP){const o=new m(f.unexpectedToken,`Expected section separator '---' but found '${n.token}'. Each section must be properly closed before starting a new one.`,n);this.errors.push(o);break}this.advance()}return new Un(e,t,this.errors)}processSection(t){var c;let e=this.peek();(e==null?void 0:e.type)===h.SECTION_SEP&&this.advance();const[n,i]=this.parseSectionAndSchemaNames();let r=(i==null?void 0:i.value)||(n==null?void 0:n.value.toString().substring(1))||"unnamed";const o=r;if(r&&this.sectionNames[r]){const l=new m(f.unexpectedToken,`Duplicate section name '${r}'. Each section must have a unique name within the document.`,void 0,!1);this.errors.push(l);let u=2;for(;this.sectionNames[`${o}_${u}`];)u++;r=`${o}_${u}`,i&&(i.value=r)}(!t||t&&r!=="unnamed"&&((c=this.peek())==null?void 0:c.type)!==h.SECTION_SEP)&&(this.sectionNames[r]=!0);const a=this.parseSectionContent();return new Fn(a,i,n)}parseSectionAndSchemaNames(){let t=null,e=null,n=this.peek();return(n==null?void 0:n.subType)===h.SECTION_NAME?(e=n,this.advance(),n=this.peek(),(n==null?void 0:n.subType)===h.SECTION_SCHEMA&&(t=n,this.advance())):(n==null?void 0:n.subType)===h.SECTION_SCHEMA&&(t=n,this.advance(),n=this.peek()),[t,e]}parseSectionContent(){const t=this.peek();return!t||t.type===h.SECTION_SEP?null:t.type===h.COLLECTION_START?this.processCollection():this.processObject(!1)}processCollection(){const t=[];for(;this.match(_.COLLECTION_START_ARRAY);){this.advance(),this.current;const e=this.peek();if(e&&e.type===h.ERROR){const n=e.value,i=new z(n.originalError,e);this.errors.push(n.originalError),t.push(i),this.advance(),this.skipToNextCollectionItem();continue}try{t.push(this.processObject(!0))}catch(n){this.errors.push(n);let i={pos:-1,row:-1,col:-1},r;if(n&&typeof n=="object"&&"positionRange"in n){const o=n.positionRange;o&&o.getStartPos&&(i=o.getStartPos(),r=o.getEndPos?o.getEndPos():void 0)}if(i.pos===-1&&this.current>0&&this.current<=this.tokens.length){const o=this.tokens[this.current-1];o&&(i=o.getEndPos(),r=i)}t.push(new z(n,i,r)),this.skipToNextCollectionItem()}}return new ut(t)}skipToNextCollectionItem(){for(;this.peek()&&!this.match(_.COLLECTION_OR_SECTION_ARRAY);)this.advance()}skipToNextSyncPoint(){for(;this.peek();){const t=this.peek();if(!t||On(t.type))break;this.advance()}}processObject(t){const e=this.parseObject(!0),n=this.peek();if(this.checkForPendingTokens(n,t),e.children.length===1){const i=e.children[0];if(i&&!i.key&&i.value&&i.value instanceof I)return i.value}return e}checkForPendingTokens(t,e){if(t&&t.type!==h.SECTION_SEP&&!(e&&t.type===h.COLLECTION_START))throw new m(f.unexpectedToken,`Unexpected token '${t.value}'. Expected end of section or start of new collection item '~'.`,t,!1)}parseObject(t){const e=[];let n=this.peek();t&&(n=null),!t&&!this.advanceIfMatch(_.CURLY_OPEN_ARRAY)&&R("The caller must ensure that this function is called only when the next token is {");let i=0,r=!1,o=!0;for(;!r;){const a=this.peek();if(!a||this.match([h.CURLY_CLOSE,h.COLLECTION_START,h.SECTION_SEP])){if(o){const c=this.tokens[this.current-1];c&&c.type===h.COMMA&&this.pushUndefinedMember(e,c)}r=!0;break}else if(a.type===h.COMMA){o&&this.pushUndefinedMember(e,a),this.advance(),o=!0;continue}else{if(i>0&&!this.matchPrev([h.COMMA,h.CURLY_OPEN]))throw new m(f.unexpectedToken,`Missing comma before '${a.value}'. Object members must be separated by commas.`,a,!1);const c=this.parseMember();e.push(c),i++,o=!1}}if(t)return new I(e);{if(!this.match(_.CURLY_CLOSE_ARRAY))throw this.createUnclosedConstructError(f.expectingBracket,"Missing closing brace '}'. Object must be properly closed.",n,e);let a=this.peek();return this.advance(),new I(e,n,a)}}parseMember(){const t=this.peek();if(t||R("The caller must ensure that this function is called only when the member has at least one token"),this.matchNext(_.COLON_ARRAY))if(_.VALID_KEY_TYPES.includes(t.type)){this.advance(2);const n=this.parseValue();return new q(n,t)}else throw new m(f.invalidKey,`Invalid key '${t.token}'. Object keys must be strings, numbers, booleans, or null.`,t,!1);return new q(this.parseValue())}parseArray(){const t=[],e=this.peek();if(!e||e.type!==h.BRACKET_OPEN)throw new m(f.expectingBracket,`Expected opening bracket '[' to start array but found '${(e==null?void 0:e.token)||"end of input"}'.`,e===null?void 0:e,e===null);for(this.advance();;){const i=this.peek();if(!i)throw this.createUnclosedConstructError(f.expectingBracket,"Unexpected end of input while parsing array. Expected closing bracket ']'.",e,t);if(i.type===h.BRACKET_CLOSE)break;if(i.type===h.COLLECTION_START||i.type===h.SECTION_SEP)throw this.createUnclosedConstructError(f.expectingBracket,"Missing closing bracket ']'. Array must be properly closed.",e,t);if(i.type===h.COMMA){if(this.matchNext([h.COMMA,h.BRACKET_CLOSE])){const o=this.tokens[this.current+1];throw new m(f.unexpectedToken,"Unexpected comma. Array elements cannot be empty - remove the extra comma or add a value.",o,!1)}this.advance();continue}const r=this.parseMember();r.key?t.push(new I([r])):t.push(r.value)}if(!this.match(_.BRACKET_CLOSE_ARRAY))throw this.createUnclosedConstructError(f.expectingBracket,"Missing closing bracket ']'. Array must be properly closed.",e,t);const n=this.peek();return this.advance(),new et(t,e,n)}parseValue(){const t=this.peek();if(!t)throw new m(f.valueRequired,"Unexpected end of input. Expected a value (string, number, boolean, null, array, or object).",void 0,!0);switch(t.type){case h.STRING:case h.NUMBER:case h.BIGINT:case h.DECIMAL:case h.BOOLEAN:case h.NULL:case h.DATETIME:{const e=new w(t);return this.advance(),e}case h.BRACKET_OPEN:return this.parseArray();case h.CURLY_OPEN:return this.parseObject(!1);case h.ERROR:{const e=t.value,n=new z(e.originalError,t);return this.errors.push(e.originalError),this.advance(),this.skipToNextSyncPoint(),n}default:throw new m(f.unexpectedToken,`Unexpected token '${t.value}'. Expected a valid value (string, number, boolean, null, array, or object).`,t,t===null)}}pushUndefinedMember(t,e){const n=e.clone();n.type=h.UNDEFINED,n.value=void 0;const i=new q(new w(n));t.push(i)}isValidToken(t){return t!==null}peek(){return this.current<this.tokens.length?this.tokens[this.current]:null}advance(t=1){this.current+=t}match(t){const e=this.peek();return!!(this.isValidToken(e)&&t.includes(e.type))}matchPrev(t){const e=this.tokens[this.current-1];return!!(this.isValidToken(e)&&t.includes(e.type))}matchNext(t){if(this.current+1>=this.tokens.length)return!1;const e=this.tokens[this.current+1];return!!(this.isValidToken(e)&&t.includes(e.type))}advanceIfMatch(t){return this.match(t)?(this.advance(),!0):!1}}_.CURLY_OPEN_ARRAY=[h.CURLY_OPEN];_.CURLY_CLOSE_ARRAY=[h.CURLY_CLOSE];_.BRACKET_OPEN_ARRAY=[h.BRACKET_OPEN];_.BRACKET_CLOSE_ARRAY=[h.BRACKET_CLOSE];_.COLLECTION_START_ARRAY=[h.COLLECTION_START];_.SECTION_SEP_ARRAY=[h.SECTION_SEP];_.COMMA_ARRAY=[h.COMMA];_.COLON_ARRAY=[h.COLON];_.COLLECTION_OR_SECTION_ARRAY=[h.COLLECTION_START,h.SECTION_SEP];_.VALID_KEY_TYPES=[h.STRING,h.NUMBER,h.BOOLEAN,h.NULL];class Wn{constructor(t={}){this.continueOnError=t.continueOnError||!1,this.allowEmptyRecords=t.allowEmptyRecords||!1,this.numberOfSections=t.numberOfSections||0,this.headerOnly=t.headerOnly||!1,this.dataOnly=t.dataOnly||!1,this.skipEmptyLines=t.skipEmptyLines||!1,this.allowVariables=t.allowVariables||!1,this.trueTokens=t.trueTokens||["true","T"],this.falseTokens=t.falseTokens||["false","F"]}}function de(s,t,e,n){var g;let i=null,r=null;n||new Wn,t&&!(t instanceof Et)&&typeof t=="object"&&"continueOnError"in t?i=null:t instanceof Et?i=t:(t instanceof N||typeof t=="string")&&(r=t);const a=new Bn(s).tokenize();if(a.length===0)return new dt(new Mt,new Tt);const l=new _(a).parse(),u=l.getErrors(),p=new dt(new Mt,new Tt,u);if(l.header){if(l.header.child){if(l.header.child instanceof I){const v=At("schema",l.header.child);v instanceof N?((g=p.header.definitions)==null||g.push("$schema",v,!0),p.header.schema=v):R(v)}else l.header.child instanceof ut?Dn(p,l.header.child):R(l.header.child);i&&p.header.definitions.merge(i,!1)}else i&&p.header.definitions.merge(i,!1);Kt(l,p)}else{if(i&&p.header.definitions.merge(i,!1),r){if(r instanceof N)p.header.schema=r;else if(typeof r=="string"&&p.header.definitions){const v=p.header.definitions.getV(r);v instanceof N&&(p.header.schema=v)}}Kt(l,p)}return p}function Kt(s,t,e){var i,r,o,a;const n=s.children.length;if(n!==0)for(let c=0;c<n;c++){const l=s.children[c],u=l.schemaName,p=u?u==="$schema"?t.header.schema:(i=t.header.definitions)==null?void 0:i.getV(l.schemaNode):t.header.schema;if(!p){(o=t.sections)==null||o.push(new Nt((r=l.child)==null?void 0:r.toValue(t.header.definitions||void 0),l.name));continue}const g=Jt(l.child,p,t.header.definitions||void 0);(a=t.sections)==null||a.push(new Nt(g,l.name,u))}}function Dn(s,t){const e=s.header.definitions;if(!e)throw new Error("Document header definitions not initialized. This is an internal error - please report this issue.");const n=[];for(let i=0;i<t.children.length;i++){const r=t.children[i];if(!r)continue;if(r instanceof z)throw new $(f.invalidDefinition,`Invalid definition: ${r.error.message}`,r);r instanceof I||R("Invalid definition, must be object");const o=r;o.children[0]===null&&R("Invalid definition"),o.children.length;const a=o.children[0];if(!a.key)throw new $(f.invalidDefinition,"Invalid definition: missing key. Each definition must have a key (e.g., '$schema: {...}' or '@variable: value').",a.value);const c=a.key;if(c.type!==h.STRING)throw new Error("Invalid typedef definition: key must be a string.");let l=c.value;if(l.startsWith("$")){e.push(l,a.value,!0),n.push({key:l,schemaDef:a.value});continue}if(l.startsWith("@")){e.push(l,a.value,!1,!0);continue}let u=o.children[0].value;e.push(l,u.toValue(s.header.definitions||void 0))}for(let i=0;i<n.length;i++){const{key:r,schemaDef:o}=n[i],a=At(r,o,e);e.set(r,a)}}function Yn(s,t,e){return s=s.trim(),s?(s.endsWith("---")||(s+=`
---`),de(s,t,void 0,e).header.definitions):null}const rt={Warning:4,Error:8};function Kn(s){switch(s){case"syntax":return rt.Error;case"validation":return rt.Warning;case"runtime":return rt.Error;default:return rt.Error}}function ge(s,t){return`${s.startLine}:${s.startColumn}-${s.endLine}:${s.endColumn}:${t.substring(0,20)}`}function qn(s){return s&&s.type==="parse"&&typeof s.id=="string"}self.addEventListener("message",s=>{const t=s.data;if(!qn(t)){console.error("Invalid message received by parser worker:",t);return}try{const e=zn(t.documentText,t.schemaText,t.skipErrors,t.minifiedOutput),n={type:"result",id:t.id,result:e};self.postMessage(n)}catch(e){const n={type:"error",id:t.id,error:(e==null?void 0:e.message)||String(e)};self.postMessage(n)}});function zn(s,t,e,n){if(!t)return qt(s,null,e,n);const i=ye(t,Yn,!0,e);return i.errorMessages.length>0?{...i,jsonText:"",error:!0}:qt(s,i.defs,e,n)}function ye(s,t,e=!1,n=!1){try{const i=t(s,null);let r=[];i&&typeof i.getErrors=="function"&&(r=i.getErrors());const o=e?null:i.toJSON({skipErrors:n}),a=e?i:null;if(r.length>0){const c=e?"defs":"doc",l=r.map(u=>Gt(u,c)).filter(u=>u!==null);return{errorMessages:r.map(u=>zt(u)),errorItems:l,defs:a,output:o,defsMarkers:e?r.flatMap(ot):[],docMarkers:e?[]:r.flatMap(ot)}}return{errorMessages:[],errorItems:[],defs:a,output:o,defsMarkers:[],docMarkers:[]}}catch(i){const o=Gt(i,e?"defs":"doc");return{errorMessages:[zt(i)],errorItems:o?[o]:[],defs:null,output:null,defsMarkers:e?ot(i):[],docMarkers:e?[]:ot(i)}}}function qt(s,t,e,n){const i=ye(s,c=>de(c,t),!1,e),r=i.errorMessages.length>0;let o="",a=!1;return i.output?(o=JSON.stringify(i.output,function(c,l){return typeof l=="bigint"?`io:big:${l.toString()}`:typeof l=="number"&&isNaN(l)?"io:number:NaN":l instanceof S?`io:decimal:${l.toString()}`:l===1/0?"io:number:Inf":l===-1/0?"io:number:-Inf":typeof l>"u"?"io:undefined":l},n?0:2),a=r):r&&(o="",a=!0),{errorMessages:i.errorMessages,errorItems:i.errorItems,docMarkers:i.docMarkers,defsMarkers:i.defsMarkers,jsonText:o,error:a}}function zt(s){return s instanceof m?"SYNTAX_ERROR: "+((s==null?void 0:s.message)||String(s)):s instanceof d?"VALIDATION_ERROR: "+((s==null?void 0:s.message)||String(s)):"ERROR: "+((s==null?void 0:s.message)||String(s))}function me(s){return s instanceof m?"syntax":s instanceof d?"validation":"runtime"}function we(s){var n,i;if(!(s instanceof $))return null;const t=(n=s.positionRange)==null?void 0:n.getStartPos(),e=(i=s.positionRange)==null?void 0:i.getEndPos();return!t||!e?null:{startLine:t.row,startColumn:t.col,endLine:e.row,endColumn:e.col}}function Gt(s,t){const e=we(s);if(!e)return null;const n=me(s),i=(s==null?void 0:s.message)||String(s);return{id:ge(e,i),code:s.code,category:n,message:i,range:e,source:t}}function ot(s){if(!(s instanceof $))return[];const t=we(s);if(!t)return[];const e=me(s),n=Kn(e),i=(s==null?void 0:s.message)||String(s);return[{message:i,severity:n,startLineNumber:t.startLine,startColumn:t.startColumn,endLineNumber:t.endLine,endColumn:t.endColumn,id:ge(t,i),category:e}]}
//# sourceMappingURL=parser.worker-Dyv_qUJB.js.map
